#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For TDD 
#
#     File:    rgac_tc37.xml
#
#     Sid:     rgac_tc37.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     mnawas
#
#*********************************************************************21*/

#
#       Test:    37.1
#
#       Desc:   "To verify successfull addition of secondary cell addition"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" />

      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.2
#
#       Desc:   "To verify successfull activation of a scell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful activation of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful activation of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
 
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.3
#
#       Desc:   "To verify successfull scheduling of SCell activation CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful scheduling of SCell activation CE
      </tapa.desc>

      <tapa.longdesc>
         To verify successful scheduling of SCell activation CE
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.4
#
#       Desc:   "HARQ ACK for scell activation CE pdu
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.5
#
#       Desc:   "HARQ NACK for scell activation CE pdu and retx of CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.6
#
#       Desc:   HARQ NACK max retx scenario
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Harq failure for CE txion
      </tapa.desc>

      <tapa.longdesc>
         Harq failure for CE txion
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxDlHqTx="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      #second set of nack-retx
     ## expect hq feedback for the first Ue's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.7
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" />

      #Add the same sec cell again
 
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.8
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="9" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.9
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition (Invalid scell id)
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition (Invalid scell id)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="5"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.10
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="9" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.11
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition (Invalid  num scell )
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition (Invalid num scell)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="10" sCellIdx="1" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.12
#
#       Desc:   "To verify  failure case of scell activation
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful activation of a scell (invalid UE)
      </tapa.desc>

      <tapa.longdesc>
         To verify successful activation of a scell (invalid UE)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell crnti="100" sCellActionType="2"/>
      </tapa.send>
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.13
#
#       Desc:   "To verify  failure case of scell activation
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful activation of a scell (invalid sCellIdx)
      </tapa.desc>

      <tapa.longdesc>
         To verify successful activation of a scell (invalid sCEllIdx)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellIdx="9" sCellActionType="2"/>
      </tapa.send>
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.14
#
#       Desc:   "To verify  failure case of scell activation
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful activation of a scell (invalid sCellIdx)
      </tapa.desc>

      <tapa.longdesc>
         To verify successful activation of a scell (invalid sCEllIdx)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellIdx="2" sCellActionType="2"/>
      </tapa.send>
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.15
#
#       Desc:   "To verify successfull addition of UE-SCell MAC 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a UE-SCell MAC
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a UE-SCell MAC
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

<!--
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
-->
      #Initialize 1 UE on first instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="1"/>
      </tapa.send>
      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      # steps for data on each UE
      <tapa.delay delay="1"/>      
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.16
#
#       Desc:   "To verify successfull addition/deletion of SCell at MAC/SCH 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a UE-SCell MAC
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a UE-SCell MAC
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>
<!--
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
-->
      #Initialize 1 UE on first cell
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      #Add UE to the Seconday Cell which calls rgAddSCellCfg 
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="1"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
      #delete UE which instern expect SCellDelete:rgSCellUeDel
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 



#
#       Test:    37.17
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
    
      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>




      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 



#
#       Test:    37.18
#
#       Desc:   To verify ue reset for scell 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify ue reset for scell
      </tapa.desc>

      <tapa.longdesc>
         To verify ue reset for scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" />

      #Add the same sec cell again

      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.19
#
#       Desc:   DL CQI report verification: Similar report types collide 
#               smaller scell idx is selected for cqi reception
#               1. PCELL CQI CFG: off 3 prd 20 SB
#               2. SCELL CQI CFG: off 3 prd 40 WB
#               3. Collision at 8,3, SCELL given prio over PCELL
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
    -->  



    <tapa.send>
       <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Scell not yet activated due to scell activation delay timer
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## SCELL given prio over PCELL n2 resource of SCELL used
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>




      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.20
#
#       Desc:   DL CQI report verification: Similar report types collide 
#               smaller scell idx is selected for cqi reception
#               1. PCELL CQI CFG: off 3 prd 20 WB
#               2. SCELL CQI CFG: off 3 prd 40 WB
#               3. Collision at 8,3, PCELL given prio over SCELL
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#

<tapa.testcase id="37.20">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
    -->  



    <tapa.send>
       <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

   
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>




      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.21
#
#       Desc:   DL CQI report verification: PCELL and SCELL occasions dont collide, 
#               reception req is sent for both PCELL and SCELL at their occasions.
#               1. PCELL CQI CFG: off 3 prd 20 WB
#               2. SCELL CQI CFG: off 4 prd 40 SB
#               3. No collision
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2" cqiPResIdx="666"/>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2" cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
    -->  



    <tapa.send>
       <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>





      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.22
#
#       Desc:   DL RI report verification: Similar report types collide 
#               RI of PCELL collides with RI of SCELL, SCELL RI is ignored
#               1. PCELL CQI CFG: off 3 prd 20 SB RI CFG IDX 1
#               2. SCELL CQI CFG: off 3 prd 40 WB RI CFG IDX 1
#               3. PCELL RI is selected and SCELL RI is ignored
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="334" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4097" riEna="TRUE" riCfgIdx="1"   cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
    -->  



    <tapa.send>
       <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>




      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.23
#
#       Desc:   DL RI report verification: 
#               RI of SCELL collides with CQI of PCELL, PCELL CQI is ignored
#               1. PCELL CQI CFG: off 3 prd 20 SB RI disabled
#               2. SCELL CQI CFG: off 4 prd 40 WB RI CFG IDX 1
#               3. SCELL RI is selected and PCELL CQI is ignored
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="334" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" riEna="FALSE" riCfgIdx="1"  cqiPResIdx="555" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #As secondry cell is not yet activated, CQI will be for primary cell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #CQI primary cell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #As secondry cell is already activated,so secondary cell RI will 
      #get priority over promary cell SB CQI
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Scell CQI
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

<!--
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

-->


      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.24
#
#       Desc:   DL RI report verification: 
#               RI of PCELL collides with CQI of SCELL, SCELL CQI is ignored
#               1. PCELL CQI CFG: off 4 prd 20 SB RI CFG IDX 1
#               2. SCELL CQI CFG: off 3 prd 40 WB RI disabled
#               3. PCELL RI is selected and SCELL CQI is ignored
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="FALSE" riCfgIdx="1"  cqiPResIdx="666"/>
      

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="334" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="21"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4097" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="555"  txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="FALSE" riCfgIdx="1"  cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
-->


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.25
#
#       Desc:   DL RI report verification: 
#               RI of SCELL collides with CQI of PCELL, PCELL CQI is ignored
#               1. PCELL CQI CFG: off 3 prd 20 SB RI disabled
#               2. SCELL CQI CFG: off 4 prd 40 WB RI CFG IDX 1
#               3. SCELL RI is selected and PCELL CQI is ignored
#               4. SCELL num antenna ports 2
#               5. UE Tx mode is TM3 on SCELL
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      #<tapa.rg.multiInstCellInit/>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell instId="0" spId="0" cellId="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>


      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0" cellId="3" crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="3" dir="1" lcType="2" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

     #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0" cellId="3" crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3" spId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #MAC Cell configuration for instance 1
      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell instId="1" spId="1" cellId="4"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>


      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="1" cellId="4" crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="2" dir="1" lcType="1" spId="1"
            dlTrchType="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="3" dir="1" lcType="2" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>
 
      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="1" cellId="4" crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3" spId="1"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Sending RGR ENB Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.enb instId="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     
      #Scheduler Cell Configuration

      #Sending RGR CELL Configuration for cell 1
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" spId="0" maxDlRetxBw="100" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" cellId="3" macInst="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Sending RGR CELL Configuration for cell 2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" spId="1" maxDlRetxBw="100" numCmnLc="5" numTxAntPorts="2"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" cellId="4" macInst="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      ### cell init end
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="334" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" riEna="FALSE" riCfgIdx="1"  cqiPResIdx="555" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

	  #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell is not yet activated.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Pcell CQI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell RI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell CQI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>


      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.26
#
#       Desc:   DL RI report verification: 
#               RI of SCELL collides with CQI of PCELL, PCELL CQI is ignored
#               1. PCELL CQI CFG: off 3 prd 20 SB RI disabled
#               2. SCELL CQI CFG: off 4 prd 40 WB RI CFG IDX 1
#               3. SCELL RI is selected and PCELL CQI is ignored
#               4. SCELL num antenna ports 4
#               5. UE Tx mode is TM3 on SCELL
#               6. UE cat 1 
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      #<tapa.rg.multiInstCellInit/>

      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell instId="0" spId="0" cellId="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>


      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0" cellId="3" crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="3" dir="1" lcType="2" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="0" cellId="3" crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5" spId="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

     #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0" cellId="3" crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3" spId="0"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      #MAC Cell configuration for instance 1
      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell instId="1" spId="1" cellId="4"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>


      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="1" cellId="4" crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="2" dir="1" lcType="1" spId="1"
            dlTrchType="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="3" dir="1" lcType="2" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  instId="1" cellId="4" crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5" spId="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>
 
      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="1" cellId="4" crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3" spId="1"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm instId="1"/>
      </tapa.expect>

      #Sending RGR ENB Configuration
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.enb instId="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

     
      #Scheduler Cell Configuration

      #Sending RGR CELL Configuration for cell 1
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" spId="0" maxDlRetxBw="100" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" cellId="3" macInst="0"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Sending RGR CELL Configuration for cell 2
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" spId="1" maxDlRetxBw="100" numCmnLc="5" numTxAntPorts="4"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:3:5:1:1:3:0" cellId="4" macInst="1"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>



      ### cell init end
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="334" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" riEna="FALSE" riCfgIdx="1"  cqiPResIdx="555" />
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"  cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Pcell CQI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell RI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell CQI.
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.27
#
#       Desc:   DL CQI report verification: Similar report types collide 
#               smaller scell idx is selected for cqi reception
#               1. PCELL CQI CFG: off 3 prd 40 SB
#               2. SCELL CQI CFG: off 3 prd 20 WB
#               3. Collision at 8,3, SCELL given prio over PCELL
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

	  #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>
      

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     #Scell is not yet activated
     # <tapa.expset>
     #<tapa.tfu.recp.req  instId="5" spId="0">
     #   <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     #</tapa.tfu.recp.req>   
     # </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Scell is not yet activated
      #Send Raw CQI Indication 
      #<tapa.send >
      #   <tapa.tfu.rawdlcqi.ind>
      #      <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
      #   </tapa.tfu.rawdlcqi.ind>
      #</tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## SCELL given prio over PCELL n2 resource of SCELL used
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>




      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.28
#
#       Desc: Testing wrap around case in Compare Cqi prio where next Cqi tr is less than Current SF IDX
#              DL CQI report verification: Similar report types collide 
#               smaller scell idx is selected for cqi reception
#               1. PCELL CQI CFG: off 3 prd 20 SB
#               2. SCELL CQI CFG: off 3 prd 40 WB
#               3. Collision at 8,3, SCELL given prio over PCELL
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="240" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

	  #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>



      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.29
#
#       Desc:   "To verify negative confirmation from MAC when CellId is wrong
#                in Add ScellUeCfg"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify negative confirmation from MAC when cellId is wrong
         in Add ScellUeCfg
      </tapa.desc>

      <tapa.longdesc>
         To verify negative confirmation from MAC when cellId is wrong
         in Add ScellUeCfg
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>
<!--
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>
-->

      #Initialize 1 UE on First instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" sCellId="3" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="1"/>
      </tapa.send>
      # At start of this step, we are at (1,1)
      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      # steps for data on each UE
      <tapa.delay delay="1"/>      
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.30
#
#       Desc:   "To verify negative confirmation from MAC when CellId is wrong
#                in Add ScellUeCfg"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify negative confirmation from MAC when cellId is wrong
         in Add ScellUeCfg
      </tapa.desc>

      <tapa.longdesc>
         To verify negative confirmation from MAC when cellId is wrong
         in Add ScellUeCfg
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>
   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

<!--
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE"/>
-->

      #Initialize 1 UE on First instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" sCellId="3" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="1"/>
      </tapa.send>
      # At start of this step, we are at (1,1)
      # Expect failure in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      # steps for data on each UE
      <tapa.delay delay="1"/>      
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.31
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
         n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
         # Send BO for the created logical channel on RGU.lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


     
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.32
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  riEna="TRUE" riCfgIdx="1"  
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

	  #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>




      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="8000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>


#
#       Test:    37.33
#
#       Desc:   DL Scheduling on PCELL(1Tb) and SCELL(2Tb) using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UePerCellInit ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  riEna="TRUE" riCfgIdx="1"  
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

	  #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
    <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="6000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"   />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
   <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.34
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      # Add UE Scell at MAC and SCH
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
     
     # Activate Scell
     <tapa.send>
        <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
   <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="16" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE" />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


     
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.35
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               NACK on PCELL and ACK on SCELL         
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      #Add Scell at MAC and SCH
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      # Activate Scel
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      #passing till here
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

<!--
      # Expect Format1A 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" chkSdu="TRUE"
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         # Send TFU_DELTA(for transmission) + 4 (for fdbk to PHY)+
         # - TFU_DELTA Ttis to expect harqrecp req from MAC.
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      # Send ACK for TB1 and NACK for TB2 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" isTb2="TRUE" isAckTb2="TRUE"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>
-->
    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.36
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               ACK on PCELL and NACK on SCELL         
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>
      
      #activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#was here

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
#passing till here
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Format1A 
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.37
#
#       Desc:   DL Scheduling only on SCELL using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling only on SCELL using RR Sched Type
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling only on SCELL using RR Sched Type
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      <tapa.rg.multiInst1UeOnFirstCell ueId="1" uniqueRntiVldt="FALSE"/>

      # Adding Scell for Ue Id =0
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4"/>

<!--
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue newUeId="0" oldUeId="0" cellId="3" sCellId="4" 
            isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="0"/>
      </tapa.expect>
      -->
      # Adding Scell for Ue Id =1
      <tapa.rg.addSecCell oldUeId="1" newUeId="1" ueId="1" cellId="3" sCellId="4"/>
<!--
      <tapa.send>
         <tapa.crg.cfgreq.recfg.ue newUeId="1" oldUeId="1" cellId="3" sCellId="4" 
            isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="1"/>
      </tapa.expect>
    -->  
      
      # activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Steps for BO Updation
 
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>     

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 2nd Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.38
#
#       Desc:   DL Scheduling on Pcell(1Tb) and Scell(1Tb) with CQI Collision on PCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on Pcell(1Tb) and Scell(1Tb) with CQI Collision on PCell using RR Sched Type
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on Pcell(1Tb) and Scell(1Tb) with CQI Collision on PCell using RR Sched Type
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"
         sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" sCellId="4" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
         n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="0" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for harq recp req
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Harq Recp Req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="14" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Harq Recp Req
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expset>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.39
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               DTX on PCELL and DTX on SCELL         
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#was here

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
#passing till here
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset> 
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
<!--
     # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     -->

      #passing till here
       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>
    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.40
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               NACK on PCELL and NACK on SCELL         
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.40">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#was here

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
#passing till here
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
 
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 




#
#       Test:    37.41
#
#       Desc:   DL Scheduling of SPS OCC on PCELL(1Tb) and SCELL(2Tb) using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.41">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit />
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" DLSPSMaxBw = "10"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"  ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"
         riEna="TRUE" riCfgIdx="1" txModeEnum="RGR_UE_TM_3"/>
      
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="80"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  riEna="TRUE" riCfgIdx="1"  
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>
     
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


##8,7
#### SPS LC Config

      <tapa.send>
# Configure a dedicated SPS logical channel for the created UE  
# lcType=5 for DCCH (cm_lte.h) at MAC
      <tapa.crg.cfgreq.cfg.lch instId="0" ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
# Expect success in cfg cfm
      <tapa.crg.cfgcfm status="0" instId="0"/>
      </tapa.expect>

      <tapa.send>
# Create DL SPS service for the UE at scheduler
      <tapa.rgr.cfgreq.cfg.lch  instId="5" spId="0"  ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
      DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#expect config Cfm
      <tapa.expect>
      <tapa.rgr.cfgCfm status = "0"  instId="5" spId="0"/>
      </tapa.expect>




#FIRST BO sched dynamically  
      <tapa.send>
# Send BO for the created SPS service on RGU 
      <tapa.rgu.dstarsp  instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service 
      <tapa.rgu.dstaind  instId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq  instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#PDCCH and PDSCH for FIRST BO
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1"  macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="FALSE" DLSPSInit="FALSE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#HQ FDBK for FIRST BO
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

# Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# ACK sent for First BO
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="5" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#Second BO Upd sent with in 20 TTIs
      <tapa.send>
# Send BO for the created SPS service on RGU again
      <tapa.rgu.dstarsp instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

#SPS Activation from to be actvd list succeeds in the next TTI

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.rgu.dstaind instId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req  ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="TRUE" DLSPSInit="TRUE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>




      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" schInstId="5" spId="0">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="11" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



### After SPS Activation SPS OCC and BO collision
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="3" bo="20"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="3" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="3"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="2" validate="TRUE"   />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>




#
#       Test:    37.42
#
#       Desc:   DL Scheduling of SPS OCC on PCELL(1Tb) and SCELL(1Tb) using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.42">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit />
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" DLSPSMaxBw = "10"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"  ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSpsExpltRelCnt="2" DLSPSSchIntrv="20" NumSPSProc="4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3"  prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1" txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4"
      n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="80"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  riEna="TRUE" riCfgIdx="1"  
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>
     ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="FALSE" numSCells="1" sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
         prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
         txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


##8,7
#### SPS LC Config

      <tapa.send>
# Configure a dedicated SPS logical channel for the created UE  
# lcType=5 for DCCH (cm_lte.h) at MAC
      <tapa.crg.cfgreq.cfg.lch instId="0" ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
# Expect success in cfg cfm
      <tapa.crg.cfgcfm status="0" instId="0"/>
      </tapa.expect>

      <tapa.send>
# Create DL SPS service for the UE at scheduler
      <tapa.rgr.cfgreq.cfg.lch  instId="5" spId="0"  ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
      DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#expect config Cfm
      <tapa.expect>
      <tapa.rgr.cfgCfm status = "0"  instId="5" spId="0"/>
      </tapa.expect>




#FIRST BO sched dynamically  
      <tapa.send>
# Send BO for the created SPS service on RGU 
      <tapa.rgu.dstarsp  instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service 
      <tapa.rgu.dstaind  instId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq  instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#PDCCH and PDSCH for FIRST BO
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1"  macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="FALSE" DLSPSInit="FALSE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#HQ FDBK for FIRST BO
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

# Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# ACK sent for First BO
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="5" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#Second BO Upd sent with in 20 TTIs
      <tapa.send>
# Send BO for the created SPS service on RGU again
      <tapa.rgu.dstarsp instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

#SPS Activation from to be actvd list succeeds in the next TTI

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.rgu.dstaind instId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="TRUE" DLSPSInit="TRUE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>




      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" schInstId="5" spId="0">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="11" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



### After SPS Activation SPS OCC and BO collision
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="3" bo="20"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="3" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="3"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="2" validate="TRUE"   />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.43
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#               ACK  PCell NACK SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>

      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.44
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#               (ACK,NACK)  PCell (NACK) SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" lcIdTb2="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="FALSE" isTb2="TRUE" chkSduTb2="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>
 
      </tapa.expset>

<!--
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    -->
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.45
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#               NACK PCell NACK SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.45">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>
 
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.46
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#               NACK PCell ACK SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
      txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
<tapa.send>
   <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="22" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="1"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>
 
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.47
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 2 TB NACKED and Secondary 2TB Acked 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
            sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  
            prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" 
            cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
            txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" 
            schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="8000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>



#
#       Test:    37.48
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 2 TB ACKED and Secondary 2TB NACKED 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3"  prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
            sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  
            prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" 
            cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
            txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" 
            schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="8000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.delay delay="1"/>    
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>


#
#       Test:    37.49
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 2nd TB NACKED and Secondary 2nd TB NACKED, both First TB
#               of both Primary and Secondary Acked
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.49">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
                  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
                  cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
                  txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
                  n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
            sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  
            prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" 
            cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
            txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" 
            schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="8000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0:1:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="FALSE" isTb2="TRUE"
              transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="FALSE"/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="FALSE" isTb2="TRUE"
               transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.50
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 1st TB NACKED and Secondary 1st TB NACKED, and both
#               Second TB of both Primary and Secondary Acked
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.50">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3"  prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
                  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
                  cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
                  txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
                  n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
            sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  
            prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" 
            cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
            txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" 
            schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="8000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="1"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:1:0:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
       <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="FALSE"
               transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" 
              vldDciFrmt="TRUE" isFormat1a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="FALSE" vldtRetx="FALSE"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="FALSE"
              transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" 
              vldDciFrmt="TRUE" isFormat1a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="FALSE" vldtRetx="FALSE"/>
       </tapa.tfu.cntrl.req>
      </tapa.expset>

     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.51
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 2nd TB NACKED and Secondary 1st TB NACKED, and 
#               Secondry TB of both Primary and Secondary 2nd Acked
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.51">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/> 

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3"  prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
                  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
                  cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
                  txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
                  n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

<!--
     ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
            sCellIdx="1" sCellId="4" instId="5" ueId="0" cellId="3"
            prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"  
            prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" 
            cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  
            txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" 
            schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="10000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0:0:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="FALSE" isTb2="TRUE"
              transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="FALSE" isTb2Pres="TRUE" vldtRetx="FALSE"/>
       </tapa.tfu.cntrl.req>
       <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="FALSE"
               transMode="TFU_UE_TM_3"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" 
              vldDciFrmt="TRUE" isFormat1a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="FALSE" vldtRetx="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>


     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.52
#
#       Desc:   Verify that Ue Reset and SCH and UeId change happens
#               successfully at SCH, PMAC and all SMACs when there is
#               data from RLC to PMAC and SMAC. SCH should flush the control
#               once it receives Ue Reset from APP
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that Ue Reset and SCH and UeId change happens successfully at
         SCH, PMAC and all SMACs when there is data from RLC to PMAC and SMAC
      </tapa.desc>

      <tapa.longdesc>
         Verify that Ue Reset and SCH and UeId change happens successfully at
         SCH, PMAC and all SMACs when there is data from RLC to PMAC and SMAC
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" sCellId="4" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
         n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
<!--
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" cellId="3" sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>  
         <tapa.rgr.actDeact.scell ueId="0" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for harq recp req
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Harq Recp Req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
     
     # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" InstId="5"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" InstId="0"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
    
     # Do rach for reestablishmnet
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="FALSE" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
      #Added this since CRG UE Reset is dummy which is not clearing UE's HARQ 
      #Proc after reset
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId='0' validate="TRUE" />
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req raRnti="8" saveTo="1" />
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0">
            <tapa.tfu.msg3.recp.req validate="FALSE" vldtRbOvrlap="1" ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>
  
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind  macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" ueId="1" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3" ueId="1"/>
      </tapa.expect>
     
     <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE ReConfiguration existing oldrnti as newrnti at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" newUeId="1" oldcrnti="11" newcrnt="12" UeReCfgType="0" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm/>
      </tapa.expect>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.53
#
#       Desc:   Verify that SCell is getting activated successfully after Ue
#               Reset and UeId change at SCH and MAC
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.53">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that SCell is getting activated successfully after Ue
         Reset and UeId change at SCH and MAC
      </tapa.desc>

      <tapa.longdesc>
          Verify that SCell is getting activated successfully after Ue
          Reset and UeId change at SCH and MAC
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" sCellId="4" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
         n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

<!--
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue ueId="0" cellId="3" sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="1" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm ueId="0"/>
      </tapa.expect>
      -->
      
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="0" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for harq recp req
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Harq Recp Req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # 18 TTIs for activation delay
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

<!--
      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>
      -->
     
     # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" InstId="5"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" InstId="0"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
    
     # Do rach for reestablishmnet
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="FALSE" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

<!--
      #Added this since CRG UE Reset is dummy which is not clearing UE's HARQ 
      #Proc after reset
      <tapa.expect>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId='0' validate="TRUE" />
        </tapa.tfu.dat.req>
      </tapa.expect>
     
     <tapa.expect>
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId='0' validate="TRUE" />
        </tapa.tfu.dat.req>
      </tapa.expect>
 -->
   
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req raRnti="8" saveTo="1" />
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0">
            <tapa.tfu.msg3.recp.req validate="FALSE" vldtRbOvrlap="1" ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>
  
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind  macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" ueId="1" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3" ueId="1"/>
      </tapa.expect>
    
    <!--
     <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>
      -->

      # Send UE ReConfiguration existing oldrnti as newrnti at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" newUeId="1" oldcrnti="11" newcrnt="12" UeReCfgType="0" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm/>
      </tapa.expect>
  
      # adding some delay for LC for UeId change for PMAC to SMAC
      <tapa.delay delay="1"/>      
# Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp instId="0" cellId="3" ueId="1" spId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind instId="0" cellId="3" ueId="1" suId="0" lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq instId="0" spId="0" cellId="3" ueId="1" lcId="4" lcType="3" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect Msg4 from MAC to PHY.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. 
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK as feedback for Msg4. 
     <tapa.send>
        <tapa.tfu.hq.ind schInstId="5" suId="0" cellId="3" hqInds="1">
          <tapa.tfu.hq ueId="1" />
       </tapa.tfu.hq.ind>   
     </tapa.send>

	 #Send Ready Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="1"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>

     # Activate SCell to check if Scell is getting activated successfully
     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req ueId="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      # Send TTI indication for waiting for harq recp req
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect Harq Recp Req
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      # 18 TTIs for activation delay
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

<!--
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
-->
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.delay delay="2"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.54
#
#       Desc:   Verify that PMAC does not send UeId change to SMACs if Scell
#               addition is not done. PMAC should do UeId change for itself
#               and sends successful idication to SCH
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.54">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          Verify that PMAC does not send UeId change to SMACs if Scell
          addition is not done. PMAC should do UeId change for itself
          and sends successful idication to SCH
      </tapa.desc>

      <tapa.longdesc>
         Verify that PMAC does not send UeId change to SMACs if Scell
         addition is not done. PMAC should do UeId change for itself
         and sends successful idication to SCH
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

     # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" InstId="5"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" InstId="0"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
    
     # Do rach for reestablishmnet
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="FALSE" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req raRnti="8" saveTo="1" />
        </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0">
            <tapa.tfu.msg3.recp.req validate="FALSE" vldtRbOvrlap="1" ueId="1" />
         </tapa.tfu.recp.req>
      </tapa.expect>
  
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
      
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind  macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" ueId="1" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   

      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3" ueId="1"/>
      </tapa.expect>
     
     <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE ReConfiguration existing oldrnti as newrnti at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  cellId="3" oldUeId="0" newUeId="1" />
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm/>
      </tapa.expect>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.55
#
#       Desc:   To test explicit deactivation of Scell - with adding Scell and also activating it
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.55">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test explicit deactivation of Scell - with adding Scell and also activating it
      </tapa.desc>

      <tapa.longdesc>
         To test explicit deactivation of Scell - with adding Scell and also activating it
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               #<tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="255" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell deact ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.56
#
#       Desc:    To test explicit deactivation of Scell - with adding Scell but not activating it
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test explicit deactivation of Scell - with adding Scell but not activating it
      </tapa.desc>

      <tapa.longdesc>
         To test explicit deactivation of Scell - with adding Scell but not activating it
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.57
#
#       Desc:    To test explicit deactivation of Scell - without adding Scell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.57">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test explicit deactivation of Scell - without adding Scell
      </tapa.desc>

      <tapa.longdesc>
         To test explicit deactivation of Scell - without adding Scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.58
#
#       Desc:    To Retransmit MAC ActDeact CE if NACK is received for Deactivation CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.58">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To Retransmit MAC ActDeact CE if NACK is received for Deactivation CE
      </tapa.desc>

      <tapa.longdesc>
         To Retransmit MAC ActDeact CE if NACK is received for Deactivation CE
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="255" validate1B="TRUE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # NACK sent for scell deact ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.59
#
#       Desc:    To Retransmit MAC ActDeact CE if DTX is received for Deactivation CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.59">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To Retransmit MAC ActDeact CE if DTX is received for Deactivation CE
      </tapa.desc>

      <tapa.longdesc>
         To Retransmit MAC ActDeact CE if DTX is received for Deactivation CE
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     #DTX case
     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.60
#
#       Desc:   To test CQI on Scell after deactivation:
#               DL CQI report verification: PCELL and SCELL occasions dont collide, 
#               reception req is sent for both PCELL and SCELL at their occasions.
#               1. PCELL CQI CFG: off 3 prd 20 WB
#               2. SCELL CQI CFG: off 4 prd 40 SB
#               3. No collision
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.60">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test CQI on Scell after deactivation
      </tapa.desc>

      <tapa.longdesc>
         To test CQI on Scell after deactivation
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2" cqiPResIdx="666"/>
      

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #8,1 - PCell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #8,2 - SCell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #9,1
      # ACK sent for scell deact ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #10,1
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      #No Reception request for Scell at 12,2 as it is already deactivated

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.61
#
#       Desc:    To test Scell delete after Scell added, activated and deactivated
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.61">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test Scell delete after Scell added, activated and deactivated
      </tapa.desc>

      <tapa.longdesc>
         To test Scell delete after Scell added, activated and deactivated
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell deact ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.62
#
#       Desc:    To test Scell delete after Scell added and activated
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.62">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test Scell delete after Scell added
      </tapa.desc>

      <tapa.longdesc>
         To test Scell delete after Scell added
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.63
#
#       Desc:    To test Scell delete after Scell added but not activated
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.63">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test Scell delete after Scell added
      </tapa.desc>

      <tapa.longdesc>
         To test Scell delete after Scell added
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.64
#
#       Desc:   To test CQI on Scell after deletion: PCELL and SCELL occasions dont collide, 
#               reception req is sent for both PCELL and SCELL at their occasions.
#               1. PCELL CQI CFG: off 3 prd 20 WB
#               2. SCELL CQI CFG: off 4 prd 40 SB
#               3. No collision
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.64">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test CQI on Scell after deletion
      </tapa.desc>

      <tapa.longdesc>
         To test CQI on Scell after deletion
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="41"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD20" cqiRepType="2" cqiPResIdx="666"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="20"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #8,1 - PCell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #8,2 - SCell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #9,1
      # ACK sent for scell deact ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

     # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #10,1 - PCell
      <tapa.expset>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>
     
      #No Reception request for Scell at 12,2 as it is already deactivated

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.65
#
#       Desc:   To test deactivation timer expiry for Scell - with adding Scell and also activating it
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.65">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test deactivation timer expiry for Scell - with adding Scell and also activating it
      </tapa.desc>

      <tapa.longdesc>
         To test deactivation timer expiry for Scell - with adding Scell and also activating it
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for deactivation timer expiry
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="200" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.66
#
#       Desc:   "Failure handling in MAC: Verify that PMAC sends negative
#                confirmation to RRC when Ue SCell config add is sent with
#                wrong Ue Id"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.66">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that PMAC sends negative confirmation to RRC when Ue SCell
         config add is sent with wrong Ue Id
      </tapa.desc>

      <tapa.longdesc>
          Verify that PMAC sends negative confirmation to RRC when Ue SCell
          config add is sent with wrong Ue Id
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="1" cellId="3" status="15"/>

      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.67
#
#       Desc:   "Failure handling in MAC: Verify that PMAC sends negative
#                confirmation to RRC when Ue SCell config add is sent with
#                wrong cellId on CRG interface
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.67">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that PMAC sends negative confirmation for RRC when Ue SCell
         config add is sent with wrong cell Id
      </tapa.desc>

      <tapa.longdesc>
          Verify that PMAC sends negative confirmation for RRC when Ue SCell
          config add is sent with wrong cell Id
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="4" status="15"/>

      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.68
#
#       Desc:   "Failure handling in MAC: Verify that PMAC sends negative
#                confirmation to RRC when Ue SCell config add is sent with
#                wrong macInst on CRG interface
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.68">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that PMAC sends negative confirmation for RRC when Ue SCell
         config add is sent with wrong macInst on CRG interface
      </tapa.desc>

      <tapa.longdesc>
          Verify that PMAC sends negative confirmation to RRC when Ue SCell
          config add is sent with wrong macInst on CRG interface
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

       ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
        sCellIdx="1" sCellId="4"  instId="5"
        pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      </tapa.send>


      <tapa.send>
      <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #Add UE to the Seconday Cell which calls rgAddSCellCfg
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
      macInst="2" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
      <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      <tapa.delay delay="2"/>
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.69
#
#       Desc:   "Failure handling in MAC: Verify that PMAC sends negative
#                confirmation to RRC when Ue SCell config add is sent with
#                wrong rguUlSapId/rguDlSapId on CRG interface
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.69">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that PMAC sends negative confirmation for RRC when Ue SCell
         config add is sent with wrong rguUlSapId/rguDlSapId on CRG interface
      </tapa.desc>

      <tapa.longdesc>
          Verify that PMAC sends negative confirmation to RRC when Ue SCell
          config add is sent with wrong rguUlSapId/rguDlSapId on CRG interface
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

       ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
        sCellIdx="1" sCellId="4"  instId="5"
        pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      </tapa.send>


      <tapa.send>
      <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #Add UE to the Seconday Cell which calls rgAddSCellCfg
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
      macInst="1" rguUlSapId="7" rguDlSapId="7"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
      <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>
      <tapa.delay delay="2"/>
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.70
#
#       Desc:   "Failure handling in MAC: Verify that PMAC sends negative
#                confirmation to APP when Ue SCell config add is sent with
#                wrong SCellID on RGR interface
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.70">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that PMAC sends negative confirmation for APP when Ue SCell
         config add is sent with wrong SCellID on RGR interface
      </tapa.desc>

      <tapa.longdesc>
       Verify that PMAC sends negative confirmation for APP when Ue SCell
       config add is sent with wrong SCellID on RGR interface
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

       ## Recfg req for adding sec cell
      <tapa.send>
      <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1"
        sCellIdx="1" sCellId="8"  instId="5"
        pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      </tapa.send>


      <tapa.send>
      <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.rgr.cfgCfm status="15"/>
      </tapa.expect>

      #Add UE to the Seconday Cell which calls rgAddSCellCfg
      <tapa.send>
      <tapa.crg.cfgreq.recfg.ue sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
      macInst="1" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
      <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>
      <tapa.delay delay="2"/>
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.71
#
#       Desc:    Failure handling: Verify that APP Sends Ue SCell add Roll back
#                to SCH via RGR interface and SCH send +ve confirmation to APP
#                via RGR interface when RRC sends -ve confirmation to APP via
#                CRG interface for any failure during SCell config add
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.71">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that APP Sends Ue SCell add Roll back to SCH via RGR interface
         and SCH send +ve confirmation to APP via RGR interface when RRC sends
         -ve confirmation to APP via CRG interface for any failure during SCell
         config add
      </tapa.desc>

      <tapa.longdesc>
         Verify that APP Sends Ue SCell add Roll back to SCH via RGR interface
         and SCH send +ve confirmation to APP via RGR interface when RRC sends
         -ve confirmation to to APP via CRG interface for any failure during
         SCell config add
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
     
      ## Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" 
            sCellIdx="1" sCellId="4"  instId="5"
            pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
            n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      #Add UE to the Seconday Cell which calls rgAddSCellCfg 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.ue sCellId="4" isSCellCfgPres="TRUE" numSCells="1"
                  macInst="2" rguUlSapId="0" rguDlSapId="0"/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.crg.cfgcfm status="15"/>
      </tapa.expect>

      <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.72
#
#       Desc:   DL Scheduling on PCELL(2TB) and SCELL(1TB) using RR Sched Type (A=3)
#               ACK  PCell NACK SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.72">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0" riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1" isFormat1a="TRUE"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
            validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>


      # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>

         #TX data for P-cell
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0" isFormat2a="TRUE"
            isTb1Pres="TRUE" isTb2Pres="TRUE" />
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
            transMode="TFU_UE_TM_3" isTb1="TRUE" isTb2="TRUE" chkSdu="TRUE"
            chkGrant="FALSE"/>
      	</tapa.tfu.dat.req>

         #Retx Data for S-cell
         <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.hq.recp.req ueId="0" />
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for Scell 
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
           <tapa.tfu.hq isAck="TRUE" />
        </tapa.tfu.hq.ind>   
      </tapa.send>

    
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.73
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type
#               when UE is in on-duration period.            
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.73">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Data should be scheduled when UE is in on duration
      </tapa.desc>

      <tapa.longdesc>
         Data should be scheduled when UE is in on duration
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="10"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>  

#
#       Test:    37.74
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type
#               when UE is in on-duration period. Later verify the DRX HARQ RTT 
#               and RETX timer functionality for both PCELL and SCELL if NACK is
#               recived for the data sent through PCELL and SCELL.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.74">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Retx Data should be scheduled after HARQ RTT expire and 
         HARQ Retx timer is running
      </tapa.desc>

      <tapa.longdesc>
         Retx Data should be scheduled after HARQ RTT expire and 
         HARQ Retx timer is running
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="10"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     # Retx  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
         # Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset> 


     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>       

#
#       Test:    37.75
#
#       Desc:    Data is Scheduled from SCELL if Inactivity timer is running
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.75">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Data is scheduled from primary cell and Inactivity timer is started.
         2. Now send data from secondary cell before Inactivity timer expiry.
         3. Data should be scheduled at secondary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Data is scheduled from primary cell and Inactivity timer is started.
         2. Now send data from secondary cell before Inactivity timer expiry.
         3. Data should be scheduled at secondary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="10"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.multiInst1UeOnFirstCell ueId="1" uniqueRntiVldt="FALSE"/>

      # Adding Scell for Ue Id =0
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4"/>

      # Adding Scell for Ue Id =1
      <tapa.rg.addSecCell oldUeId="1" newUeId="1" ueId="1" cellId="3" sCellId="4"/>
      
      # activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on Primary cell for UE 0
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req> 
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on secondary cell for UE 0
      #Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="80"/>
      </tapa.send>
      #Steps for BO Updation

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="80"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>     

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 2nd Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
        </tapa.tfu.dat.req> 

        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
        </tapa.tfu.dat.req> 
     </tapa.expset>         

     <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>  

#
#       Test:    37.76
#
#       Desc:    Data is not Scheduled from SCELL if Inactivity timer is expired
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.76">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Data is scheduled from primary cell and Inactivity timer is started.
         2. Now send data from secondary cell after Inactivity timer expiry.
         3. Data should not be scheduled at secondary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Data is scheduled from primary cell and Inactivity timer is started.
         2. Now send data from secondary cell after Inactivity timer expiry.
         3. Data should not be scheduled at secondary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="2"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="5" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.multiInst1UeOnFirstCell ueId="1" uniqueRntiVldt="FALSE"/>

      # Adding Scell for Ue Id =0
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4"/>

      # Adding Scell for Ue Id =1
      <tapa.rg.addSecCell oldUeId="1" newUeId="1" ueId="1" cellId="3" sCellId="4"/>
      
      # activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="22" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on Primary cell for UE 0
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req> 
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on secondary cell for UE 0 after Inactivity timer expiry.
      #Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>     

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
        </tapa.tfu.dat.req> 
     </tapa.expset>         

     <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   

#
#       Test:    37.77
#
#       Desc:    Data is Scheduled from PCELL if Inactivity timer is running
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.77">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Data is scheduled from secondary cell and Inactivity timer is started.
         2. Now send data from primary cell before Inactivity timer expiry.
         3. Data should be scheduled at primary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Data is scheduled from secondary cell and Inactivity timer is started.
         2. Now send data from primary cell before Inactivity timer expiry.
         3. Data should be scheduled at primary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="10"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.multiInst1UeOnFirstCell ueId="1" uniqueRntiVldt="FALSE"/>

      # Adding Scell for Ue Id =0
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4"/>

      # Adding Scell for Ue Id =1
      <tapa.rg.addSecCell oldUeId="1" newUeId="1" ueId="1" cellId="3" sCellId="4"/>
      
      # activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on secondary cell for UE 0
      #Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="80"/>
      </tapa.send>
      #Steps for BO Updation

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>     

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 2nd Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
        </tapa.tfu.dat.req> 

        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
        </tapa.tfu.dat.req> 
     </tapa.expset>          

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send> 

#Send Data on Primary cell for UE 0
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req> 
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   

#
#       Test:    37.78
#
#       Desc:    Data is not Scheduled from PCELL if Inactivity timer is expired
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.78">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Data is scheduled from secondary cell and Inactivity timer is started.
         2. Now send data from primary cell after Inactivity timer expiry.
         3. Data should not be scheduled at primary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Data is scheduled from secondary cell and Inactivity timer is started.
         2. Now send data from primary cell after Inactivity timer expiry.
         3. Data should not be scheduled at primary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "4" drxInactvTmr="2"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="5" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.multiInst1UeOnFirstCell ueId="1" uniqueRntiVldt="FALSE"/>

      # Adding Scell for Ue Id =0
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4"/>

      # Adding Scell for Ue Id =1
      <tapa.rg.addSecCell oldUeId="1" newUeId="1" ueId="1" cellId="3" sCellId="4"/>
      
      # activate Scell
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.send>
        <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for both  Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="22" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#Send Data on secondary cell for UE 0 
      #Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="80"/>
      </tapa.send>
      #Steps for BO Updation

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>     

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
        </tapa.tfu.dat.req> 

        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>  
     </tapa.expset>          

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send> 

#Send Data on Primary cell for UE 0 after Inactivity timer expiry 
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="40"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>    

#
#       Test:    37.79
#
#       Desc:    Data is scheduled from SCELL if HARQ Retx timer is running.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.79">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Send Data through primary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at primary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through secondary cell before Retx timer expiry.
         4. Data should be scheduled at secondary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Send Data through primary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at primary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through secondary cell before Retx timer expiry.
         4. Data should be scheduled at secondary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "2" drxInactvTmr="8"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              #<tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:1"/>
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     #Send BO for UE1 on instance 0
     <tapa.send>
        # Send BO for the created logical channel on RGU. 
        <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="600"/>
     </tapa.send>               

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" spId="1"/>
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4" spId="1"/>
       </tapa.send> 

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     # Retx  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>  
      </tapa.expset> 

     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>        

#
#       Test:    37.80
#
#       Desc:    Data is scheduled from PCELL if HARQ Retx timer is running.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.80">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Send Data through secondary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at secondary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through primary cell before Retx timer expiry.
         4. Data should be scheduled at primary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Send Data through secondary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at secondary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through primary cell before Retx timer expiry.
         4. Data should be scheduled at primary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "2" drxInactvTmr="6"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              #<tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0"/>
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     #Send BO for UE1 on instance 0
     <tapa.send>
        # Send BO for the created logical channel on RGU. 
        <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="600"/>
     </tapa.send>               

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1"/>
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send> 

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     # Retx  
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
        </tapa.tfu.cntrl.req>

        <tapa.tfu.dat.req macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
        </tapa.tfu.dat.req>   

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset> 

     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>         

#
#       Test:    37.81
#
#       Desc:    Data is not scheduled from PCELL if HARQ Retx timer is stopped.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.81">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Send Data through secondary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at secondary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through primary cell after Retx timer expiry.
         4. Data should not be scheduled at primary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Send Data through secondary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at secondary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through primary cell after Retx timer expiry.
         4. Data should not be scheduled at primary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "2" drxInactvTmr="6"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              #<tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0"/>
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     #Send BO for UE1 on instance 0
     <tapa.send>
        # Send BO for the created logical channel on RGU. 
        <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="600"/>
     </tapa.send> 

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     # Retx  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="4" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="1" spId="1">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset> 

     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>          

#
#       Test:    37.82
#
#       Desc:    Data is not scheduled from SCELL if HARQ Retx timer is stopped.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.82">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         1. Send Data through primary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at primary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through secondary cell after Retx timer expiry.
         4. Data should not be scheduled at secondary cell.
      </tapa.desc>

      <tapa.longdesc>
         1. Send Data through primary cell and receive NACK for the same.
         2. Check HARQ RTT timer starts at primary cell and on expiry 
            the same DRX Retx timer should be started. 
         3. Send Data through secondary cell after Retx timer expiry.
         4. Data should not be scheduled at secondary cell.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "2" drxInactvTmr="6"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              #<tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:1"/>
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     #Send BO for UE1 on instance 0
     <tapa.send>
        # Send BO for the created logical channel on RGU. 
        <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="600"/>
     </tapa.send> 

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

     # Retx  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset> 

     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>           

#
#       Test:    37.83
#
#       Desc:   Verify that the DRX Hq is reset during secondary cell 
#               deactivation  
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.83">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Verify that the DRX Hq is reset during secondary cell 
         deactivation  
      </tapa.desc>

      <tapa.longdesc>
         Verify that the DRX Hq is reset during secondary cell 
         deactivation  
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" 
             UeReCfgType="131072" isDrxEnabled="TRUE" drxOnDurTmr = "2" drxInactvTmr="6"
             drxRetxTmr="2" longDrxCycle="40" isShortDrxPrsnt="TRUE" shortDrxCycle="8" drxShortCycleTmr="4" drxStartOffst="2" instId="5"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset> 

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="600"/>
      </tapa.send>

       #Send Deactivation Request for SCELL
       <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="3"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      # Now we cannot schedule on Scell, after sending DeAct CE
     <!--
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req> 

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
         </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # ACK sent for scell deact ce
     # Send NACK for the received PDU on SCELL
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for default cell
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>


     # Retx will not happen through SCEll due to deactivation  
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
      </tapa.expset> 
      -->

     <tapa.delay delay="1"/>      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.84
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Ue Total bits pet tti check(Tx Tx) 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.84">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" maxDlBwPerUe="100"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3" maxDlBwPerUe="100"/>
      
      #Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure an AMBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="6" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Configure an AMBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="6" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
#      <tapa.send>
#         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
#      </tapa.send>

#      <tapa.expect>
#         # Expect success in cfg cfm
#         <tapa.crg.cfgcfm instId="0"/>
#      </tapa.expect>

#      # Configure DL LC on RGR
#      <tapa.send>
#         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
#      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

 #     <tapa.expect>
 #        # Expect success in cfg cfm
 #        <tapa.rgr.cfgCfm instId="5" spId="0"/>
 #     </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="8000"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="5000"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="6" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" 
            numLchTb2="2" lchTb2Data="1:5" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="5" 
            numLchTb2="1" lchTb2Data="5" valdtTrue="1" />
      </tapa.expset>

<!--
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="1"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.dat.req>

        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" 
              vldDciFrmt="TRUE" isFormat2a="TRUE"
             isTb1Pres="TRUE" isTb2Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
-->

     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.85
#
#       Desc:   DL Scheduling on PCELL(2Tb) and SCELL(2Tb) using RR Sched Type
#               Primary 2 TB ACKED and Secondary 2TB NACKED 
#               Ue Total bits pet tti check(Tx Retx) 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.85">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit />
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" maxDlBwPerUe="100"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3"/> 
      
      #Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure an AMBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="6" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Configure an AMBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 7 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="6" dir="1" lcType="4"
            dlQci="7" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
 
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" 
               chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
#      <tapa.send>
#         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
#      </tapa.send>

#      <tapa.expect>
#         # Expect success in cfg cfm
#         <tapa.crg.cfgcfm instId="0"/>
#      </tapa.expect>

#      # Configure DL LC on RGR
#      <tapa.send>
#         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
#      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#      <tapa.expect>
#         # Expect success in cfg cfm
#         <tapa.rgr.cfgCfm instId="5" spId="0"/>
#      </tapa.expect>
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0" 
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  
               rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="12000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" 
            numLchTb2="1" lchTb2Data="1" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="1" 
            numLchTb2="1" lchTb2Data="1" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="1"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
          <tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"
             transMode = "TFU_UE_TM_3" numTb1Lyrs="1"  />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4"
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" 
               validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     #<tapa.send>
     #   <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
     #         <tapa.tfu.hq ueId="0"/>
     #   </tapa.tfu.hq.ind>   
     #</tapa.send>

      #Send NACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="0" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for p_cell fot Tx
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="11000"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="6" bo="1000"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Because of Scell Retx some bits get reserved for the UE,
      #so only LC-5 got scheduled 
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" 
            numLchTb2="1" lchTb2Data="5" valdtTrue="1" />
      </tapa.expset>
      <tapa.send>
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>


#
#       Test:    37.86
#
#       Desc:    Addition of dedicated logical channel on SCell through PRG
#                interface, and DL Scheduling on PCELL and SCELL using RR 
#                Sched Type for lcId 4 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.86">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4
      </tapa.desc>

      <tapa.longdesc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4

      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>



      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.87
#
#       Desc:    Addition of dedicated logical channel on SCell through PRG
#                interface, and DL Scheduling on PCELL and SCELL using RR
#                Sched Type for lcId 5
#
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.87">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 5

      </tapa.desc>

      <tapa.longdesc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 5

      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="5" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="5"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="5"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.88
#
#       Desc:   Reconfiguration of dedicated logical channel on SCell through PRG
#               interface, and DL Scheduling on PCELL and SCELL using RR
#               Sched Type for lcId 4
#
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.88">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Reconfiguration of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4
      </tapa.desc>

      <tapa.longdesc>
         Reconfiguration of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4

      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="2" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            <!--  <tapa.tfu.hq.recp.req/>-->
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send LC ReConfiguration for the same LC created above at CRG 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="4" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
     
      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="4"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="1"/>
       </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.89
#
#       Desc:   Deletion of dedicated logical channel on SCell through PRG
#               interface, and DL Scheduling on PCELL and SCELL using RR
#               Sched Type for lcId 4
#
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.89">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Deletion of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using
         RR  Sched Type for lcId 4
      </tapa.desc>

      <tapa.longdesc>
         Deletion of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using
         RR  Sched Type for lcId 4
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send LC Delete Request for the same LC created above at CRG. 
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send LC Delete Request for the same LC created above at RGR. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase> 

#
#       Test:    37.90
#
#       Desc:   Adding dedicated bearer with lcId 4 on SCell via PRG interface.
#               DL Scheduling on PCELL and SCELL using RR Sched Type for lcId 4.
#               delete the logical channel with lcID 4 and after deletion send
#               data on lcId 4 data. Data should not get scheduled as lcId 4 is 
#               deleted
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.90">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Adding dedicated bearer with lcId 4 on SCell via PRG interface.
         DL Scheduling on PCELL and SCELL using RR Sched Type for lcId 4.
         delete the logical channel with lcID 4 and after deletion send
         data on lcId 4 data. Data should not get scheduled as lcId 4 is 
         deleted
      </tapa.desc>

      <tapa.longdesc>
         Adding dedicated bearer with lcId 4 on SCell via PRG interface.
         DL Scheduling on PCELL and SCELL using RR Sched Type for lcId 4.
         delete the logical channel with lcID 4 and after deletion send
         data on lcId 4 data. Data should not get scheduled as lcId 4 is 
         deleted
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send LC Delete Request for the same LC created above at CRG. 
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send LC Delete Request for the same LC created above at RGR. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase> 


#
#       Test:    37.91
#
#        Desc:   Adding dedicated bearer with lcId 4 on SCell via PRG interface.
#                DL Scheduling on PCELL and SCELL using RR Sched Type for lcId 4.
#                delete the logical channel with lcID 4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.91">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Adding dedicated bearer with lcId 4 on SCell via PRG interface.
         DL Scheduling on PCELL and SCELL using RR Sched Type
         for lcId 4. Delete the logical channel with lcID 4
      </tapa.desc>

      <tapa.longdesc>
         Adding dedicated bearer with lcId 4 on SCell via PRG interface.
         DL Scheduling on PCELL and SCELL using RR Sched Type
         for lcId 4. Delete the logical channel with lcID 4
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="2" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      # Send LC ReConfiguration for the same LC created above at CRG 
      <tapa.send>
          <tapa.crg.cfgreq.recfg.lch  cellId="3" ueId="0" lcId="4" dir="2"/>
      </tapa.send>
      # Expect success in cfg cfm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
     
      # Send LC ReConfiguration for the same LC created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lch instId="5"  cellId="3" ueId="0" lcId="4"
             dir="2"/>
      </tapa.send>
      # Send LCG ReConfiguration for the same LCG created above at RGR
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.lcg instId="5" lcgId="1"/>
       </tapa.send>

      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      # Expect success in cfg cfm from Scheduler
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      # Send LC Delete Request for the same LC created above at CRG. 
      <tapa.send>
         <tapa.crg.cfgreq.del  DelType="3" cellId="3" ueId="0" lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send LC Delete Request for the same LC created above at RGR. 
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  DelType="3" cellId="3" ueId="0"
            lcId="4" dir="3"/>
      </tapa.send>
      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.92
#
#       Desc:    Addition of dedicated logical channel on SCell through PRG
#                interface, and DL Scheduling on PCELL and SCELL using RR 
#                Sched Type for lcId 4 and lcType 4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.92">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4 and lcType 4
      </tapa.desc>

      <tapa.longdesc>
         Addition of dedicated logical channel on SCell through PRG
         interface, and DL Scheduling on PCELL and SCELL using RR
         Sched Type for lcId 4 and lcType 4

      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1"
            dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="4" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.93
#
#       Desc:   To test that the SCELL activation CE is triggered if BO is 
#               satisfied for 10 TTIs
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.93">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Cqi report verification 
      </tapa.desc>

      <tapa.longdesc>
         DL Cqi report verification 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" maxDlBwPerUe="100"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3" maxDlBwPerUe="100"/>


	#Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

	  <tapa.rg.sCellActivate />

     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.94
#
#       Desc:   To test that the SCELL is not activated algo is reset and 
#               Activation CE is not received if UE is reset/re-established
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.94">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test that the SCELL is activated based on the BO received 
      </tapa.desc>

      <tapa.longdesc>
         To test that the SCELL is activated based on the BO received
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" maxDlBwPerUe="100"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3" maxDlBwPerUe="100"/>


	#Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
     
	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

	  #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>      
	  
	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
      	
		<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>

		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="0"/>
      </tapa.send>   

	  # Send UE Reset request. Although this is send after RAR.
      # Have send this time to check the bounday condition when,
      # activation is about to happen but doesnot happened due to
      # UE RESET.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" InstId="5"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

	  # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
      </tapa.send>

      #This is uncleared DAT REQ. Control request is already cleared in rgr.uereset
      #Ideally uerest should happen later but we have done it earlier to test that SCELL Activation CE is not sent
	  <tapa.expset>
	    <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="5" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
	  <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req raRnti="8" saveTo="1" />
        </tapa.tfu.dat.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="0">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="0">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
     # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

     # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

##############################################
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0"
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      # Send UE ReConfiguration for the same UE created above for change in RNTI
       <tapa.send>
            <tapa.crg.cfgreq.recfg.ue cellId="3" oldUeId="0" newUeId="1"
              UeReCfgType="64"/>
       </tapa.send>
      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
       <tapa.expect>
            <tapa.crg.cfgcfm/>
       </tapa.expect>
      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
     </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="0">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1" spId="0">
           <tapa.tfu.hq.recp.req ueId="1"/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="5" bo="0"/>
      </tapa.send>
      # request after this TTI
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="1"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="0">
           <tapa.tfu.pdcch.cntrl.req ueId="1" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="1" />
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  # In normal call flow we send 4 TTI's to get pusch recp req at TFU, But now
      # send 3 TTI's and then send UE Reset for default UE at RGR and CRG.
      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      <tapa.expect>
      <tapa.tfu.recp.req schInstId="5" spId="0" ueId="1" >
               <tapa.tfu.recp.req spId="0" />
        </tapa.tfu.recp.req>
      </tapa.expect>
     
	  # Send UE Reset request. Although this is send after RAR.
      # Have send this time to check the bounday condition when,
      # activation is about to happen but doesnot happened due to
      # UE RESET.
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="1" InstId="5"/>
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

	  # Send UE Reset request With default Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="1" />
      </tapa.send>
      #Expect Positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect> 

     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.95
#
#       Desc:   To test that the SCell Activation CE is not received if the
#               BO is completely scheduled
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.95">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
	     To test that the SCell Activation CE is not received if the
		 BO is completely scheduled
      </tapa.desc>

      <tapa.longdesc>
         1) Send BO 8000 for 9 times so that there will be unscheduled BO
		 2) If sent 10th time the activation CE will be sent (But don't send such BO)
		 3) Send BO 80, this will be completely scheduled and counter will be reset,
		    thus no activation CE is received.
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit numTxAntPorts="2" maxDlBwPerUe="100"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_3" maxDlBwPerUe="100"/>


	#Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>
 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #Add secondary cell
      <tapa.rg.addSecCell ueId="0" cellId="3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="42"
      prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"
      txModeEnum="RGR_UE_TM_3"  pucchFormatType="RG_SCH_UCI_FORMAT1B_CS"
      n1PUCCHValTB1="1:2:3:4" n1PUCCHValTB2="6:7:8:9"/>

      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" 
            cqiPCfgIdx ="40"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  
            riEna="TRUE" riCfgIdx="1" sANCQI="TRUE" UeReCfgType="4096" 
            cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

	  #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>      
	  
	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
      	
		<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="8000"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="80"/>
      </tapa.send>   

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
        
		<tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

######################
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1" numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     <tapa.expset>
		 <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
     </tapa.expset>

	 # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
     </tapa.expset>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	  <tapa.expset>
        <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
     </tapa.expset>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	 <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	 <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="5" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.96
#
#       Desc:   To test explicit deactivation timer expiry for Scell when implicit timer as infinity
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.96">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test explicit deactivation timer expiry for Scell when implicit timer as infinity
      </tapa.desc>

      <tapa.longdesc>
         To test explicit deactivation timer expiry for Scell when implicit timer as infinity
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
	  n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" deActTmrVal="-1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for deactivation timer expiry
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3858" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

	  # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
	  # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.97
#
#       Desc:   To test explicit deactivation timer is restarted if there is any DL data
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.97">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test explicit deactivation timer is restarted if there is any DL data
      </tapa.desc>

      <tapa.longdesc>
         To test explicit deactivation timer is restarted if there is any DL data
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

	  #Add Multiple LCs
            <tapa.send>
         # Configure a dedicated logical channel (DCCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>


      # Configure DCCH on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="23" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
	  n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" deActTmrVal="-1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for deactivation timer expiry
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1000" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="5000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="5"/>
       </tapa.send>

	   #Steps for BO Updation for no data remaining
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="0"/>
      </tapa.send>
      #Steps for BO Updation

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
	  
	  # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>   

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              #<tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

	 <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3834" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="0" />
         </tapa.tfu.dat.req>
      </tapa.expset>

	  # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
	  # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
	  
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>


#
#       Test:    37.98
#
#       Desc:    Scheduling SRB should happen only on pcell
#                Send BO only for SRB 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.98">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Scheduling SRB should happen only on pcell
      </tapa.desc>

      <tapa.longdesc>
      Scheduling SRB should happen only on pcell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #SRB is scheduled only on PScell
      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="1" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      #As BO is not scheduled in Scell,remaining BO is scheduled in next tick
      <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />

      </tapa.expset>         


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.99
#
#       Desc:    Scheduling of SRB should happen only on PCELL 
#                Send BO for SRB and DRB
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.99">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Scheduling of SRB should happen only on PCELL
      </tapa.desc>

      <tapa.longdesc>
      Scheduling of SRB should happen only on PCELL
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expset>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expset>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expset>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expset>


      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="10"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="2" lchTb1Data="1:4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="2" lchTb1Data="1:4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.100
#
#       Desc:    Scheduling SRB should happen only on pcell
#                Send BO only for SRB
#                Retx of SRB is only on Pcell 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.100">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Scheduling SRB should happen only on pcell
      </tapa.desc>

      <tapa.longdesc>
      Scheduling SRB should happen only on pcell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="200"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #SRB is scheduled only on PScell
      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="1"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="1" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="0" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="1" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
 
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.101
#
#       Desc:    Scheduling SRB should happen only on pcell
#                Retx of DRB and SRB on same tick
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.101">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Scheduling SRB should happen only on pcell
      </tapa.desc>

      <tapa.longdesc>
      Scheduling SRB should happen only on pcell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>


      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="400"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	   </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="TRUE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      #Bo for SRB
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="400"/>
      </tapa.send>

       # Send multiple TTIs to validate that nothing else is rcvd
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Retx  
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req lcId="4" ueId="0"  use="9" 
            isTb1="TRUE"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="9" cellId="3" ueId="0" vldDciFrmt="TRUE" isFormat1a="TRUE"
              isTb1Pres="TRUE" vldtRetx="TRUE"/>
        </tapa.tfu.cntrl.req>
        #SRB on Pcell on next tick
        <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="1" valdtTrue="1" />
 
      </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.102
#
#       Desc:    Scheduling of SRB should happen only on PCELL 
#                Send BO for SRB and DRB on Pcell 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.102">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Scheduling of SRB should happen only on PCELL
      </tapa.desc>

      <tapa.longdesc>
      Scheduling of SRB should happen only on PCELL
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expset>
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>
      <tapa.expset>
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expset>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="1" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expset>

      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expset>


      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="1" bo="20"/>
      </tapa.send>
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="100"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="2" lchTb1Data="1:4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="2" lchTb1Data="1:4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      </tapa.expset>         

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.103
#
#       Desc:   Verify that status Bo is getting scheduled only on PCell when DRB BO is huge 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.103">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Verify that status Bo is getting scheduled only on PCell when DRB BO is huge
      </tapa.desc>

      <tapa.longdesc>
       Verify that status Bo is getting scheduled only on PCell when DRB BO is huge
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1"
            dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="4" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1210" staPduBo="10" staPduPrsnt="TRUE"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1"/>
      </tapa.expect>
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1"/>
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.104
#
#       Desc:    Verify that RLC status pdu BO is getting scheduled on PCEll
#                 when DRB Bo is very less(10 bytes) and status pdu = 10bytes 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.104">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Verify that RLC status pdu BO is getting scheduled on PCEll
       when data Bo is very less(10 bytes) and status pdu = 10bytes
      </tapa.desc>

      <tapa.longdesc>
        Verify that RLC status pdu BO is getting scheduled on PCEll
        when data Bo is very less(10 bytes) and status pdu = 10bytes
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1"
            dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="4" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20" staPduBo="10" staPduPrsnt="TRUE"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1"/>
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.105
#
#       Desc:    Verify that RLC status pdu BO is getting scheduled on PCEll
#                 when DRB Bo is 0 and status pdu bo is 10bytes 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.105">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Verify that RLC status pdu BO is getting scheduled on PCEll
       when DRB BO is 0 and status pdu BO is 10bytes
      </tapa.desc>

      <tapa.longdesc>
        Verify that RLC status pdu BO is getting scheduled on PCEll
        when DRB Bo is 0 and status pdu Bo is 10 bytes
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit forceCntrlSrbBoOnPCel="TRUE"/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="1"
            dir="3" lcType="4" />
      </tapa.send>
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="4" instId="5" spId="0" />
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>



      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="17" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="10" staPduBo="10" staPduPrsnt="TRUE"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1"
            lchTb1Data="4" valdtTrue="1"/>
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1"
             lchTb1Data="4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.106
#
#       Desc:   "Aperiodic CQI on Pcell"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.106">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit isDlFreqSel="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" />

	  <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3" 
		  aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
		  UeReCfgType="2" triggerSet1="1" triggerSet2="2" />
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>

      <tapa.send>
         # Configure a GBR dedicated logical channel (DTCH) for the UE1
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="5" lcgId="0" dir="3" lcType="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

	  # Configure a GBR dedicated logical channel (DTCH) for the created UE with
      # QCI = 1 for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="5" dir="1" lcType="4"
            dlQci="1" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>
      
         <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>      
	  
	  <tapa.repeat.start repeatCount="3"/>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#1st Nack
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" validate="TRUE" isRetx="TRUE" retxUse="0"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
	  <tapa.repeat.end/>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

	  # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#2nd NACK
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

#################################################
#Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>      
	  
	  <tapa.repeat.start repeatCount="3"/>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#3rd NACK
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" validate="TRUE" isRetx="TRUE" retxUse="0"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
	  <tapa.repeat.end/>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

	  # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#4th NACK
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

	  <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="5" bo="50"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="5" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="5"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	</tapa.tfu.cntrl.req>
      
        <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>      
	  
	  <tapa.repeat.start repeatCount="3"/>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
	    <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
        </tapa.tfu.recp.req>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  # Expect DCI format 0 for ACQI
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="0">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
                vldtGrant="TRUE" vldtTx="TRUE" cqiReq="1" numCqiBit="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.tfu.recp.req spId="0" ueId="0">
            <tapa.tfu.dlcqi.recp.req />
         </tapa.tfu.recp.req>
      </tapa.expset>

	  #Trigger Aperiodic CQI
      #<tapa.rg.dlfs.aprdcqiTrgMultiCell ueId="0"  cqiReq="1" chkCqiBit="TRUE" numCqiBit="1" cqiPmiSzR1="1:0"/>
  
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    37.107
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#				Send NACK for SCELL to trigger Apcqi for Scell. 
#				Triggerset One should be used and Apcqi for both Pcell and Scell 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.107">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3" 
		  aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
		  triggerSet1="3" triggerSet2="1" UeReCfgType="2" />
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>


      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
            n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" triggerSet1="3" triggerSet2="1" 
            aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" />

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
         # Send BO for the created logical channel on RGU.lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
         # Send BO for the created logical channel on RGU.lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:1:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>





      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>   
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>


      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
	  # Expect DCI format 0 for ACQI
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="0">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" cqiReq="0" chkCqiBit="TRUE" 
               numCqiBit="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="0">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" 
               vldtCqi="TRUE" cqiPmiSzR1="30:30" cqiPmiSzRn1="30:30" riPres="0:0" 
               ccNum="0" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" rawDlCqiEnc="TRUE" ri="0:0" wbCqi1="10" wbCqi2="10"
               cqiIdxLst1="0:1:3:2:0:2:0:1:2:0:1:2:3" cqiIdxLst2="0:1:3:2:0:2:0:1:2:0:1:2:3"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>





    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 
#
#       Test:    37.108
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               Before Scelll got ready, number CQI bits should be 1 bits
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.108">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3" 
        aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
        triggerSet1="3" triggerSet2="1" UeReCfgType="2" />
      </tapa.send>

     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>


      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
            n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" triggerSet1="3" triggerSet2="1" 
            aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" />


      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

#Send Scell Delete
     <tapa.rg.relSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

#Send SR to get DCI0
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0" >
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           chkCqiBit="TRUE" numCqiBit="1" cqiReq="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>




   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.109
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type 
#				Send NACK for PCELL to trigger Apcqi for Pcell. 
#				Cqi 2 bit should be used and  csiReq = 01 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.109">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3" 
		  aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
		  triggerSet1="3" triggerSet2="1" UeReCfgType="2" />
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>


      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
            n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" triggerSet1="3" triggerSet2="1" 
            aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" />

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send some ticks(18) to scell active
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="0" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" hqBits="0:0:0:0" is1BWithCs="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" hqBits="0:0:0:0" is1BWithCs="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
         # Send BO for the created logical channel on RGU.lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>





      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="3" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>   
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="FALSE" scellResIdx="1" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="0:0:0:0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
	  # Expect DCI format 0 for ACQI
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="0">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" 
               vldtGrant="TRUE" vldtTx="TRUE" cqiReq="1" chkCqiBit="TRUE" 
               numCqiBit="2"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="0">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2" 
               vldtCqi="TRUE" cqiPmiSzR1="30" cqiPmiSzRn1="30" riPres="0:0" 
               ccNum="1" />
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      #Send Raw CQI Indication
      <tapa.send >
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" rawDlCqiEnc="TRUE" ri="0" wbCqi1="10" 
               cqiIdxLst1="0:1:3:2:0:2:0:1:2:0:1:2:3" />
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>
  
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    37.110
#
#       Desc:   DL Scheduling on PCELL(1TB) and SCELL(1TB) using RR Sched Type (A=2)
#               After Scelll got ready, number CQI bits should be 2 bits
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.110">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0"  txModeEnum="RGR_UE_TM_3" 
		  aprdModeEnumPres="TRUE"  aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" 
		  triggerSet1="3" triggerSet2="1" UeReCfgType="2" />
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.expset>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expset>


      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
            n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" triggerSet1="3" triggerSet2="1" 
            aprdModeEnumPres="TRUE" aprdModeEnum="RGAC_RGR_APRD_CQI_MOD30" />

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
#Send SR to get DCI0
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0" >
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" 
           chkCqiBit="TRUE" numCqiBit="2" cqiReq="0"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>




   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>


#
#       Test:    37.111
#
#       Desc:    To test the size of dci 1A when the SCell is added and UE is REL10 BW 20MHz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.111">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 1A when the SCell is added and UE is REL10 BW 20MHz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 1A when the SCell is added and UE is REL10 BW 20MHz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"  accessStratumRls="RGR_REL_10"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req ueId="0" dciSize="29"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.112
#
#       Desc:    To test the size of dci 1A when the SCell is added and UE is REL10. BW 15Mhz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.112">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 1A when the SCell is added and UE is REL10. BW 15Mhz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 1A when the SCell is added and UE is REL10. BW 15Mhz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="75"  ulTotalBw="75"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"  accessStratumRls="RGR_REL_10"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req ueId="0" dciSize="28"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.113
#
#       Desc:    To test the size of dci 0 when the SCell is added and UE is REL10 BW 20MHz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.113">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 0 when the SCell is added and UE is REL10 BW 20MHz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 0 when the SCell is added and UE is REL10 BW 20MHz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"  accessStratumRls="RGR_REL_10"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req ueId="0" dciSize="29"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

	  # request after this TTI
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="0">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" dciSize="29"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.114
#
#       Desc:    To test the size of dci 0 when the SCell is added and UE is REL10. BW 15Mhz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.114">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 0 when the SCell is added and UE is REL10. BW 15Mhz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 0 when the SCell is added and UE is REL10. BW 15Mhz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="75"  ulTotalBw="75"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"  accessStratumRls="RGR_REL_10"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req ueId="0" dciSize="28"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr ueId="0"/>
        </tapa.tfu.sr.ind>
     </tapa.send>
     
     # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="0">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE" dciSize="28"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.115
#
#       Desc:    To test the size of dci 0/1a when for common search space and UE is REL10. BW 15Mhz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.115">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 0/1a when for common search space and UE is REL10. BW 15Mhz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 0/1a when for common search space and UE is REL10. BW 15Mhz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="75"  ulTotalBw="75"/>

	  <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
         # Send TTI Ind for firt MAC and SCH inst

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="2" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
    
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req dciSize="27"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
  

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   


      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp instId="0" cellId="3" spId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind instId="0" cellId="3" suId="0" lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq instId="0" spId="0" cellId="3" lcId="4" lcType="3" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect Msg4 from MAC to PHY.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" dciSize="27"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. 
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK as feedback for Msg4. 
     <tapa.send>
        <tapa.tfu.hq.ind schInstId="5" suId="0" cellId="3" hqInds="1">
          <tapa.tfu.hq />
       </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send UE config request
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue instId="0" cellId="3" spId="0"/>
     </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm instId="0"/>
     </tapa.expect>

     # Send UE config request
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" spId="0"/>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      <tapa.delay delay="1"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.116
#
#       Desc:    To test the size of dci 0/1a when for common search space and UE is REL10. BW 5Mhz
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.116">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test the size of dci 0/1a when for common search space and UE is REL10. BW 5Mhz
      </tapa.desc>

      <tapa.longdesc>
         To test the size of dci 0/1a when for common search space and UE is REL10. BW 5Mhz
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="25"  ulTotalBw="25"/>

	  <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
         # Send TTI Ind for firt MAC and SCH inst

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="2" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
    
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req dciSize="25"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
  

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   


      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp instId="0" cellId="3" spId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind instId="0" cellId="3" suId="0" lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq instId="0" spId="0" cellId="3" lcId="4" lcType="3" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect Msg4 from MAC to PHY.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" dciSize="25"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. 
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK as feedback for Msg4. 
     <tapa.send>
        <tapa.tfu.hq.ind schInstId="5" suId="0" cellId="3" hqInds="1">
          <tapa.tfu.hq />
       </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send UE config request
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue instId="0" cellId="3" spId="0"/>
     </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm instId="0"/>
     </tapa.expect>

     # Send UE config request
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" spId="0"/>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      <tapa.delay delay="1"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.117
#
#       Desc:    To test that the validation in UE config fails when passing wrong UE release version 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.117">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test that the validation in UE config fails when passing wrong UE release version
      </tapa.desc>

      <tapa.longdesc>
         To test that the validation in UE config fails when passing wrong UE release version
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="25"  ulTotalBw="25"/>

	  <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
         # Send TTI Ind for firt MAC and SCH inst

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="2" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
    
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req dciSize="25"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
  

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   


      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp instId="0" cellId="3" spId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind instId="0" cellId="3" suId="0" lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq instId="0" spId="0" cellId="3" lcId="4" lcType="3" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect Msg4 from MAC to PHY.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" dciSize="25"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. 
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK as feedback for Msg4. 
     <tapa.send>
        <tapa.tfu.hq.ind schInstId="5" suId="0" cellId="3" hqInds="1">
          <tapa.tfu.hq />
       </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send UE config request
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue instId="0" cellId="3" spId="0"/>
     </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm instId="0"/>
     </tapa.expect>

     # Send UE config request
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" spId="0" accessStratumRls="RGR_REL_SPARE_5"/>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5" status="15"/>
     </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      <tapa.delay delay="1"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>

#
#       Test:    37.118
#
#       Desc:    To test that the validation in UE Reconfig fails when passing wrong UE release version 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.118">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To test that the validation in UE Reconfig fails when passing wrong UE release version
      </tapa.desc>

      <tapa.longdesc>
         To test that the validation in UE Reconfig fails when passing wrong UE release version
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit dlTotalBw="25"  ulTotalBw="25"/>

	  <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
         # Send RaReqInd for one rapId 
         # Send TTI Ind for firt MAC and SCH inst

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #RACH procedure for first UE towards first instance
      <tapa.send>
         <tapa.tfu.rareq.ind instId="5" numRaRnti="1" suId="0">
            <tapa.tfu.rareq  numRapId="1" rapIds="2" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4" cellId="3"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # In this TC, it shall expect raResp in the first subframe after 3 Ttis.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
    
      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req dciSize="25"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.rarsp.req />
        </tapa.tfu.dat.req>
      </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.msg3.recp.req/>
         </tapa.tfu.recp.req>
      </tapa.expect>
  

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind suId="0" cellId="3" schInstId="5">
             <tapa.tfu.crc isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size 
      <tapa.send>
         <tapa.tfu.dat.ind macInstId="0" cellId="3" suId="0" datInds="1">
            <tapa.tfu.dat isCcchSdu="TRUE" sduSize="6" addPhr="TRUE" phr="46" />
         </tapa.tfu.dat.ind>      
      </tapa.send>   


      # Expect Message3 datReq on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind lcId="4" instId="0" suId="0" cellId="3"/>
      </tapa.expect>

      # Send BO for Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cstarsp instId="0" cellId="3" spId="0" lcId="4" lcType="3" bo="10"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Expect CStatInd For MSG4
      <tapa.expset>
         <tapa.rgu.cstaind instId="0" cellId="3" suId="0" lcId="4"/>
      </tapa.expset>

      # Send Msg4 on RGU. 
      <tapa.send>
         <tapa.rgu.cdatreq instId="0" spId="0" cellId="3" lcId="4" lcType="3" />
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect Msg4 from MAC to PHY.
     <tapa.expset>
        <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
           <tapa.tfu.pdsch.dat.req use="1" validate="FALSE"/>
        </tapa.tfu.dat.req>   
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" dciSize="25"/>
        </tapa.tfu.cntrl.req>
     </tapa.expset>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Recv Hq Recp Req for Msg4. 
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" numRntis="1" spId="0" >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Send ACK as feedback for Msg4. 
     <tapa.send>
        <tapa.tfu.hq.ind schInstId="5" suId="0" cellId="3" hqInds="1">
          <tapa.tfu.hq />
       </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send UE config request
     <tapa.send>
        <tapa.crg.cfgreq.cfg.ue instId="0" cellId="3" spId="0"/>
     </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.crg.cfgcfm instId="0"/>
     </tapa.expect>

     # Send UE config request
     <tapa.send>
        <tapa.rgr.cfgreq.cfg.ue instId="5" spId="0" accessStratumRls="RGR_REL_10"/>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     # Expect success in cfg cfm
     <tapa.expect>
        <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="33554432" accessStratumRls="RGR_REL_SPARE_5"
           oldcrnti="11" newcrnti="11"/>
      </tapa.send>

	  <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

	  #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  status="15"/>
       </tapa.expect>


      <tapa.delay delay="1"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>
</tapa.testcase>


#
#       Test:    37.119
#       Desc:   "To Verify UL CA sched on both PCELL and SCELL"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.119">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
    
      <tapa.rg.addSecCell ueId="0" cellId="3" isUlCaEnabled="TRUE"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>



      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="29"
            bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
#############
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="1">
        <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" vldtRbOvrlap="FALSE" saveTo="3"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>



      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind  suId="1" cellId="4">
            <tapa.tfu.crc ueId="0" isFailure="FALSE" suId="1"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
     
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="0"
            bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1" suId="1" cellId="4" macInstId="1">
          <tapa.tfu.dat use="3" lcId="4" />
       </tapa.tfu.dat.ind>
      </tapa.send>
 
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" srcInst="1" cellId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>




   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    37.120
#       Desc:   "To Verify EXT PHR CE decoding "
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="37.120">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCell ueId="0" uniqueRntiVldt="FALSE"/>
    
      <tapa.rg.addSecCell ueId="0" cellId="3" isUlCaEnabled="TRUE"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" hqBits="1:1:1:1"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg ueId="0" lcgId="0" instId="5"/>
      </tapa.send>

      # Configure bi-directional DTCH for default UE0 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expset> 
         <tapa.rgr.cfgCfm instId="5"/>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expset>



      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" vldtGrant="TRUE" vldtTx="TRUE"
            isUlGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="29"
            bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
      # Expect DCI format 0 and do basic validations of the grant
      # Grant should be near to minimum expected grant (Chk to fill
      # minGrantBits) 
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="2" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" vldtTx="TRUE" saveTo="3" vldtGrant="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>
 
#############
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect data reception request
      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
        <tapa.tfu.pusch.recp.req use="2" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="1">
        <tapa.tfu.pusch.recp.req use="3" vldtDatRecp="TRUE" vldtRbOvrlap="FALSE" saveTo="3"/>
     </tapa.tfu.recp.req>   
      </tapa.expset>



      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.crc.ind  suId="1" cellId="4">
            <tapa.tfu.crc ueId="0" isFailure="FALSE" suId="1"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
 
     
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="4" addLongBsr="TRUE" bsr0="0"
            bsr1="0" bsr2="0" bsr3="0"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send data indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1" suId="1" cellId="4" macInstId="1">
          <tapa.tfu.dat use="3" addExtPhr="TRUE" extPhr0="5" pCMax0="6" extPhr1="7"/>
       </tapa.tfu.dat.ind>
      </tapa.send>
 
      
      # Expect datInd at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1"/>
      </tapa.expect>
<!--
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="4,1" srcInst="1" cellId="4"/>
      </tapa.expect>
-->
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>




   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 



