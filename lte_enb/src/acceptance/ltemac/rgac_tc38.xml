#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For TDD 
#
#     File:    rgac_tc38.xml
#
#     Sid:     rgac_tc38.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     mpatel
#
#*********************************************************************21*/
#
#       Test:    38.1
#
#       Desc:   "To verify successfull addition of secondary cell in TDD mode"
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful addition of a scell in TDD
      </tapa.desc>

      <tapa.longdesc>
         To verify successful addition of a scell in TDD
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>
      
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>
      
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" />
     
     <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
     
     <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.2
#
#       Desc:   "To verify successfull activation of a scell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful activation of a scell
      </tapa.desc>

      <tapa.longdesc>
         To verify successful activation of a scell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
 
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.3
#
#       Desc:   "To verify successfull scheduling of SCell activation CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify successful scheduling of SCell activation CE
      </tapa.desc>

      <tapa.longdesc>
         To verify successful scheduling of SCell activation CE
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.4
#
#       Desc:   "HARQ ACK for scell activation CE pdu
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.5
#
#       Desc:   "HARQ NACK for scell activation CE pdu and retx of CE
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>
      
      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.6
#
#       Desc:   HARQ NACK max retx scenario
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Harq failure for CE txion
      </tapa.desc>

      <tapa.longdesc>
         Harq failure for CE txion
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" maxDlHqTx="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>

      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>


      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      #second set of nack-retx
     ## expect hq feedback for the first Ue's
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

     # Send TTI indication for retx
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #expect retx control and data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.7
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" />

      #Add the same sec cell again
 
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="1" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.8
#
#       Desc:   To verify failure case of sec cell addition 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.desc>

      <tapa.longdesc>
         To verify failure case of sec cell addition (Invalid scell idx)
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>
      
      # Recfg req for adding sec cell
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue isSCellAdd="TRUE" numSCells="1" sCellIdx="9" sCellId="4"  instId="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0" status="15"/>
      </tapa.expect>
 
      # steps for data on each UE
   </tapa.test>


   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.9
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         HARQ ACK for SCell CE PDU
      </tapa.desc>

      <tapa.longdesc>
         HARQ ACK for SCell CE PDU
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE"/>
    
      <tapa.rg.addSecCell ueId="0" cellId="3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 


#
#       Test:    38.10
#
#       Desc:    (M=4):1Tb in each subframe for both PCell and SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4):1Tb in each subframe for both PCell and SCell
      </tapa.desc>

      <tapa.longdesc>
      (M=4):1Tb in each subframe for both PCell and SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                    
    
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#DAI = 1
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
       # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 2
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 3
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

#DAI = 4
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
            
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.11
#
#       Desc:    (M=4):1Tb in each subframe of PCell but no data on SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4):1Tb in each subframe for both PCell but no data on SCell
      </tapa.desc>

      <tapa.longdesc>
      (M=4):1Tb in each subframe for both PCell but no data on SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                    
    
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#DAI = 1
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="300"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
       # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
#DAI = 2
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="300"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 3
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="300"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
#DAI = 4
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="300"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      </tapa.expset>
      #harqRecp
            
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.12
#
#       Desc:    (M=4): Data only in SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         Data only in SCell
      </tapa.desc>

      <tapa.longdesc>
         Configure 1UE per TTI.
         Configure 2UEs.
         Schedule data on both the UEs.
         UE1 will be scheduled on PCell
         UE2 will be scheduled on SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1" 
         ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         raRnti="52" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>    
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

         <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="1" uniqueRntiVldt="FALSE" 
         raRnti="53" crnti="62" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                   
      
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      #Activate Ue 0
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FASLE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell newUeId="1" oldUeId="1" ueId="1" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      
      #Activate Ue 1
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0" >
            <tapa.tfu.pdsch.dat.req ueId="1" lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FASLE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Steps for LC creation for 2nd Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" 
            macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.1 - Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
 
      #1.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.3 Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #1.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      #2.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
 
       #1.5,2.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      #2.3 Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
    
      #1.6 Send Cntrl req(12,7) for Subframe 9 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #2.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
 
      #2.5 and 3.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.3 Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       
       #2.6 Send Cntrl req(12,8) for (13,0) 
      <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #3.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.6 Send Cntrl req(12,9) for (13,1) 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

      #4.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
 
      #4.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #4.3 Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
      <tapa.expset>
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #4.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #4.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

       #4.6 Send Cntrl req(13,1) for (13,2) 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
            <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2"/>
            <tapa.tfu.hq.recp.req ueId="1" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.13
#
#       Desc:    (M=4): Data absent on 1st and 2nd subframes of PCell 
#                       but present on 3rd and 4th subframes of PCell 
#                       and on all 4 subframes of SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4): Data absent on 1st and 2nd subframes of PCell 
             but present on 3rd and 4th subframes of PCell 
             and on all 4 subframes of SCell
      </tapa.desc>

      <tapa.longdesc>
         Configure 1UE per TTI.
         Configure 2UEs:UE1 = ueId0; UE2 = ueId1.
         Schedule data on both the UEs.
         SubFrame 9: BO:ueId=0 - 20(Pcell); ueId=1 - 40(Scell).
         SubFrame 0: BO:ueId=0 - 20(Pcell); ueId=1 - 40(Scell).
         SubFrame 1: BO:ueId=1 - 1000(Pcell n Scell).
         SubFrame 3: BO:ueId=1 - 1000(Pcell n Scell).
         ueId=1 is the UE for reference
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1" 
         ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         raRnti="52" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>    
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

         <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="1" uniqueRntiVldt="FALSE" 
         raRnti="53" crnti="62" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                   
      
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      #Activate Ue 0
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell newUeId="1" oldUeId="1" ueId="1" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      
      #Activate Ue 1
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0" >
            <tapa.tfu.pdsch.dat.req ueId="1" lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Steps for LC creation for 2nd Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" 
            macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.1 - Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
 
      #1.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.3 Expect STA IND at RLC from PCELL = 3 for UE1 and SCELL = 4 for UE2
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #1.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      #2.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
 
       #1.5,2.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      #2.3 Expect STA IND at RLC from PCELL = 3 for UE1 and SCELL = 4 for UE2
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
    
      #1.6 Send Cntrl req(12,7) for Subframe 9 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #2.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.1 Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="1000"/>
      </tapa.send>
 
      #2.5 and 3.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.3 Expect STA IND at RLC from PCELL = 3 for UE1 and SCELL = 4 for UE2
       <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       
       #2.6 Send Cntrl req(12,8) for (13,0) 
      <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #3.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue2 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.6 Send Cntrl req(12,9) for (13,1) 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

      #4.1 Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="1000"/>
      </tapa.send>
 
      #4.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #4.3 Expect STA IND at RLC from CELL = 3 and CELL = 4 for UE2
      <tapa.expset>
       <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #4.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue2 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #4.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

       #4.6 Send Cntrl req(13,1) for (13,2) 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.14
#
#       Desc:    (M=4): Data absent on 3rd and 4th subframes of PCell 
#                       but present on first 2 subframes of PCell 
#                       and on all 4 subframes of SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4): Data absent on 3rd and 4th subframes of PCell 
             but present on first 2 subframes of PCell 
             and on all 4 subframes of SCell
      </tapa.desc>

      <tapa.longdesc>
         Configure 1UE per TTI.
         Configure 2UEs:UE1 = ueId0; UE2 = ueId1.
         Schedule data on both the UEs.
         SubFrame 9: BO:ueId=1 - 1000(Pcell n Scell).
         SubFrame 0: BO:ueId=1 - 1000(Pcell n Scell).
         SubFrame 1: BO:ueId=0 - 20(Pcell); ueId=1 - 40(Scell).
         SubFrame 3: BO:ueId=0 - 20(Pcell); ueId=1 - 40(Scell).
         ueId=1 is the UE for reference
      </tapa.longdesc>

   </tapa.doc>
   #Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit maxUePerDlSf="1" maxDlUeNewTxPerTti="1" 
         ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         raRnti="52" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>    
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

         <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="1" uniqueRntiVldt="FALSE" 
         raRnti="53" crnti="62" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                   
      
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      #Activate Ue 0
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell newUeId="1" oldUeId="1" ueId="1" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      
      #Activate Ue 1
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0" >
            <tapa.tfu.pdsch.dat.req ueId="1" lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Steps for LC creation for 2nd Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" 
            macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #1.1 - Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="1000"/>
      </tapa.send>
 
      #1.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.3 Expect STA IND at RLC for UE1 from PCELL = 3 and SCELL = 4 
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #1.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue2 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      #2.1 Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="1000"/>
      </tapa.send>
      
       #1.5,2.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
       #2.3 Expect STA IND at RLC for UE2 from PCELL = 3 and SCELL = 4
      <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" 
         numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" 
         numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      
      #1.6 Send Cntrl req(12,7) for Subframe 9 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #2.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue2 on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" 
               ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" 
               ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE2 on instance 1
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      
      #2.5 and 3.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
       #3.3 (12,8)Expect STA IND at RLC from PCELL = 3 for UE1 and SCELL = 4 for UE2
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       
       #2.6 Send Cntrl req(12,8) for (13,0) 
      <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
      #3.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.6 Send Cntrl req(12,9) for (13,1) 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      
      #4.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="20"/>
      </tapa.send>
 
      #4.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #4.3 (13,0) Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 for UE2
      <tapa.expset>
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="1" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #4.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue2 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="1" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #4.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

       #4.6 Send Cntrl req(13,1) for (13,2) 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
     
      <tapa.delay delay="1"/> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.15
#
#       Desc:    (M=4): Data absent on 1st and 2nd subframes of SCell 
#                       but present on 3rd and 4th subframes of SCell 
#                       and on all 4 subframes of PCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4): Data absent on 1st and 2nd subframes of SCell 
             but present on 3rd and 4th subframes of SCell 
             and on all 4 subframes of PCell
      </tapa.desc>

      <tapa.longdesc>
         Configure 1UE:UE1 = ueId0.
         SubFrame 9: BO:ueId=0 - 20(Pcell).
         SubFrame 0: BO:ueId=0 - 20(Pcell).
         SubFrame 1: BO:ueId=0 - 1000(Pcell n Scell).
         SubFrame 3: BO:ueId=0 - 1000(Pcell n Scell).
         ueId=0 is the UE for reference
      </tapa.longdesc>

   </tapa.doc>
   #Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" 
         txModeEnum="RGR_UE_TM_3"/> 
      
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         raRnti="52" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>    
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

         <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="1" uniqueRntiVldt="FALSE" 
         raRnti="53" crnti="62" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                   
      
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      #Activate Ue 0
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell newUeId="1" oldUeId="1" ueId="1" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      
      #Activate Ue 1
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0" >
            <tapa.tfu.pdsch.dat.req ueId="1" lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Steps for LC creation for 2nd Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" 
            macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #1.1 - Steps for BO Updation
      #Send BO for UE2 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
 
      #1.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.3 Expect STA IND at RLC for UE1 from PCELL = 3 
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #1.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
       
      #2.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      
       #1.5,2.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
       #2.3 Expect STA IND at RLC for UE1 from PCELL = 3 
      <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" 
         numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      
      #1.6 Send Cntrl req(12,7) for Subframe 9 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #2.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" 
               ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #3.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      
      #2.5 and 3.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
       #3.3 (12,8)Expect STA IND at RLC from PCELL = 3 for UE1 
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       
       #2.6 Send Cntrl req(12,8) for (13,0) 
      <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
      #3.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue1 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #3.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.6 Send Cntrl req(12,9) for (13,1) 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      
      #4.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
 
      #4.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #4.3 (13,0) Expect STA IND at RLC from CELL = 3 for UE1 and CELL = 4 
      <tapa.expset>
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #4.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue1 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      #4.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

       #4.6 Send Cntrl req(13,1) for (13,2) 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
     
      <tapa.delay delay="1"/> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.16
#
#       Desc:    (M=4): Data absent on 3rd and 4th subframes of SCell 
#                       but present on 1st and 2nd subframes of SCell 
#                       and on all 4 subframes of PCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4): Data absent on 3rd and 4th subframes of SCell 
             but present on 1st and 2nd subframes of SCell 
             and on all 4 subframes of PCell
      </tapa.desc>

      <tapa.longdesc>
         Configure 1UE:UE1 = ueId0.
         SubFrame 9: BO:ueId=0 - 1000(Pcell n Scell).
         SubFrame 0: BO:ueId=0 - 1000(Pcell n Scell).
         SubFrame 1: BO:ueId=0 - 20(Pcell).
         SubFrame 3: BO:ueId=0 - 20(Pcell).
         ueId=0 is the UE for reference
      </tapa.longdesc>

   </tapa.doc>
   #Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" 
         txModeEnum="RGR_UE_TM_3"/> 
      
      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         raRnti="52" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>    
      
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

         <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="1" uniqueRntiVldt="FALSE" 
         raRnti="53" crnti="62" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                   
      
      <tapa.rg.addSecCell newUeId="0" oldUeId="0" ueId="0" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      #Activate Ue 0
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.addSecCell newUeId="1" oldUeId="1" ueId="1" cellId="3" sCellId="4" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      
      #Activate Ue 1
      <tapa.send>
         <tapa.rgr.actDeact.scell ueId="1" sCellActionType="2"/>
      </tapa.send>

      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="1"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0" >
            <tapa.tfu.pdsch.dat.req ueId="1" lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="1" is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Steps for LC creation for 2nd Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>
      
      # Configure DL LC on RGR for UE0
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR for UE1
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" 
            macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="20" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #1.1 - Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
 
      #1.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #1.3 Expect STA IND at RLC for UE1 from PCELL = 3 and SCEll = 4 
      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #1.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue1 on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
       
      #2.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      
       #1.5,2.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
       #2.3 Expect STA IND at RLC for UE1 from PCELL = 3 and SCELL = 4
      <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" 
         numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" 
         numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      
      #1.6 Send Cntrl req(12,7) for Subframe 9 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      #2.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" 
               ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      <tapa.send>
         # Send DDatReq for Ue1 on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" 
               ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #3.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      
      #2.5 and 3.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
       #3.3 (12,8)Expect STA IND at RLC from PCELL = 3 for UE1 
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
       
       #2.6 Send Cntrl req(12,8) for (13,0) 
      <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
         
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
      #3.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #3.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       #3.6 Send Cntrl req(12,9) for (13,1) 
       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      
      #4.1 Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
 
      #4.2 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #4.3 (13,0) Expect STA IND at RLC from PCELL = 3 for UE1 
      <tapa.expset>
       <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      #4.4 Send Dat Req
      <tapa.send>
         # Send DDatReq for Ue1 on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #4.5 Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

       #4.6 Send Cntrl req(13,1) for (13,2) 
     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU

     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq is1BWithCs="TRUE" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
     
      <tapa.delay delay="1"/> 
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.17
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
#               Presence of data on both the serving cells. 1TB on PCell and
#               1TB on SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on both the serving cells. 1TB on PCell and
         1TB on SCell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on both the serving cells. 1TB on PCell and
         1TB on SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" />
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.18
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=2
#               Presence of data on both the serving cells.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=2
         Presence of data on both the serving cells
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=2
         Presence of data on both the serving cells
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_1" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.19
#
#       Desc:   Presence of data on primary cell and absence of data on
#               secondary cell with M =1 and A=2
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Presence of data on primary cell and absence of data on
      secondary cell with M =1 and A=2
      </tapa.desc>

      <tapa.longdesc>
      Presence of data on primary cell and absence of data on
      secondary cell with M =1 and A=2
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_1" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.20
#
#       Desc:   Presence of data on secondary cell and absence of data on
#               primary cell with M =1 and A=2
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.20">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Presence of data on secondary cell and absence of data on
      primary cell with M =1 and A=2
      </tapa.desc>

      <tapa.longdesc>
      Presence of data on primary cell and absence of data on
      secondary cell with M =1 and A=2
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" maxUePerDlSf="1"
         maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="52" ueId="0" 
          uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
     <!-- 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="9" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>-->

      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="53" crnti="62" ueId="1"
         uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_1" 
       pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" 
       n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
         macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
              chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

<!--
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      -->

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>

       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
               <tapa.tfu.hq.recp.req ueId="0"/> 
            </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_BUNDLING" M="1" isTb1="TRUE"/>
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
    
     #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.21
#
#       Desc:   Presence of data on secondary cell and absence of data on
#               primary cell with M =1 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      Presence of data on secondary cell and absence of data on
      primary cell with M =1 and A=4
      </tapa.desc>

      <tapa.longdesc>
      Presence of data on primary cell and absence of data on
      secondary cell with M =1 and A=4
      steps:
      1) configure 1UE/TTI and UE Tx mode 3
      2) configure UE 0 as CA UE
      3) configure UE 1 as non CA UE
      4) first send less BO of UE1 so that complete BO is consumed in a TTI
      5) send less Bo Bo of UE 0 so that only SCell get scheduled
      6) send Tti
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" maxUePerDlSf="1"
         maxDlUeNewTxPerTti="1" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="52" ueId="0" 
          uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"
          txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="53" crnti="62" ueId="1"
         uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
       pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" 
       n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
         macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
              chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>

       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
               <tapa.tfu.hq.recp.req ueId="0"/> 
            </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_BUNDLING" M="1" A="4" isTb1="TRUE"/>
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
    
     #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.22
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
#               Presence of data on PCell and absence of data on SCell
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on PCell and absence of data on SCell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on PCell and absence of data on SCell
      steps:
      1) configure 1UE/TTI and UE Tx mode 3
      2) configure UE 0 as CA UE
      5) send less Bo Bo of UE 0 so that only PCell get scheduled
      6) send Tti
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.23
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absence of data on secondary subframe and presence of data on first 
         subframe on primary cell with the presenc of data on both subframes 
         on secondary cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absence of data on secondary subframe and presence of data on first 
         subframe on primary cell with the presenc of data on both subframes 
         on secondary cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="1" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0" ueId="1"/>
      </tapa.expect> 


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

       #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>  

#
#       Test:    38.24
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absence of data on first subframe and presence of data on second 
         subframe on secondary  cell with the presenc of data on both 
         subframes on primary cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absence of data on first subframe and presence of data on second 
         subframe on secondary  cell with the presenc of data on both 
         subframes on primary cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   

#
#       Test:    38.25
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absence of data on second subframe and presence of data on first 
         subframe on secondary  cell with the presenc of data on both 
         subframes on primary cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absence of data on second subframe and presence of data on first 
         subframe on secondary  cell with the presenc of data on both 
         subframes on primary cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>           


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>    

#
#       Test:    38.26
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="1" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0" ueId="1"/>
      </tapa.expect> 


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

       #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   

#
#       Test:    38.27
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absernce of data on seconday cell with presence of data on primary cell                
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absernce of data on seconday cell with presence of data on primary cell                
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>           

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>     

#
#       Test:    38.28
#
#       Desc:   Primary in mimo mode and secondary in siso mode M=1 and A=3
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.28">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in siso mode M=1 and A=3
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in siso mode M=1 and A=3
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.29
#
#       Desc:   Primary in mimo mode and secondary in siso mode and absence of 
#               TB on primary and one TB on secondary with M=1 and A=3
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in siso mode and absence of 
       TB on primary and one TB on secondary with M=1 and A=3
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in siso mode and absence of 
       TB on primary and one TB on secondary with M=1 and A=3
      steps:
      1) configure 1UE/TTI
      2) UE0 is a CA Ue. configure UE0 PCell Tx mode as TM3 and UE0 SCell Tx mode as TM1
      3) configure UE 1 as non CA UE
      4) first send less BO of UE1 so that complete BO is consumed in a TTI
      5) send less Bo of UE 0 so that only SCell get scheduled
      6) send Tti
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" maxUePerDlSf="1"
         maxDlUeNewTxPerTti="1" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="52" ueId="0" 
          uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"
          txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="53" crnti="62" ueId="1"
         uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_1" 
       pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" 
       n1PUCCHValTB2="5:6:7:8" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
         macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
              chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>

       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
               <tapa.tfu.hq.recp.req ueId="0"/> 
            </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_BUNDLING" M="1" A="4" isTb1="TRUE"/>
             <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE:FALSE:FALSE:FALSE:FALSE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
    
     #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.30
#
#       Desc:  Primary in siso mode and secondary in mimo mode with M=1 and A=3
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
      </tapa.desc>

      <tapa.longdesc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
       steps:
       1) PCEll is configured in SISO(tx mode = TM1)
       2) SCEll is configured in MIMO(tx mode = TM3)
       3) scheduling 1 TB ON PCEll and 1 TB on SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req />
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.31
#
#       Desc:  Primary in siso mode and secondary in mimo mode with M=1 and A=3
#              Absence of TB on secondary and presence of TB on primary
#              
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
       Absence of TB on secondary and presence of TB on primary
      </tapa.desc>

      <tapa.longdesc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
       Absence of TB on secondary and presence of TB on primary
       steps:
       1) PCEll is configured in SISO(tx mode = TM1)
       2) SCEll is configured in MIMO(tx mode = TM3)
       3) scheduling 1 TB ON PCEll and 1 TB on SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req />
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.32
#
#       Desc:   Primary in siso mode and secondary in mimo mode and absence of 
#               TB on primary and one TB on secondary with M=1 and A=3
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in siso mode and secondary in mimo mode and absence of 
       TB on primary and one TB on secondary with M=1 and A=3
      </tapa.desc>

      <tapa.longdesc>
       Primary in siso mode and secondary in mimo mode and absence of 
       TB on primary and one TB on secondary with M=1 and A=3
      steps:
      1) configure 1UE/TTI
      2) UE0 is a CA Ue. configure UE0 PCell Tx mode as TM1 and UE0 SCell Tx mode as TM3
      3) configure UE 1 as non CA UE
      4) first send less BO of UE1 so that complete BO is consumed in a TTI
      5) send less Bo of UE 0 so that only SCell get scheduled
      6) send Tti
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" maxUePerDlSf="1"
         maxDlUeNewTxPerTti="1" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="52" ueId="0" 
          uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"
          txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1  raRnti="53" crnti="62" ueId="1"
         uniqueRntiVldt="FALSE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
       pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" 
       n1PUCCHValTB2="5:6:7:8" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" 
         macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" 
              chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="40"/>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="20"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>

       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="1"/>
               <tapa.tfu.hq.recp.req ueId="0"/> 
            </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE:TRUE:TRUE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_BUNDLING" M="1" A="4" isTb1="TRUE"/>
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE:FALSE" is1BWithCs="TRUE"
               ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
    
     #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.33
#
#       Desc:  Primary in mimo mode and secondary in siso mode with M=1 and A=3
#              Absence of TB on secondary and presence of TB on primary
#              
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.33">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in siso mode with M=1 and A=3
       Absence of TB on secondary and presence of TB on primary
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in siso mode with M=1 and A=3
       Absence of TB on secondary and presence of TB on primary
       steps:
       1) PCEll is configured in MIMO(tx mode = TM3)
       2) SCEll is configured in SISO(tx mode = TM1)
       3) scheduling 1 TB only on PCEll 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req />
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE" is1BWithCs="TRUE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="3" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.34
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.34">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Presence of data on both subframes in both the cells              
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on both subframes in both the cells              
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>           


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE" 
               is1BWithCs="TRUE" ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="2"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>     

#
#       Test:    38.35
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Presence of data on both sunframe in primary cell with absernce of 
         data on secondary cell                      
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Presence of data on both sunframe in primary cell with absernce of 
         data on secondary cell                      
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>           


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>      

#
#       Test:    38.36
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absence of data on first subframe and presence of data on second 
         subframe on primary cell with the presenc of data on both subframes 
         on secondary cell                                          
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absence of data on first subframe and presence of data on second 
         subframe on primary cell with the presenc of data on both subframes 
         on secondary cell                                          
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="1" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0" ueId="1"/>
      </tapa.expect> 


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

       #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>


      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="FALSE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>    


#
#       Test:    38.37
#
#       Desc: Primary in mimo mode and secondary in siso mode with M=1 and A=3
#             Two TB on primary and one on secondary 
#              
#              
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in siso mode with M=1 and A=3
       Two TB on primary and one on secondary
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in siso mode with M=1 and A=3
       Two TB on primary and one on secondary
       steps:
       1) PCEll is configured in MIMO(tx mode = TM3)
       2) SCEll is configured in SISO(tx mode = TM1)
       3) scheduling 2 TBs on PCell and 1 TB on SCell 
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>
    
      #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0"
            riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
         lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" 
          lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
       </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" />
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" 
               scellResIdx="2" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE" is1BWithCs="TRUE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="3" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.38
#
#       Desc: Primary in mimo mode and secondary in mimo mode with M=1 and A=4
#             Two TB on primary and one on secondary 
#              
#              
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in mimo mode with M=1 and A=4
       Two TB on primary and one on secondary
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in mimo mode with M=1 and A=4
       Two TB on primary and one on secondary
       steps:
       1) PCEll is configured in MIMO(tx mode = TM3)
       2) SCEll is configured in MIMO(tx mode = TM3)
       3) scheduling 2 TBs on PCell and 1 TB on SCell 
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>
    
      #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0"
            riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
         lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" 
          lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
       </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" 
               scellResIdx="2" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE" is1BWithCs="TRUE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE" isTb2="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 



#
#       Test:    38.39
#
#       Desc:    (M=4):Primary in mimo mode and secondary in siso mode 
#                     Two TB on primary and one on secondary 
#              
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in siso mode 
       Two TB on primary and one on secondary
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in siso mode 
       Two TB on primary and one on secondary
       steps:
       1) PCEll is configured in MIMO(tx mode = TM3)
       2) SCEll is configured in SISO(tx mode = TM1)
       3) scheduling 2 TBs on PCell and 1 TB on SCell 
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" numTxAntPorts="2" txModeEnum="RGR_UE_TM_3"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
    
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" 
               deActCeVal="2" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
      
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0"
            riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>

#DAI 1
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
         lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4"/>
       </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" />
      	</tapa.tfu.dat.req>
      </tapa.expset>         
      
#DAI = 2
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"
            numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 3
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" 
            numLchTb2="1" lchTb2Data="4"/>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

#DAI = 4
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" 
            numLchTb2="1" lchTb2Data="4" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"
            numLchTb2="1" lchTb2Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" 
               scellResIdx="2" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:FALSE:FALSE" is1BWithCs="TRUE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="4" isTb1="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.40
#
#       Desc:    (M=4):1Tb in each subframe for both PCell and SCell
#                      with SR - PUSCH Case
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.40">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4):1Tb in each subframe for both PCell and SCell
      </tapa.desc>

      <tapa.longdesc>
      (M=4):1Tb in each subframe for both PCell and SCell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                    
    
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#DAI = 1
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" 
            lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
       # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 2
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

#DAI = 3
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>

#DAI = 4
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
               vldtGrant="TRUE" vldtTx="TRUE" />
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
        
      </tapa.expset>
      -      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.pusch.recp.req use="0" vldtDatRecp="TRUE" saveTo="2"/>
            <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" isPusch="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
           schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.41
#
#       Desc:  Primary in siso mode and secondary in mimo mode with M=1 and A=3
#              Both the Cells having 1Tb each. Dl harq feedback is received on
#              Pusch
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.41">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
      </tapa.desc>

      <tapa.longdesc>
       Primary in siso mode and secondary in mimo mode with M=1 and A=3
       steps:
       1) PCEll is configured in SISO(tx mode = TM1)
       2) SCEll is configured in MIMO(tx mode = TM3)
       3) scheduling 1 TB ON PCEll and 1 TB on SCell
       4) DL Harq feedback is received on PUSCH
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1" />
     
     #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="FALSE:FALSE:TRUE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>


      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req />
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:FALSE:FALSE" isPusch="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.42
#
#       Desc: Primary in mimo mode and secondary in mimo mode with M=1 and A=3
#             Two TB on primary and one on secondary. trying to send fdbk on pusch 
#              
#              
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.42">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       Primary in mimo mode and secondary in mimo mode with M=1 and A=3
       Two TB on primary and one on secondary
      </tapa.desc>

      <tapa.longdesc>
       Primary in mimo mode and secondary in mimo mode with M=1 and A=3
       Two TB on primary and one on secondary
       steps:
       1) PCEll is configured in MIMO(tx mode = TM3)
       2) SCEll is configured in MIMO(tx mode = TM1)
       3) scheduling 2 TBs on PCell and 1 TB on SCell 
      </tapa.longdesc>

   </tapa.doc>
    # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4"/>
    
      #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_1" tm="CRG_UE_TM_1"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # Send CQI report with RI=2
      # Send CQI indication for periodic mode 1-0
      <tapa.send>
         <tapa.tfu.dlcqi.ind>
            <tapa.tfu.dlcqi type="TFU_RPT_RI" isPucchInfo="TRUE" cqiMode="0"
            riIdx="2" cqiIdx="15" ueId="0" cellId="3" suId="0" schInstId="5"/>
         </tapa.tfu.dlcqi.ind>
      </tapa.send>
      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="2000"/>
      </tapa.send>
      #Steps for BO Updation
 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" 
         lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>
      
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" 
          lchTb1Data="4" numLchTb2="1" lchTb2Data="4"/>
       </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
      		<tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="1"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
               <tapa.tfu.hq.recp.req useScellPdcchIdx="1" validate1B="TRUE" 
               scellResIdx="2" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
             <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:FALSE" is1BWithCs="TRUE" 
             ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="3" isTb1="TRUE" isTb2="TRUE" isPusch="TRUE"/>
        </tapa.tfu.hq.ind>  
     </tapa.send>
      
      #Send some TTIs to check if anything is pending
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase> 

#
#       Test:    38.43
#
#       Desc:    M=2 PUSCH
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         M=2 PUSCH
      </tapa.desc>

      <tapa.longdesc>
         M=2 PUSCH
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="26" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>           

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
               isAckLst="TRUE:TRUE:FALSE:FALSE" ckNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" 
               isPusch="TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>     

#
#       Test:    38.44
#
#       Desc:    (M=4): SPS Occasion 
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.44">
   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      (M=4): SPS Occasion 
      </tapa.desc>

      <tapa.longdesc>
      (M=4): SPS Occasion 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>
      
      <tapa.ifdef>
         <tapa.flag id="LTEMAC_SPS"/>
         <tapa.flag id="TFU_TDD"/>
         <tapa.flag id="TFU_UPGRADE"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit />
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" DLSPSMaxBw="40"
         dlTotalBw="50" rntiSize="2"/>  

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" instId="5" uniqueRntiVldt="FALSE" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" ULSPSEnFlag = "FALSE" 
         DLSPSEnFlag = "TRUE" SPSRnti="65"
         DLSPSSchIntrv="20" NumSPSProc="4"/> 

      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3"
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>

      # Send TTI tick to get CE scheduled. 
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#### SPS LC Config

      <tapa.send>
# Configure a dedicated SPS logical channel for the created UE  
# lcType=5 for DCCH (cm_lte.h) at MAC
      <tapa.crg.cfgreq.cfg.lch instId="0" ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
# Expect success in cfg cfm
      <tapa.crg.cfgcfm status="0" instId="0"/>
      </tapa.expect>

      <tapa.send>
# Create DL SPS service for the UE at scheduler
      <tapa.rgr.cfgreq.cfg.lch  instId="5" spId="0"  ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
      DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#expect config Cfm
      <tapa.expect>
      <tapa.rgr.cfgCfm status = "0"  instId="5" spId="0"/>
      </tapa.expect>

#FIRST BO sched dynamically  
      <tapa.send>
# Send BO for the created SPS service on RGU 
      <tapa.rgu.dstarsp  instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service 
      <tapa.rgu.dstaind  instId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq  instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#PDCCH and PDSCH for FIRST BO
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1"  macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="FALSE" DLSPSInit="FALSE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#HQ FDBK for FIRST BO
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

# Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# ACK sent for First BO
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#Second BO Upd sent with in 20 TTIs
      <tapa.send>
# Send BO for the created SPS service on RGU again
      <tapa.rgu.dstarsp instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

#SPS Activation from to be actvd list succeeds in the next TTI

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.rgu.dstaind instId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req  ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="TRUE" DLSPSInit="TRUE"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

# Do not expect any status indication for SPS service before next SPS
# ocassion.

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" schInstId="5" spId="0">
      <tapa.tfu.hq/>
      </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

### After SPS Activation SPS OCC and BO collision
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="3" bo="20"/>
      </tapa.send>
      
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" 
            macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="3" 
            valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="3"/>
      </tapa.send>
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
       <tapa.tfu.dat.req macInstId="0" spId="0">
          <tapa.tfu.pdsch.dat.req lcId="3" ueId="0" use="2" validateSPS ="TRUE" DLSPSInit="FALSE"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  ueId="0">
            <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     <tapa.delay delay="1"/>    
          
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.45
#
#       Desc:    (M=4):1Tb only in first subframe of both PCell and SCell
#                      with SR - PUSCH Case
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.45">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         (M=4):1Tb only in first subframe of both PCell and SCell
         with SR - PUSCH Case
      </tapa.desc>

      <tapa.longdesc>
         (M=4):1Tb only in first subframe of both PCell(SISO) and SCell(SISO)
          with SR - PUSCH Case
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" txModeEnum="RGR_UE_TM_3"/> 

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" 
         ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT"/>                    
    
      <tapa.rg.addSecCell ueId="0" cellId="3" txModeEnum="RGR_UE_TM_3" 
         pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE"/>
      	</tapa.tfu.dat.req>

       <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE"/>
      	</tapa.tfu.dat.req>
        
      </tapa.expset>
      
      #harqRecp
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="8" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" 
            schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" is1BWithCs="TRUE" 
              isAckLst="TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE:TRUE" 
              ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" isPusch="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
     <tapa.send>
        <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" 
           schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.46
#
#       Desc:   DL Scheduling of SPS OCC on PCELL(1Tb) and SCELL(1Tb) using RR
#               Sched Type with M=1 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling of SPS OCC on PCELL(1Tb) and SCELL(1Tb) using RR
         Sched Type with M=1 and A=4 
      </tapa.desc>

      <tapa.longdesc>
        DL Scheduling of SPS OCC on PCELL(1Tb) and SCELL(1Tb) using RR
        Sched Type with M=1 and A=4 
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit />
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" DLSPSMaxBw="10"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" 
        txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_4" 
        ULSPSEnFlag = "FALSE" DLSPSEnFlag = "TRUE" SPSRnti="500" DLSpsExpltRelCnt="2"
        DLSPSSchIntrv="20" NumSPSProc="4"/>
    
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="24" 
         macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
        n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3"
        tm="CRG_UE_TM_3" prdCqiCfg.type="TRUE" cqiPCfgIdx ="82"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"
        cqiRepType="1" cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"/>

      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="80"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10"  riEna="TRUE" riCfgIdx="1"  
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555" txModeEnum="RGR_UE_TM_3"/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>
      
      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1"
         schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
      #PCEll is SISO and SCell is MIMO hence first two bits will be for Scell
      # And third bit will be for PCell
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE" M="1" A="4" isTb1="TRUE" isTb2="FALSE"
              is1BWithCs="TRUE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
 

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>
     
     ##5,9 
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,0 recp for ri pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

<!--
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="21" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
###8,1 recp for cqi pcell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,2 recp for ri scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
 ###8,3 recp for cqi scell
      <tapa.expect>
     <tapa.tfu.recp.req  instId="5" spId="0">
        <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

#8,3 pcell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,4 pcell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



#8,5 scell ri
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=2 will send RI 1 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#8,6 scell cqi
      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  wbCqi="13" rawDlCqiEnc="TRUE"/>
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

       # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      -->

##8,7
#### SPS LC Config

      <tapa.send>
# Configure a dedicated SPS logical channel for the created UE  
# lcType=5 for DCCH (cm_lte.h) at MAC
      <tapa.crg.cfgreq.cfg.lch instId="0" ueId="0" lcId="3" lcType="5" dir="1"/>
      </tapa.send>

      <tapa.expect>
# Expect success in cfg cfm
      <tapa.crg.cfgcfm status="0" instId="0"/>
      </tapa.expect>

      <tapa.send>
# Create DL SPS service for the UE at scheduler
      <tapa.rgr.cfgreq.cfg.lch  instId="5" spId="0"  ueId = "0" lcId = "3" lcgId = "0" dir = "3" lcType = "5" 
      DLSPSLchEnabFlag="TRUE" DLSPSLchPktSize="40" DLSPSLchPktPrd="20"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#expect config Cfm
      <tapa.expect>
      <tapa.rgr.cfgCfm status = "0"  instId="5" spId="0"/>
      </tapa.expect>




#FIRST BO sched dynamically  
      <tapa.send>
# Send BO for the created SPS service on RGU 
      <tapa.rgu.dstarsp  instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service 
      <tapa.rgu.dstaind  instId="0" lchTb1Data="3" saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq  instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#PDCCH and PDSCH for FIRST BO
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1"  macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="FALSE" DLSPSInit="FALSE" transMode="TFU_UE_TM_3"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="FALSE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

#HQ FDBK for FIRST BO
      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>

# Do not expect any status indication for SPS service before next SPS
# ocassion.

# Send TFU_DELTA + TFU_UL_DELTA Ttis to send fdbk to MAC.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# ACK sent for First BO
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
      <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE" is1BWithCs="TRUE"
       ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE" isTb2="FALSE"/>
      </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="5" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#Second BO Upd sent with in 20 TTIs
      <tapa.send>
# Send BO for the created SPS service on RGU again
      <tapa.rgu.dstarsp instId="0" lcId="3" lcType="5" bo="20"/>
      </tapa.send>

#SPS Activation from to be actvd list succeeds in the next TTI

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      <tapa.expect>
# Expect staInd from MAC to RLC for SPS service for SPS ocassion  
      <tapa.rgu.dstaind instId="0" lchTb1Data="3"  saveTo="2"/>
      </tapa.expect>

      <tapa.send>
# Send data with size equal to the allocated size on RGU. 
      <tapa.rgu.ddatreq instId="0" ueId="0" lchTb1Data="3" lcType="5"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
#PDCCH and PDSCH for SPS ACTIVATION
      <tapa.expset>
      <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
      <tapa.tfu.pdsch.dat.req ueId="0"  use="2" lcId="3" chkSdu="TRUE"
      validateSPS ="TRUE" DLSPSInit="TRUE" transMode="TFU_UE_TM_3"/>
      </tapa.tfu.dat.req>
      <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
      <tapa.tfu.pdcch.cntrl.req saveTo="2" DLSPSInit="TRUE" ueId="0" />
      </tapa.tfu.cntrl.req>
# Expect PDU from MAC to PHY. UeId to check rnti sent by MAC.
      </tapa.expset>




      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
      <tapa.tfu.recp.req numRntis="1" schInstId="5" spId="0">
      <tapa.tfu.hq.recp.req/>
      </tapa.tfu.recp.req>   
      </tapa.expect>


# Do not expect any status indication for SPS service before next SPS
# ocassion.

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
# Send ACK for the received PDU
      <tapa.send>
      <tapa.tfu.hq.ind hqInds="1" cellId="3" schInstId="5" spId="0">
      <tapa.tfu.hq isAckLst="TRUE:FALSE:TRUE:FALSE" is1BWithCs="TRUE"
       ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE" isTb2="FALSE"/>
      </tapa.tfu.hq.ind>   
      </tapa.send>


      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="11" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>



### After SPS Activation SPS OCC and BO collision
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="3" bo="20"/>
      </tapa.send>

      #Steps for BO Updation
      #Send BO for UE1 on instance 0
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>
      #Steps for BO Updation
 
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="3" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" 
            numLchTb2="0" lchTb2Data="0" valdtTrue="1" />
      </tapa.expset>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="0" numLchTb1="1" lchTb1Data="3"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>
       
      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     <tapa.expset>
      
       <tapa.tfu.dat.req macInstId="0" spId="0">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="2" validate="TRUE" transMode="TFU_UE_TM_3"/>
      	</tapa.tfu.dat.req>

      	<tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
      
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>         

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0"  >
               <tapa.tfu.hq.recp.req ueId="0" useScellPdcchIdx="1" validate1B="TRUE" scellResIdx="2" isScell2ndTbValid="FALSE"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:TRUE:FALSE" is1BWithCs="TRUE"
              ackNackModeEnum="TFU_ACK_NACK_MULTIPLEXING" M="1" A="4" isTb1="TRUE" isTb2="FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="10" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
     <tapa.delay delay="1"/>    
     
     </tapa.test>

     # Clean subsection
     <tapa.clean>
        #Command To ShutDown LTEMAC Layer
        <tapa.rg.multiInstmacDeInit/>
     </tapa.clean>

     # Shutdown subsection
     <tapa.shutdown/>

</tapa.testcase>

#
#       Test:    38.47
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#               CSI of Primary collide with feedback of two DL Sf.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=1 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" ueCatEnum="CM_LTE_UE_CAT_4"
         />
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="1" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0" ueId="1"/>
      </tapa.expect> 


      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Configure P-CQI for P-cell
      <tapa.send>
          <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="59"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"
          sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="FALSE" n2PucchIdx="555"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="FALSE" n2PucchIdx="555"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="27" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

       #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            #<tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   


#
#       Test:    38.48
#
#       Desc:   DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
#               Presence of data on both the serving cells
#               CSI of secondary collide with feedback of two DL Sf.
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc38.xml
#
#
<tapa.testcase id="38.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using RR Sched Type. M=2 and A=4
         Absernce of data on primary cell with presence of data on seconday cell
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="1" spclSfCfgIdx="7" numTxAntPorts="2" maxUePerDlSf="1" maxDlUeNewTxPerTti="1"/>

      #Initialize 1 UE per instance
      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="0" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_MULT" ueCatEnum="CM_LTE_UE_CAT_4"
         />
      
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8"
      prdCqiCfg.type="TRUE" cqiPCfgIdx ="59" prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1"
      cqiPResIdx="666"  riEna="TRUE" riCfgIdx="1"  txModeEnum="RGR_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="4" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>


      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
              <tapa.tfu.hq ueId="0" isAckLst="TRUE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="0" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0"/>
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="19" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      <tapa.send>
         <tapa.tfu.rawdlcqi.ind>
            <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
         </tapa.tfu.rawdlcqi.ind>
      </tapa.send>

      <tapa.rg.multiInst1UeOnFirstCellTddCM1 ueId="1" uniqueRntiVldt="FALSE" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ackNackModeEnum="RGR_TDD_ACKNACK_MODE_BUNDL"/>

      # Steps for LC creation for 1st Ue on instance 0
      # Configure a dedicated logical channel for the created UE  
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch instId="0"  ueId="1" lcId="4" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm instId="0"/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch ueId="1" lcId="4" dir="3" lcType="5" instId="5" spId="0" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5" spId="0" ueId="1"/>
      </tapa.expect> 

      <!--
      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Configure P-CQI for P-cell
      #<tapa.send>
      #    <tapa.rgr.cfgreq.recfg.ue  ueId="0" prdCqiCfg.type="TRUE" cqiPCfgIdx ="59"  prdModeEnum="RGAC_RGR_PRD_CQI_MOD10" cqiRepType="1" riEna="TRUE" riCfgIdx="1"
      #    sANCQI="TRUE" UeReCfgType="4096" cqiPResIdx="555"/>
      #</tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #<tapa.expset>
      #   <tapa.rgr.cfgCfm status="0" instId="5"/>
      #</tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="18" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #<tapa.expset>
      #   <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
      #      <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="FALSE" n2PucchIdx="555"/>
      #   </tapa.tfu.recp.req>   
      #</tapa.expset>
      -->
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #<tapa.expset>
      #   <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
      #      <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="FALSE" n2PucchIdx="555"/>
      #   </tapa.tfu.recp.req>   
      #</tapa.expset>
      <!--
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      #<tapa.send>
      #   <tapa.tfu.rawdlcqi.ind>
      #      <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="1" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
      #   </tapa.tfu.rawdlcqi.ind>
      #</tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      #Send Raw CQI Indication 
      #<tapa.send>
      #   <tapa.tfu.rawdlcqi.ind>
      #      <tapa.tfu.rawdlcqi ueId="0" instId="5" spId="0"  rawDlCqiEnc="TRUE" ri="2" wbCqi="10" /> #RI=1 will send RI 2 in raw cqi ind
      #   </tapa.tfu.rawdlcqi.ind>
      #</tapa.send>



      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="27" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      -->
      #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />
      </tapa.expect>

      <tapa.expect>
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>
      </tapa.expect>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
          <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>
 
      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
          <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
       </tapa.send>

       #Send BO for UE2 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="1" lcId="4" bo="500"/>
      </tapa.send>

      #Send BO for UE1 on instance 0
      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="500"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="1" cellId="3" numLchTb1="1" lchTb1Data="4" valdtTrue="1" />

         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" valdtTrue="1" numLchTb2="1" lchTb2Data="4"/>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>         

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 0
         <tapa.rgu.ddatreq  instId="0" cellId="3" ueId="1" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send>

      <tapa.send>
         # Send DDatReq for 1st Ue on inst 1
         <tapa.rgu.ddatreq  instId="1" cellId="4" ueId="0" numLchTb1="1" lchTb1Data="4"/>
      </tapa.send> 

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="1" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="1" use="0" validate="TRUE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
            <tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="1" spId="1">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="FALSE" transMode="TFU_UE_TM_3"/>
         </tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req ueId="0"/>
            <tapa.tfu.hq.recp.req ueId="1"/>
            #<tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="555"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>
      ## expect hq feedback for the first Ue's on both instance
      <tapa.expset>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.dlcqi.recp.req  instId="5" spId="0" vldtPucchRsrc="TRUE" n2PucchIdx="666"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="2" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE"/>
            <tapa.tfu.hq ueId="1" isAckLst="TRUE:TRUE"/>
         </tapa.tfu.hq.ind>  
      </tapa.send>

      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>   

#
#       Test:    38.49
#
#       Desc:   DL Scheduling on PCELL and SCELL using PFS Sched Type
#               with M=4 and A=4
#
#       Notes:   None
#
#       Module:  "MAC Module"
#
#       File:    rgac_tc37.xml
#
#
<tapa.testcase id="38.49">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         DL Scheduling on PCELL and SCELL using PFS Sched Type
         with M=4 and A=4
      </tapa.desc>

      <tapa.longdesc>
         DL Scheduling on PCELL and SCELL using PFS Sched Type
         with M=4 and A=4
      </tapa.longdesc>

   </tapa.doc>
 # Require features and flags subsection
   <tapa.require>


      <tapa.ifdef>
         <tapa.flag id="TFU_TDD"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Initialize LTEMAC instances for 2 Cell
      <tapa.rg.multiInstMacInit/>
      #Initialize Saps for 2 Cells
      <tapa.rg.multiInstCellSapInit/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Initialize Cells per instance
      <tapa.rg.multiInstCellInit ulDlCfgIdx="2" spclSfCfgIdx="7" dlSchdType="1" 
         dlThroughputFactor="10" dlFairnessFactor="10" numTxAntPorts="2"/>

      <tapa.rg.multiInst1UeOnFirstCellTddCM2 ueId="0" uniqueRntiVldt="FALSE" ambrPres="TRUE" dlAmbr="8000"
         txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3" ueCatEnum="CM_LTE_UE_CAT_5"/>
    
      #in SCell default mode is TM3 
      <tapa.rg.addSecCell ueId="0" cellId="3" pucchFormatType="RG_SCH_UCI_FORMAT1B_CS" 
         n1PUCCHValTB1="0:1:2:3" n1PUCCHValTB2="5:6:7:8" txModeEnum="RGR_UE_TM_3" tm="CRG_UE_TM_3"/>

      <tapa.send>
         <tapa.rgr.actDeact.scell sCellActionType="2"/>
      </tapa.send>
      # expect cfm in the same tti
      <tapa.expect>
         <tapa.rgr.cfgCfm ueId="0"/>
      </tapa.expect>
      
      # Send TTI tick to get CE scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="2" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1" macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4"  validate="TRUE" chkSCellDeActCe="TRUE" deActCeVal="2" />
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="7" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

     ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req expRecpReq="1" schInstId="5" spId="0">
               <tapa.tfu.hq.recp.req ueId="0"/>
            </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for waiting for hq feedback
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for scell act ce
     <tapa.send>
        <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
           <tapa.tfu.hq ueId="0" isAckLst="TRUE:TRUE:TRUE:TRUE:FALSE:FALSE:FALSE:FALSE"/>
        </tapa.tfu.hq.ind>   
     </tapa.send>
      
     <tapa.rg.pfsSim.cfg.lch ueId="0" cellId="3" lchData="3:1:1:4:4000:5000;4:7:1:4:0:0"/>   

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="16" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # send Ri Repprt for cell1 
      <tapa.send>
         <tapa.rg.pfssim.cqiCfg cellId ="3" sCellIdx="0" ttiTime="330" cqiPattern="100"
            cqiConfigPattern="4" ueLst="0" sndCqi="TRUE" sndRi="TRUE"/>
      </tapa.send>

      # send Ri Repprt for cell2 
      <tapa.send>
         <tapa.rg.pfssim.cqiCfg cellId ="3" sCellIdx="1" ttiTime="330" cqiPattern="100"
            cqiConfigPattern="4" ueLst="0" sndCqi="TRUE" sndRi="TRUE"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="3" bo="1000"/>
      </tapa.send>

      <tapa.send>
         <tapa.rgu.dstarsp instId="0" cellId="3"  ueId="0" lcId="4" bo="1000"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.rgu.dstaind instId="0" ueId="0" cellId="3" numLchTb1="1" lchTb1Data="3" numLchTb2="2" lchTb2Data="3:4" valdtTrue="1" />
         <tapa.rgu.dstaind instId="1" ueId="0" cellId="4" numLchTb1="1" lchTb1Data="4" numLchTb2="1" lchTb2Data="4" valdtTrue="1" />
      </tapa.expset>

      <!--
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="1" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="0">
            <tapa.tfu.pdcch.cntrl.req cellId="3" ueId="0" saveTo="0"/>
         </tapa.tfu.cntrl.req>

         <tapa.tfu.dat.req macInstId="0" spId="0">
            <tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="0" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="2"/>
         </tapa.tfu.dat.req>

         <tapa.tfu.cntrl.req expCntrlReq="1" schInstId="5" spId="1">
      		<tapa.tfu.pdcch.cntrl.req cellId="4" ueId="0" saveTo="1"/>
     	 </tapa.tfu.cntrl.req>
       
       <tapa.tfu.dat.req macInstId="1" spId="1">
      		<tapa.tfu.pdsch.dat.req lcId="4" ueId="0" use="1" validate="TRUE" transMode="TFU_UE_TM_3" numTb1Lyrs="2"/>
      	</tapa.tfu.dat.req>
      </tapa.expset>          

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="6" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      ## expect hq feedback for the first Ue's on both instance
      <tapa.expect>
         <tapa.tfu.recp.req schInstId="5" spId="0" ueId="0" >
            <tapa.tfu.hq.recp.req/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind multiInstEna="1"  numInst="2" numTti="3" macInstId="0:1" schInstId="5" macSuId="0:1" schSuId="0:1" cellId="3:4"/>
      </tapa.send>

      # ACK sent for First BO
      # Send ACK for the received PDU
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1" cellId="3" suId="0" schInstId="5">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      <tapa.delay delay="1"/>      
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.multiInstmacDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown/>

</tapa.testcase>  

