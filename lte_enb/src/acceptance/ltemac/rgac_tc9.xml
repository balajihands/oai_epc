#
#/********************************************************************20**
#
#     Name:    LTE-MAC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases For MeasGap, Ack/NackRep, and ECP 
#
#     File:    rgac_tc9.xml
#
#     Sid:      rgac_tc9.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#     Prg:     ns 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=9:sm:rgac_tc9.xml


#############################################
#
#
#       Test:    9.1
#
#       Desc:    Verify that Measurement GAP can be configured for a UE. 
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Measurement GAP can be configured for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.2
#
#       Desc:    Verify that Measurement GAP can be re-configured for a UE. 
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc9.xml
#
#############################################
<tapa.testcase id="9.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Measurement GAP can be re-configured for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that UE re-configuration with measurement GAP is successful and
         validate that the UE is not scheduled during measurement GAP in
         downlink. First configure with 40ms Periodicity then with 80ms."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE-Reconfig with periodicity = 80 ms.
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="256"
            isMesGapEnabled="TRUE" gapPrd="80" gapOffst="60" instId="5" />
      </tapa.send>
   # Send a Tti to get the configuration applied. 
   <tapa.send>
      <tapa.tfu.tti.ind/>
   </tapa.send>
   #Expect positive Configuration Confirm from Scheduler
   <tapa.expect>
      <tapa.rgr.cfgCfm instId="5"/>
   </tapa.expect>
   
   # Send TTI indication so that we reach the start of measGap
   <tapa.send>
      <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
   </tapa.send>

   <tapa.send>
      # Send BO for the created logical channel on RGU. 
      <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
   </tapa.send>

   # Expect StaInd only after (6 - DL_DELTA) = 3
   <tapa.send>
      # Send a Tti to get the transmission scheduled. 
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.expect>
      # Expect staInd from MAC to RLC for Msg4 
      <tapa.rgu.dstaind lchTb1Data="1" />
   </tapa.expect>

   <tapa.send>
      # Send data with size less than the allocated on RGU. 
      # if we can send less data from TA or to report a BO which
      # will surely result in padding 
      <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
   </tapa.send>

   <tapa.send>
      # Send DL_DELTA Ttis to get the MAC PDU at PHY.
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.cntrl.req numCntrlReq="1">
         <tapa.tfu.pdcch.cntrl.req/>
      </tapa.tfu.cntrl.req>
      <tapa.tfu.dat.req datReqs="1">
         <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
      </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.recp.req numRntis="1" spId="1">
         <tapa.tfu.hq.recp.req ueId="0"/>
      </tapa.tfu.recp.req>   
   </tapa.expset>

   <tapa.send>
      # Send a 2 TTIs to Send the HARQ ACK Indication
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.hq.ind hqInds="1">
         <tapa.tfu.hq ueId="0"/>
      </tapa.tfu.hq.ind>   
   </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.3
#
#       Desc:    Verify that during Measurement GAP a UE is not scheduled for
#       uplink transmission.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that during Measurement Gap a UE is not scheduled for uplink
         transmission.
      </tapa.desc>

      <tapa.longdesc>
         "Verify that during measurement Gap a UE is not scheduled for uplink
         transmission."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication such that measurement Gap starts after 'X' subframes
      # X = UL_DELTA + RG_UL_SCHED_DELTA + 4  = 1 + 2 + 4 = 7.
   <tapa.send>
      <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="7"/>
   </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Should not recieve any UL Allocations
      <tapa.timeout/>
      
     # Send a TTI 10 TTIs such that we reach 2 subframes before the end of Measurement Gap
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send>
      
      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.4
#
#       Desc:    Verify that In downlink MAC does not schedule a UE if the HARQ
#       Feedback of the retransmission coincides with the measurement Gap.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc9.xml
#
#############################################
<tapa.testcase id="9.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
          "Verify that In downlink MAC does not schedule a UE if the HARQ
          Feedback of the retransmission coincides with the measurement Gap."
      </tapa.desc>

      <tapa.longdesc>
          "Verify that In downlink MAC does not schedule a UE if the HARQ
          Feedback of the retransmission coincides with the measurement Gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we are 17 subframes away from the start of
      # the next Measurement Gap. This would be enough to have a downlink
      # retransmission such that the feedback coincides with the Measurement
      # Gap.
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="17"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only 1 subframe
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send 1 TTI to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

   <tapa.send>
      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.expset>
      <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0" isAck="FALSE"/>
     </tapa.tfu.hq.ind>   
  </tapa.send>

  <tapa.send>
     # Send a 2 TTIs to See a Retransmission 
     <tapa.tfu.tti.ind numTti="2"/>
  </tapa.send>

   <tapa.send>
     # Send a 2 more TTIs to See a Retransmission comes or not
     <tapa.tfu.tti.ind numTti="2"/>
  </tapa.send>

  <tapa.timeout/>

</tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.5
#
#       Desc:    Verify HarqReq isn't sent for Uplink retransmission, if the
#       timing of the HARQ Feedback coincides with Measurement Gap.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify HarqReq isn't sent for Uplink retransmission, if the
         timing of the HARQ Feedback coincides with Measurement Gap."
      </tapa.desc>

      <tapa.longdesc>
         "Verify HarqReq isn't sent for Uplink retransmission, if the
         timing of the HARQ Feedback coincides with Measurement Gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit ueId="0" isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"
         maxUlHqTx="4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication such that measurement Gap starts after '21' subframes
      # 21 subframes is enough to accomodate Uplink retransmission such that the
      # feedback of the retransmission co-incides with measurement Gap.
   <tapa.send>
      <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="18"/>
   </tapa.send>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE" />
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE" />
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.6
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.7
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
# ccpu00119087 MOD changes in retransmsission when there is a DTX
#
#
#       Test:    9.8
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="0"/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--    
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      # ccpu00119087 MOD changes in retransmsission when there is a DTX
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.9
#
#       Desc:    Verify that MAC does not schedule a UE when measurement Gap
#       coincides with the HARQ Feedback.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that MAC does not schedule a UE when measurement Gap
         coincides with the HARQ Feedback."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that MAC does not schedule a UE when measurement Gap
         coincides with the HARQ Feedback. Also check if the UE is scheduled
         after the end of measurement Gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we are 8 subframes away from the start of
      # measurement gap. DL_DELTA (3) + HARQ_FBKTIME (4) + 1 
      # This gives enough time to get HARQ feedback to coincide with measurement
      # Gap.
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="8"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>
      # Expect StaInd only after 11 TTIs Measurement gap expires after 3
      # subframes from the point after these 11 TTIs
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.10
#
#       Desc:    Verify that MAC does not schedule a UE when measurement Gap
#       coincides with the HARQ Feedback for the retransmission.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that MAC does not schedule a UE when measurement Gap
         coincides with the HARQ Feedback for the retransmission."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that MAC does not schedule a UE when measurement Gap
         coincides with the HARQ Feedback for the retransmission. Also 
         check if the UE is scheduled after the end of measurement Gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication so that we are 15 subframes away from the start of
      # measurement gap. 
      # This gives enough time to get HARQ feedback for a retransmission to 
      # coincide with measurement Gap.
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="15"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after 1 TTIs 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         # Send a 2 TTIs to See a Retransmission 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.timeout/>

      # Send a 2 more TTIs to verify UE is not scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.11
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE, 
#       and when disabled MAC expects a single feedback.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE, 
       and when disabled MAC expects a single feedback."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE,
       and when disabled MAC expects a single feedback."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      #disable ACK NACK repetiton
      <tapa.send>
          <tapa.crg.cfgreq.recfg.ue  cellId="3"/>
      </tapa.send>

      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
          <tapa.crg.cfgcfm />
       </tapa.expect>
       
       # Send UE ReConfiguration with acknack disabled
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue   UeReCfgType="256" cellId="3" oldUeId="0" 
            newcrnti="11" instId="5" isAckNackEnabled="FALSE" />
      </tapa.send>
      # Send a Tti to get the configuration applied. 
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      #Expect negative Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm />
       </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      # Send a 4 TTIs to get the harqrecpRequest from MAC
      # We should see a single recpReq
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>
   
   # Send a few extra TTIs
   <tapa.send>
      <tapa.tfu.tti.ind numTti="4"/>
   </tapa.send>

   <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>



#############################################
#
#
#       Test:    9.12
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall not schedule the UE for downlink in subframes n+1, n+2, n+3 for
#       RepFactor = 4.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         shall not schedule the UE for downlink in subframes n+1, n+2, n+3 for
         RepFactor = 4."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         shall not schedule the UE for downlink in subframes n+1, n+2, n+3 for
         RepFactor = 4."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU (ideally this should be
      # scheduled at n + 3.
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Do not expect a StaInd as the UE is marked as Inactive for n+1, n+2,
      # n+3.

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      # Send a 3 TTIs to get the DStaInd from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

       <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

  
      # Send a 1 TTIs to get the HarqRecpReq from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect the UE to be scheduled at this point.
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="FALSE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

       <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.13
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE, and
#       wont be scheduled in Uplink for subframes n+4, n+5, n+6, n+7.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         shall expect the configured number of HARQ Feedback from the UE, and
         wont be scheduled in Uplink for subframes n+4, n+5, n+6, n+7."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         shall expect the configured number of HARQ Feedback from the UE, and
         wont be scheduled in Uplink for subframes n+4, n+5, n+6, n+7."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>


      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Do not expect a format 0 to go out for UL
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 2 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      # ccpu00111742: Sending NACK in PHICH for failed UL TX
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>    
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" />
       </tapa.tfu.dat.ind>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.14
#
#       Desc:    Verify DataRecpReq is not sent for a UE when it timing of an
#       uplink retransmission coincides with the ACK/NACK repetiton.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify DataRecpReq is not sent for a UE when it timing of an
         uplink retransmission coincides with the ACK/NACK repetiton."
      </tapa.desc>

      <tapa.longdesc>
         "Verify DataRecpReq is not sent for a UE when it timing of an
         uplink retransmission coincides with the ACK/NACK repetiton."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20"/>
      #Initialize UE
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
        maxUlHqTx="4" ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" prdBsrTmr="320"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 TTIs to expect a Recp Req
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE" rv="2"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      # Expect HARQ NACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect> 
      # Expect DCI format 0 and do basic validations of the grant
     # <tapa.expset>
     #   <tapa.tfu.cntrl.req numCntrlReq="1">
     #      <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
              vldtGrant="TRUE" vldtRetx="TRUE"/>
     #   </tapa.tfu.cntrl.req>
     # </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"
                   isRtx="TRUE"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 1 TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send BO for the created logical channel on RGU. 
      <tapa.send>
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>
      
      # Send 2 TTI
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE" rv="2"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ NACK in PHICH
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="2">
           <tapa.tfu.phich.cntrl.req isAck="FALSE"/>
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1" expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1" expRecpReq="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.phich.cntrl.req vldtRbStart="FALSE" use="1" isAck="FALSE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect> 

    #  <tapa.expect>
    #     <tapa.tfu.cntrl.req numCntrlReq="2" expCntrlReq="1">
    #        <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE"
    #           vldtGrant="TRUE" vldtRetx="TRUE"/>
    #     </tapa.tfu.cntrl.req>
    #  </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

     # Do not Expect HARQ ACK in PHICH
      <tapa.timeout/>

   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

###################################################### 
#
#
#       Test:    9.15
#
#       Desc:    To test that Extended CP can be configured for downlink and the
#       allocations change accordingly.
#                
#
#       Notes:   THIS TC Shall not pass with RR as RR does not estimate the RLC
#       header length hence the allocations are different. 
#              
#       Module:  ECP
#
#       File:    rgac_tc9.xml
#
#
###################################################### 
<tapa.testcase id="9.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "To test that Extended CP can be configured for downlink and the
         allocations change accordingly."
      </tapa.desc>

      <tapa.longdesc>
         "To test that Extended CP can be configured for downlink and the
         allocations change accordingly."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit isCpDlExtend="TRUE"/>

      # UE Creation
      <tapa.rg.UeInit ueCatEnum="1" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="167"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   <tapa.expset>
      # Values are hard coded please check again if common allocation module
      # changes.
     <tapa.tfu.cntrl.req numCntrlReq="1">
        <tapa.tfu.pdcch.cntrl.req vldtRbAlign="TRUE" rbStart="0" numRb="41"/>
     </tapa.tfu.cntrl.req>
     <tapa.tfu.dat.req datReqs="1">
        <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
     </tapa.tfu.dat.req>
   </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   <tapa.expset>
     <tapa.tfu.recp.req numRntis="1" spId="1">
        <tapa.tfu.hq.recp.req ueId="0"/>
     </tapa.tfu.recp.req>   
   </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

   <tapa.send>
     <tapa.tfu.hq.ind hqInds="1">
        <tapa.tfu.hq ueId="0"/>
     </tapa.tfu.hq.ind>   
   </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    9.16
#
#       Desc:    To validate extended CP can be configured in uplink and
#       allocations change accordingly.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc8.xml
#
#
<tapa.testcase id="9.16">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To validate extended CP can be configured in uplink and
         allocations change accordingly."
         "To validate UL HARQ processing for 1 MAC SDU without MAC CEs."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit maxUlBwPerUe="32" ngEnum="RGAC_RGR_NG_ONE" size="1"
         ulTotalBw="50" numSubbands="36" isCpUlExtend="TRUE"/>
      #Initialize UE
      <tapa.rg.UeInit ueCatEnum="CM_LTE_UE_CAT_3" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" addShortBsr="TRUE" lcgId="0" bsr="28"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Send a TTI to schedule BSR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expect>
         <tapa.tfu.cntrl.req expCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="6" isUlGrant="TRUE"
              rbStart="2" numRb="27" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>


   </tapa.test>


   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    9.17
#
#       Desc:    To verify that extended duration PHICH can be configured.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc8.xml
#
#
<tapa.testcase id="9.17">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To Verify that extended duration phich can be configured."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="20" cfi="3" isDurExtend="TRUE"/>
      #Initialize UE
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    9.18
#
#       Desc:    Verify that MAC does not send a PDCCH order to a UE that is undergoing
#         a measurement gap.
#
#       Notes:   None
#              
#       Module:  Timing Advance
#
#       File:    rgac_tc9.xml
#
#
<tapa.testcase id="9.18">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id="Timing Advance"/>

      <tapa.desc>
         "Verify that MAC does not send a PDCCH order to a UE that is undergoing
         a measurement gap."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that MAC does not send a PDCCH order to a UE that is undergoing
         a measurement gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit numRaPreamble="30" sizeRaPreambleGrpA="25"
            preambleSetPres="1" preambleStart="30" preambleSize="20"
            sfnEnum="RGAC_RGR_SFN_ANY" raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" raOccSize="10"/>

      # UE configuration
      <tapa.rg.UeInit isMesGapEnabled="TRUE" 
         gapPrd="40" gapOffst="20" taTmrPres="TRUE" taTmr="40"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/>
     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4"/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm status="0"/>
      </tapa.expect>

     <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.rgr.cfgreq.cfg.lch ueId="0" lcId="9" lcType="5" dir="3"
            lcgId="0" ulQci="4" dlQci="4" instId="5"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the configuration applied. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm status="0" instId="5"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>  

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send>
         <tapa.tfu.tti.ind numTti="10"/>
      </tapa.send> 

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" chkTA="TRUE"
               taVal="31" chkPadding="TRUE" chkPadBytes="TRUE" padHdrs="1"/>
         </tapa.tfu.dat.req>
      </tapa.expset>
      
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # expect a recp req for this UE.
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="5"/>
      </tapa.send>   

      # Send 3 Ttis, to make sure TA is not scheduled for idle UE.  
      <tapa.send lc="TRUE">
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

       
      # Send BO for the created logical channel on RGU to trigger a PO. 
      <tapa.send>
         <tapa.rgu.dstarsp ueId="0" lcId="9" lcType="5" bo="10"/>
      </tapa.send>

      # PDCCH order is not generated since UE is inactive due to meas gap
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId="0" vldtPO="TRUE" poRapId="30" prachMaskIdx="8"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
     </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq  raRnti="5" numRapId="1" rapIds="30"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
        <tapa.tfu.dat.req datReqs="1">
           #poHoUeId is changed
           <tapa.tfu.rarsp.req poUeId="11"/>
        </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

      # Layer Manager ShutDown

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.19
#
#       Desc:    Verify that if ACK/NACK and measurement gap coincide then the
#       UE is activated only after it is active as per ACK/NACK and measurement
#       gap.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that if ACK/NACK and measurement gap coincide then the
         UE is activated only after it is active as per ACK/NACK and measurement
         gap."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that if ACK/NACK and measurement gap coincide then the
         UE is activated only after it is active as per ACK/NACK and measurement
         gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" isMesGapEnabled="TRUE" 
         gapPrd="40" gapOffst="35"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send TTI indication so that we reach the start of measGap 
      # We should be far enough to do a downlink transmission 8 + 3
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="12"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send SR Indication for default UE
      <tapa.send>
         <tapa.tfu.sr.ind>
            <tapa.tfu.sr/>
         </tapa.tfu.sr.ind>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>


      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Do not expect a format 0 to go out for UL
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Ideally we would get a grant over here but due to meas Gap we shouldn't
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>


      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 6 - TFU_DELTA TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect Uplink grant - we would be out of measGap after TFU_DELTA
      # subframes
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req isUlGrant="TRUE" saveTo="1"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.20
#
#       Desc:    Verify that in the case of an overlap of measurement Gap and
#       some of the feedback of Ack/Nack repetiton. The final decision i.e.
#       transmission or retransmission shall be taken on the number of feedbacks
#       that were received and make sure that we dont send RecpReq for HARQ
#       feedback that coincide with the measurement gap.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.20">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that in the case of an overlap of measurement Gap and
         some of the feedback of Ack/Nack repetiton. The final decision i.e.
         transmission or retransmission shall be taken on the number of feedbacks
         that were received and make sure that we dont send RecpReq for HARQ
         feedback that coincide with the measurement gap."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that in the case of an overlap of measurement Gap and
         some of the feedback of Ack/Nack repetiton. The final decision i.e.
         transmission or retransmission shall be taken on the number of feedbacks
         that were received and make sure that we dont send RecpReq for HARQ
         feedback that coincide with the measurement gap."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" isMesGapEnabled="TRUE" 
         gapPrd="40" gapOffst="30"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      # Send TTI indication so that a transmission at n + 3 and its feedback (3
      # of them) would overlap with the measurement gap.
      # We should be far enough to do a downlink transmission 8 
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="9"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send data with size less than the allocated on RGU. 
      # if we can send less data from TA or to report a BO which
      # will surely result in padding 
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect a downlink data
      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1" expCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" use="1" saveTo="2"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Send a 4 TTIs to get the harqrecpRequest from MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # HARQ RecpReq #1
      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs Do NOT expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a 1 TTIs DO NOT expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs Do not send HARQ # 2
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a 1 TTIs Do not send HARQ #3
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Send a 1 TTIs Do not send HARQ #4
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

     # Send a 1 TTIs Do not send HARQ #4
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      <tapa.expset>
          # Expect PDU from MAC to PHY.
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate = "TRUE" use="1" saveTo="3"
               vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate = "TRUE" use="3" isRetx="TRUE" retxUse="2"
                 vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.21
#
#       Desc:    Verify that re-config of Measurement Gap works.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Measurement GAP can be re-configured for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Measurement GAP can be re-configured for a UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      #<tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30" />
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE Re-config to enable measurement Gap 
      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ueId="0" UeReCfgType="256"
            isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after (6 - DL_DELTA) = 3
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE Re-config to disable measurement Gap 
      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ueId="0" UeReCfgType="256"
            isMesGapEnabled="FALSE"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="0"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send extra expect nothing
      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.22
#
#       Desc:    Verify that re-config of ACK NACK works.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that ACK NACK repetiton can be re-configured for a UE."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that ACK NACK repetiton can be re-configured for a UE."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE Re-config to enable ACK NACK Rep 
      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ueId="0" isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" UeReCfgType="256"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send UE Re-config to disable ACK NACK repetiton 
      # Send UE config request
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue ueId="0" UeReCfgType="256"
            isAckNackEnabled="FALSE"/>
      </tapa.send>

      # Send TTI to apply the config
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      # Expect success in cfg cfm
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send extra expect nothing
      <tapa.send>
         # Send a 2 TTIs to Send the HARQ ACK Indication
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#############################################
#
#
#       Test:    9.23
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. 
#       If we send 2 ACKs and 2 NACKs - NACK is assumed
#       If we send 1 ACKs and 3 NACKs - NACK is assumed
#       If we send 1 ACKs and 1 NACKs and 2 DTX - NACK is assumed
#       If we send 3 ACKs and 1 NACKs - ACK is assumed
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. 
       If we send 2 ACKs and 2 NACKs - NACK is assumed
       If we send 3 ACKs and 1 NACKs - ACK is assumed
       If we send 1 ACKs and 3 NACKs - NACK is assumed
       If we send 1 ACKs and 1 NACKs and 2 DTX - NACK is assumed"
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. 
       If we send 2 ACKs and 2 NACKs - NACK is assumed
       If we send 3 ACKs and 1 NACKs - ACK is assumed
       If we send 1 ACKs and 3 NACKs - NACK is assumed
       If we send 1 ACKs and 1 NACKs and 2 DTX - NACK is assumed"
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         maxUlHqTx="4" ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      # Send data with size less than the allocated on RGU. 
      # if we can send less data from TA or to report a BO which
      # will surely result in padding 
      <tapa.send>
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE" use="1" saveTo="2"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate = "TRUE" use="1" saveTo="3"
               vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req  use="3"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Expect retrnsmission
      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate = "TRUE" use="1" saveTo="3"
               vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req  use="3"
                 isRetx="TRUE" retxUse="2" validate="TRUE" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Expect retrnsmission
      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 

      <tapa.expset>
         # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate = "TRUE" use="1" saveTo="3"
               vldtRetx="TRUE"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate = "TRUE" use="3"
                 isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      # Expect retrnsmission
      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="TRUE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send> 

      # Do not expect anything
      <tapa.timeout/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    9.24
#
#       Desc:    To verify that extended duration PHICH configuration fails if
#       CFI configuration is not matching.
#
#       Notes:   None
#              
#       Module:  uplink.datapath
#
#       File:    rgac_tc8.xml
#
#
<tapa.testcase id="9.24">>

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36321.830" section=""/>
      <tapa.module id="uplink.datapath"/>

      <tapa.desc>
         "To verify that extended duration PHICH configuration fails if
         CFI configuration is not matching."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>
      #Initialize CELL

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Send Bind Request for CRG SAP 
      <tapa.send>
         <tapa.crg.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.crg.bndcfm/>
      </tapa.expect>
      
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgr.bndreq instId="5"/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgr.bndcfm/>
      </tapa.expect>
      #Send Bind Request for RGR SAP 
      <tapa.send>
         <tapa.rgu.bndreq/>
      </tapa.send>
      
      # Expect positive Configuration Confirm from MAC
      <tapa.expect>
         <tapa.rgu.bndcfm/>
      </tapa.expect>

 
      #<tapa.rg.dbgInitAll/>
      #Expect NOK_DONE Control Confirm from LTE MAC
      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.cntrlreq suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.cntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.bndreq instId="0"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.bndcfm suId="0" instId="0"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.cntrlcfm/>
      </tapa.expect>

      #Send Control Request to Enable TFU SAP
      <tapa.send>
         <tapa.lrg.schcntrlreq instId="5" suId="0" spId="0" action="ABND" elmntType="STTFUSAP" />
      </tapa.send>

      <tapa.expect>
         <tapa.lrg.schcntrlcfm status="LCM_PRIM_OK_NDONE" reason="LCM_REASON_NOT_APPL" instId="5"/>
      </tapa.expect>

      # Ecpect Dummy TFU Bind Request
      <tapa.expect>
         <tapa.tfu.sch.bndreq instId="5" spId="1"/>
      </tapa.expect>
      
      #<tapa.rg.dbgDeInitAll/>
      #Send Dummy TFU Bind Confirm
      <tapa.send>
         <tapa.tfu.sch.bndcfm suId="0" instId="5" spId="1"/>
      </tapa.send>

      #Expect positive Control Confirm from LTE MAC
      <tapa.expect>
         <tapa.lrg.schcntrlcfm instId="5"/>
      </tapa.expect>

      #Send CRG Cell Configuration
      <tapa.send>
         <tapa.crg.cfgreq.cfg.cell/>
      </tapa.send>
      

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #<tapa.rg.dbgDeInitAll/>

      #Send Common Logical Channel Configuration BCCH->BCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="1" dir="1" lcType="1" dlTrchType="1"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH1
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="2" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      #Send Common Logical Channel Configuration PCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="3" dir="1" lcType="2"/>
      </tapa.send>
     
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration CCCH
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch  crnti="1234" lcId="4" dir="3" lcType="3"
            dlTrchType="3" ulTrchType="5"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Send Common Logical Channel Configuration BCCH->DLSCH2
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch crnti="1234" lcId="5" dir="1" lcType="1"
            dlTrchType="3"/>
      </tapa.send>
      
      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      #Sending RGR CELL Configuration
      #cmnLcInfo = "lcId:lcType:dir:dlTrchType:ulTrchType:...."
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.cell instId="5" numCmnLc="5"
         cmnLcInfo="1:1:1:1:0:2:1:1:3:0:3:2:1:0:0:4:3:3:3:5:5:1:1:3:0"
raOccSubFrameNum="0:1:2:3:4:5:6:7:8:9" isDurExtend="TRUE" cfi="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm instId="5" status="15"/>
      </tapa.expect>


   </tapa.test>

   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.25
#
#       Desc:    Verify that Measurement GAP can be configured for a UE. 
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Measurement GAP should not affect the a allocation of
         RAR, MSG3 and MSG4."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Measurement GAP should not affect the a allocation of
         RAR, MSG3 and MSG4."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="30" />

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication so that we reach the start of measGap
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="12"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq numRapId="1" rapIds="1" timingAdvs="3"
               tpcs="1" cqiPres="TRUE" cqis="4"/>
         </tapa.tfu.rareq.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Expect RaResp for the rapId sent in RaReq
      <tapa.expset>
         <tapa.tfu.dat.req>
            <tapa.tfu.rarsp.req />
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req expCntrlReq="1" spId="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req spId="1" >
            <tapa.tfu.msg3.recp.req validate="FALSE"/>
         </tapa.tfu.recp.req>
      </tapa.expect>
   
   <tapa.send>
      <tapa.tfu.tti.ind numTti="3"/>
   </tapa.send>

   #Send CRC for Msg3
   <tapa.send>
      <tapa.tfu.crc.ind>
         <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
      </tapa.tfu.crc.ind>
   </tapa.send>

   <tapa.send>
      <tapa.tfu.tti.ind numTti="1"/>
   </tapa.send>

   # Expect HARQ ACK in PHICH For MSG3
   <tapa.expect>
      <tapa.tfu.cntrl.req spId="1">
         <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
      </tapa.tfu.cntrl.req>
   </tapa.expect>

   # Send Message3 after receiving Message3 reception req.
   <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat sduSize="20" crnti="0" ueId="1" addCrnti="TRUE"/>
       </tapa.tfu.dat.ind>      
   </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

    <tapa.expect>
          <tapa.rgr.uestaind/>
      </tapa.expect>


      # Expect DCI format 0 and do basic validations of the grant
      <tapa.expset>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.pdcch.cntrl.req ueId="0" saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request
      <tapa.expect>
     <tapa.tfu.recp.req>
        <tapa.tfu.pusch.recp.req ueId="0" use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH
      <tapa.expect>
        <tapa.tfu.cntrl.req>
           <tapa.tfu.phich.cntrl.req ueId="0" isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>
 
      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind>
          <tapa.tfu.dat ueId="0" use="2" lcId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind ueId="0" lchTb1Data="1,1" vldtBuf="TRUE"/>
      </tapa.expect>

   
     </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.26
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       and UE Delete is issued.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         and UE Delete is issued."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that Ack/Nack repetiton can be enabled for UE and MAC
         and UE Delete is issued."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send UE Delete Request for the same UE created above at CRG.
      <tapa.send>
         <tapa.crg.cfgreq.del  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      #Expect positive Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm/>
      </tapa.expect>
      
      # Send UE Delete Request for the same UE created above at RGR.
      <tapa.send>
         <tapa.rgr.cfgreq.del instId="5"  cellId="3" ueId="0" DelType="2"/>
      </tapa.send>

      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind  />
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
         <tapa.rgr.cfgCfm/>
      </tapa.expect>

      # Send TTI to Scheduler
      <tapa.send>
        <tapa.tfu.tti.ind numTti="4" />
      </tapa.send>

      <tapa.timeout/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#ccpu00106104 ADD Adaptive Retx should consider Measgap while scheduling
####################################################################
#
#
#       Test:    9.27
#
#       Desc:   Feedback(Nack) collides with measurement gap. 
#               Adpative retransmission should take place.
#                 
#       Notes:   None
#              
#       Module:  measurement gap
#
#       File:    rgac_tc9.xml
#
####################################################################
<tapa.testcase id="9.27">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "Feedback(Nack) collides with measurement gap ,Adpative retransmission should take place."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>


      # Initialize LTEMAC
      <tapa.rg.macInit/>

      <tapa.rg.dbgDeInitAll/>

      #Initialize CELL
      <tapa.rg.cellInit ulTotalBw="100"  numTxAntPorts="2" startRnti="70"
      rntiSize="11" isDlFreqSel="1" hopOffst="20"/>

      #Initialize UE
      <tapa.rg.UeInit  txModeEnum="RGR_UE_TM_3" prdBsrTmr="65535"
      isMesGapEnabled="TRUE" gapPrd="40" gapOffst="21" maxUlHqTx="4"/>
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
     
      <tapa.tfu.directive ulDeltaPrsnt="TRUE"/> 
      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.crg.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure bi-directional DTCH for default UE 
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="3" lcgId="0" dir="3" lcType="4" ulQci="8" instId="5"/>
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Expect configuration confirm after the TTI
      <tapa.expect> 
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant(2,3)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request(2,7)
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg(3,0)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH(3,1)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addShortBsr="TRUE" bsr="5"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant(3,2))
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request(3,6)
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg(3,9)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH(4,0)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addShortBsr="TRUE" bsr="5"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant(4,1)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request(4,5)
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg(4,8)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH(4,9)
      <tapa.expect>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.phich.cntrl.req isAck="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expect>

      # Send Data Indication using TB size recieved in the grant
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat use="2" lcId="3" addShortBsr="TRUE" bsr="5"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # Expect Data Indication at RLC
      <tapa.expect>
         <tapa.rgu.ddatind lchTb1Data="3,1" vldtBuf="TRUE"/>
      </tapa.expect>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant(5,0)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send 4 (UL_SCHED_DELTA (=2) + 4 TTIs (for Ue to transmit) - TFU_DELTA
      # (=2 in advance that we expect datRecpReq)
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # Expect data reception request(5,4)
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send 3 TTIs (TFU_DELTA(=2) for UE to transmit + 1 (TFU_UL_DELTA))
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>
      
      #Send CRC for Msg(5,7)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
     
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="9"/>
      </tapa.send>
     
      # Still There will not be any UL Retx to avoid non-synchrous HARQ in UL.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#ccpu00106104 ADD Adaptive Retx should consider AckNackRep while scheduling
####################################################################
#
#
#       Test:    9.28
#
#       Desc:   Feedback(Nack) collides with AckNackRep period. 
#               Adpative retransmission should take place.
#               
#       Notes:   None
#              
#       Module:  AckNackRep
#
#       File:    rgac_tc9.xml
#
####################################################################
<tapa.testcase id="9.28">


   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
      "Feedback(Nack) collides with AckNackRep period,Adpative retransmission should take place"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4" maxUlHqTx="4" 
         prdBsrTmr="65535"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
     </tapa.expect>

      # Send SR Indication for default UE
     <tapa.send>
        <tapa.tfu.sr.ind>
           <tapa.tfu.sr/>
        </tapa.tfu.sr.ind>
     </tapa.send>

      # Send a TTI to schedule SR
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect DCI format 0 and do basic validations of the grant(2,3)
      <tapa.expset>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req saveTo="1" isUlGrant="TRUE" vldtGrant="TRUE" vldtTx="TRUE"/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect data reception request(2,7)
      <tapa.expect>
     <tapa.tfu.recp.req numRntis="1">
        <tapa.tfu.pusch.recp.req use="1" vldtDatRecp="TRUE" saveTo="2"/>
     </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      #Send CRC for Msg(3,0)
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="0" isFailure="TRUE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="11"/>
      </tapa.send>

      # UL Retx can not be expected as it is went out from  synchronous HARQ
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   <tapa.rg.macDeInit/>
   </tapa.clean>
   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>
#rg003.301 ccpu00119087 MOD
#############################################
# ccpu00119087 MOD changes in retransmsission when there is a DTX
#
#
#       Test:    9.29
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#       This is for sched type=1
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.29">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="1" ulSchdType="1"/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--    
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      # ccpu00119087 MOD changes in retransmsission when there is a DTX
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg003.301 ccpu00119087 MOD
#############################################
# ccpu00119087 MOD changes in retransmsission when there is a DTX
#
#
#       Test:    9.30
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#       This is for sched type=2
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.30">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="2" ulSchdType="2"/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--    
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      # ccpu00119087 MOD changes in retransmsission when there is a DTX
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>

#rg003.301 ccpu00119087 MOD
#############################################
# ccpu00119087 MOD changes in retransmsission when there is a DTX
#
#
#       Test:    9.31
#
#       Desc:    Verify that Ack/Nack repetiton can be enabled for UE and MAC
#       shall expect the configured number of HARQ Feedback from the UE. And in
#       the case where Feedback isnt received at action is taken on the final
#       feedback in the case of a NACK retransmission is scheduled.
#       This is for sched type=3
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc8.xml
#
#############################################
<tapa.testcase id="9.31">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs (assume NACK in case
       of tie)."
      </tapa.desc>

      <tapa.longdesc>
       "Verify that Ack/Nack repetiton can be enabled for UE and MAC
       shall expect the configured number of HARQ Feedback from the UE. And in
       the case where Feedback isnt received at action is taken on the final
       feedback based on the total count of ACKs and NACKs."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit dlSchdType="3" ulSchdType="3"/>

      # UE Creation
      <tapa.rg.UeInit isAckNackEnabled="TRUE" pucchAckNackRep="1001"
         ackNackRepFactor="RGR_ACKNACK_REPFACT_N4"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Configure UL LCG on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lcg lcgId="0" instId="5"/>
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>
      
      # Send TTI indication 
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      
      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
           #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req saveTo="1"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  use="1" saveTo="2" validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0"/>
         </tapa.tfu.recp.req>   
      </tapa.expset>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1" spId="1">
            <tapa.tfu.hq.recp.req ueId="0" isRepeating="TRUE"
               n1PucchAnRep="1001"/>
         </tapa.tfu.recp.req>   
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <!--    
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      # Send a 1 TTIs to expect another one
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <!--
      <tapa.send>
         <tapa.tfu.hq.ind hqInds="1">
            <tapa.tfu.hq ueId="0" isAck="FALSE"/>
         </tapa.tfu.hq.ind>   
      </tapa.send>
      -->
      # Send 2 Ttis (one for scheduling, one for retransmission,
      # if scheduled and hence NACK is successfully handled)
      # ccpu00119087 MOD changes in retransmsission when there is a DTX
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send> 
      
      <tapa.expset>
          # Expect PDU from MAC to PHY. 
          #ccpu00119023 MOD changed added retx parameters for validation
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req validate="TRUE" use="1" saveTo="3"
               vldtRetx="TRUE" vldRvIdx="TRUE" rvIdx="0"/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
             <tapa.tfu.pdsch.dat.req validate="TRUE" use="3" isRetx="TRUE" retxUse="2" vldtRetx="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


#############################################
#
#
#       Test:    9.32
#
#       Desc:    Verify that MAC releases Meas Gap during 
#                RRC Re-establishment.
#
#       Notes:   None
#              
#       Module:  Measurement Gap
#
#       File:    rgac_tc9.xml
#
#############################################
<tapa.testcase id="9.32">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="" section=""/>
      <tapa.module id=""/>

      <tapa.desc>
         "Verify that MAC releases Meas Gap config during RRC Re-establishment."
      </tapa.desc>

      <tapa.longdesc>
         "Verify that MAC releases Meas Gap, if it is configured during 
          RRC Re-establishment."
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      # Layer Manager Configuration
      <tapa.rg.macInit/>

      # Cell Configuration
      <tapa.rg.cellInit/>

      # UE Creation
      <tapa.rg.UeInit isMesGapEnabled="TRUE" gapPrd="40" gapOffst="20"/>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      <tapa.send>
         # Configure a dedicated logical channel for the created UE  
         <tapa.crg.cfgreq.cfg.lch lcId="1" lcgId="0" dir="3" lcType="5" />
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.crg.cfgcfm/>
      </tapa.expect>

      # Configure DL LC on RGR
      <tapa.send>
         <tapa.rgr.cfgreq.cfg.lch lcId="1" dir="1" lcType="5" instId="5" />
      </tapa.send>

      # Send TTI indication for default cell
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      <tapa.expect>
         # Expect success in cfg cfm
         <tapa.rgr.cfgCfm instId="5"/>
      </tapa.expect>

      # Send TTI indication so that we are 15 subframes away from the start of
      # measurement gap. 
      # This gives enough time to get HARQ feedback for a retransmission to 
      # coincide with measurement Gap.
      <tapa.send>
         <tapa.tfu.tti.ind isMeasGap="TRUE" ueId="0" advance="5"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.dstarsp lcId="1" lcType="5" bo="64"/>
      </tapa.send>

      # Expect StaInd only after 8 TTIs-Meas Gap completes 
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="8"/>
      </tapa.send>

      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind lchTb1Data="1" />
      </tapa.expect>

      <tapa.send>
         # Send data with size less than the allocated on RGU. 
         # if we can send less data from TA or to report a BO which
         # will surely result in padding 
         <tapa.rgu.ddatreq lchTb1Data="1" ueId="0" lcId="1" lcType="5"/>
      </tapa.send>

      <tapa.send>
         # Send DL_DELTA Ttis to get the MAC PDU at PHY.
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      <tapa.expset>
         <tapa.tfu.cntrl.req numCntrlReq="1">
            <tapa.tfu.pdcch.cntrl.req/>
         </tapa.tfu.cntrl.req>
         <tapa.tfu.dat.req datReqs="1">
            <tapa.tfu.pdsch.dat.req  validate="TRUE"/>
         </tapa.tfu.dat.req>
      </tapa.expset>

      <tapa.send>
         # Send a 4 TTIs to get the harqrecpRequest from MAC
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>
      
      # Send UE Reset request With Invalid Ue Id at RGR
      <tapa.send>
         <tapa.rgr.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.rgr.cfgCfm />
      </tapa.expect>

      # Send UE Reset request With Invalid Ue Id at CRG 
      <tapa.send>
         <tapa.crg.cfgreq.UeReset  cellId="3" ueId="0" />
      </tapa.send>
      #Expect negative Configuration Confirm from LTEMAC
      <tapa.expect>
         <tapa.crg.cfgcfm />
      </tapa.expect>
     
      # Send RaReqInd for one rapId
      <tapa.send>
         <tapa.tfu.rareq.ind numRaRnti="1" suId="0">
            <tapa.tfu.rareq raRnti="8" numRapId="1" rapIds="1" timingAdvs="3"
tpcs="1" cqiPres="FALSE" />
         </tapa.tfu.rareq.ind>
      </tapa.send>

      # Assuming start of this step we are at (0,0)
      # Ue starts expecting raResp after 3 subframes within the raResp window.
      # The number of subframes to wait for receiving the RA RSP is maximum of
      # RA RSP window and the scheduling delta RG_DL_DELTA (=3) minus the
      # TFU_DELTA (=2) from the next TTI. This makes the number of TTIs 2 (3 - 2
      # + 1).
      <tapa.send>
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # At start of this step, we are at (0,1)
      # Expect RaResp for the rapId sent in RaReq. Validate the RAR Pdu
      # creation as well
      <tapa.expset>
        <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.rarsp.req raRnti="8" vldtRar="TRUE" saveTo="1"/>
        </tapa.tfu.dat.req>
        <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req/>
        </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (0,1)
      # Counting the TTIs, RA RSP was received by PHY at sf = (0,2). PHY tranmits
      # the RA RSP in sf = (0, 4). UE will transmit the MSG3 at sf = (1, 0). We
      # must receive data reception request at sf = (0, 8). Current TTI = (0, 2)
      # and hence we must send 6 TTIs.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="6"/>
      </tapa.send>

      # At start of this step, we are at (0,7)
      # Expect Message3 reception req. Validation against the grant given in
      # raResp shall be done
      <tapa.expect>
         <tapa.tfu.recp.req numRntis="1">
            <tapa.tfu.msg3.recp.req ueId="1"/>
         </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (0,7)
      # Send [TFU_DELTA(=2) + TFU_UL_DELTA(=1)] TTIs
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      #Send CRC for Msg3
      <tapa.send>
         <tapa.tfu.crc.ind>
            <tapa.tfu.crc ueId="1" isFailure="FALSE"/>
         </tapa.tfu.crc.ind>
      </tapa.send>

      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # Expect HARQ ACK in PHICH For MSG3
      <tapa.expect>
         <tapa.tfu.cntrl.req numCntrlReq="1" spId="1">
            <tapa.tfu.phich.cntrl.req ueId="1" isAck="TRUE"/>
         </tapa.tfu.cntrl.req>
      </tapa.expect>

      # At start of this step, we are at (1,0)
      # Send Message3 after receiving Message3 reception req.
      # rg004.201 Fixed the CCCH sdu size
      <tapa.send>
       <tapa.tfu.dat.ind datInds="1">
          <tapa.tfu.dat  isCcchSdu="TRUE" sduSize="6" ueId="1"/>
       </tapa.tfu.dat.ind>
      </tapa.send>

      # At start of this step, we are at (1,0)
      # Expect Message3 datInd on CCCH at RGU.
      <tapa.expect>
         <tapa.rgu.cdatind ueId="1" lcId="4"/>
      </tapa.expect>

      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>
      
      <tapa.send>
         # Send a Tti to get the transmission scheduled. 
         <tapa.tfu.tti.ind numTti="2"/>
      </tapa.send>

      # Send re-configuration disabling SPS in downlink
      <tapa.send>
         <tapa.rgr.cfgreq.recfg.ue  oldUeId="0" UeReCfgType="0" 
           oldcrnti="11" newUeId="1" newcrnti="12"/>
      </tapa.send>

      # Send a Tti to get the configuration applied.
      <tapa.send>
         <tapa.tfu.tti.ind/>
      </tapa.send>

      #Expect positive Configuration Confirm from Scheduler
      <tapa.expect>
          <tapa.rgr.cfgCfm  />
       </tapa.expect>

      <tapa.send>
         # Send BO for the created logical channel on RGU. 
         <tapa.rgu.cstarsp ueId="1" lcId="4" lcType="3" bo="100"/>
      </tapa.send>

      # At start of this step, we are at (1,1)
      # Send a Tti to get Msg4 transmission scheduled.
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Expect staInd from MAC to RLC for Msg4
      <tapa.expect>
         <tapa.rgu.cstaind lcId="4"/>
      </tapa.expect>

      # At start of this step, we are at (1,2)
      # Send Msg4 on RGU.
      <tapa.send>
         <tapa.rgu.cdatreq ueId="1" lcId="4" lcType="3" />
      </tapa.send>

      # At start of this step, we are at (1,2)
      # Send 1 TTI to get MSG4 at PHY
      <tapa.send>
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>

      # At start of this step, we are at (1,3)
      # Expect Msg4 from MAC to PHY
      <tapa.expset>
         <tapa.tfu.dat.req datReqs="1">
           <tapa.tfu.pdsch.dat.req ueId='1' validate="TRUE" chkCcchSh="TRUE"/>
         </tapa.tfu.dat.req>
         <tapa.tfu.cntrl.req numCntrlReq="1">
           <tapa.tfu.pdcch.cntrl.req ueId='1'/>
         </tapa.tfu.cntrl.req>
      </tapa.expset>

      # At start of this step, we are at (1,5)
      # Send 2 more TTI before HARQ reception request
      <tapa.send>
         <tapa.tfu.tti.ind numTti="4"/>
      </tapa.send>

      # At start of this step, we are at (1,7)
      # Expect harq ack reception request for HARQ ACK for Msg4.
      <tapa.expect>
        <tapa.tfu.recp.req numRntis="1">
           <tapa.tfu.hq.recp.req ueId='1'/>
        </tapa.tfu.recp.req>
      </tapa.expect>

      # At start of this step, we are at (1,7)
      # Send TTIs = (TFU_DELTA(=2) + TFU_UL_DELTA(=1)) before sending HARQ ACK
      # to MAC
      <tapa.send>
         <tapa.tfu.tti.ind numTti="3" />
      </tapa.send>

      # At start of this step, we are at (2,0)
      # Send ACK as feedback for Msg4.
      <tapa.send>
        <tapa.tfu.hq.ind hqInds="1">
          <tapa.tfu.hq ueId="1"/>
        </tapa.tfu.hq.ind>
      </tapa.send>

      # Sending enough TTIs to match the released Meas Gap config
      <tapa.send>
         # Send a 2 TTIs to See a Retransmission 
         <tapa.tfu.tti.ind numTti="3"/>
      </tapa.send>

      <tapa.send>
         # Send BO for the created logical channel on RGU.
         <tapa.rgu.dstarsp ueId="1" lcId="1" lcType="5" bo="100"/>
      </tapa.send>
      
      <tapa.send>
         # Send a 2 TTIs to See a Retransmission 
         <tapa.tfu.tti.ind numTti="1"/>
      </tapa.send>
      <tapa.expect>
         # Expect staInd from MAC to RLC for Msg4 
         <tapa.rgu.dstaind ueId="1" lchTb1Data="1" />
      </tapa.expect>

      <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      #Command To ShutDown LTEMAC Layer
      <tapa.rg.macDeInit/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>

   </tapa.shutdown>

</tapa.testcase>


# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend
#
#/********************************************************************30**
#
#         End of file:     rgac_tc9.xml@@/main/1 - Thu Mar 26 01:11:03 2009
#
#*********************************************************************31*/
#/**********************************************************************
(#        Revision History:
#
#**********************************************************************/
#/********************************************************************90**
# 
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#/main/1      ---     sm   1. Initial Release.
#$SID$         ---    sm   1. Initial Release.
#           rg006.201 ms   1. ccpu00111742: Sending NACK in PHICH for failed UL TX
#$SID$        ---     gvj  1. LTE MAC 3.1 Release
#$SID$      rg001.301 asehgal  1.Added the test case for the  CR ccpu00117270 
                               2. Added the changes for the CR ccpu00119023
#$SID$      rg002.301 av     1.added changes for ccpu00109543 and ccpu00117606
#$SID$      ---        rt  1. LTE MAC 4.1 Release
#*********************************************************************91*/
