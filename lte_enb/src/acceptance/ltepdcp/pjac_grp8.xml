#
#/********************************************************************20**
#
#     Name:    PDCP 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases for Uplink Data Forwarding. Group 8. 
#
#     File:    kwac_pj_grp8.xml
#
#     Sid:     $SID$
#
#     Prg:     rmurali
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=1:1:Group 8 Test Cases :kwac_pj_grp8.xml

#
#
#       Test:    8.1
#
#       Desc:    Sending 4 In-Seq UL Data Packets to PDCP received in DRB 1 from Dummy_RLC
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.1"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Sending 4 In-Seq UL Data Packets to PDCP received in DRB 1 from Dummy_RLC"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE"  count="1"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="2"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="3"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      <tapa.delay delay="10"/> 
      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.2
#
#       Desc:    Sending 2 In-Seq and 2 Out-Seq UL Data Packets to PDCP received in DRB 1 from Dummy_RLC
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.2"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Sending 2 In-Seq and 2 Out-Seq UL Data Packets to PDCP received in DRB 1 from Dummy_RLC"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 : Out-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will Deliver this Out-Of-Seq Packet, since STATE is NORMAL
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 : Out-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will Deliver this Out-Of-Seq Packet, since STATE is NORMAL
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 4th Packet - with SN = 3 : In-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will 1st deliver the Buffered Pkts and then this Pkst.
      #    Because after this Packet is received the Buffered Packets will become In-Seq
      #    So 2 Buffered Pkst (SN = 1 and 2) + this normal Pkt SN = 3 will be sent to DAM.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.3
#
#       Desc:    Buffering of 1 Out-Of-Seq UL Packetwhen STATE = PJ_STATE_REEST
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.3"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Buffering of the 1 UL Out-Of-Seq Packet when STATE = PJ_STATE_REEST"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1 - ADD Cfg
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ Do not send 2nd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 2nd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 1

      ############################ Do not send 3rd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 3rd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 2

      ############################ Do not send 4th Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 4th UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 3

      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

     #########################  Re-Estblishment #############################

     #14.Send a ReEstablishment request on SRB1
     <tapa.send>
         <tapa.cpj.reestreq  ueId="1" cellId="1"
            rbId="1"
            rbType="1"
            intkey="123456789012345678901234567890123"
            ctrlplnkey="123456789012345678901234567890123"
            usrplnkey="123456789012345678901234567890123"
         />
    </tapa.send>
  
    #15
    <tapa.expect>
         <tapa.cpj.reestcfm ueId="1" cellId="1" status="1" transId="-1"/>
    </tapa.expect>

      ## Configure Drb 1 - Re-EstablishCfg to set STATE = REEST in PDCP
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="4"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.send>
         <tapa.dummy.kwu.reestcmpind ueId="1" cellId="1" rbId="1" rbType="1" suId="1" />
      </tapa.send> 

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet since Stata is REEST.

      <tapa.delay delay="10"/> 

      <tapa.delue1 />
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.4
#
#       Desc:    Buffering of 1 Out-Of-Seq UL Packet when STATE = PJ_STATE_REEST_HO
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.4"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Buffering of the 1 UL Out-Of-Seq Packet when STATE = PJ_STATE_REEST_HO"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1 - ADD Cfg
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ Do not send 2nd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 2nd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 1

      ############################ Do not send 3rd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 3rd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 2

      ############################ Do not send 4th Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 4th UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 3

      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

      ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############

      # 1. Send SDU Status Request to PDCP.
      # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
      <tapa.send>
         <tapa.cpj.sdustareq ueId="1" cellId="1" />
      </tapa.send>

      ################################## Send Re-Establish Complete Indication ##########################

      # 1. Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
      <tapa.send>
         <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
      </tapa.send>

      ################################# SDU Status Confirm from PDCP ######################

      # 1. PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
      <tapa.expect>
         ## Check the FMS, UL Bitmap and numBits here.
         <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="0" ulBitmap1="0" transId="1" FMS = "1"
                              noDlChk="TRUE"  />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet since Stata is REEST.

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.5
#
#       Desc:    Buffering of 4 Out-Of-Seq UL Packet and then sending Re-Estblish Cmp Ind from Dummy RLC
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.5"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Buffering of the 4 UL Out-Of-Seq Packet and then sending Re-Estblish Cmp Ind from Dummy RLC"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ Do not send 2nd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 2nd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 1

      ############################ Do not send 3rd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 3rd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 2

      ############################ Do not send 4th Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 4th UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 3

      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 6th Packet - with SN = 5 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 7th Packet - with SN = 6 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 8th Packet - with SN = 7 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

      ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############

      # 1. Send SDU Status Request to PDCP.
      # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
      <tapa.send>
         <tapa.cpj.sdustareq ueId="1" cellId="1" />
      </tapa.send>


      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 6th Packet - with SN = 5 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="6" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 7th Packet - with SN = 6 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="7" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 8th Packet - with SN = 7 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="8" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ### PDCP has to forward all the Packets with SN - 4,5,6,7 to Target.
      ### FMS = 1.
      ### BITMAP = 001111. (SN = 2, 3 has to be retransmitted)

      ################################## Send Re-Establish Complete Indication ##########################

      # 1. Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
      <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
      </tapa.send>

      ################################# SDU Status Confirm from PDCP ######################

      # 1. PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
      <tapa.expect>
         ## Check the FMS, UL Bitmap and numBits here.
         <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="60" transId="1" FMS = "1"
                              noDlChk="TRUE"  />
      </tapa.expect>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.6
#
#       Desc:    Send Data Forward Request to PDCP
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.6"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ Do not send 2nd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 2nd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 1

      ############################ Do not send 3rd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 3rd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 2

      ############################ Do not send 4th Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 4th UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 3

      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 6th Packet - with SN = 5 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 7th Packet - with SN = 6 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 8th Packet - with SN = 7 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

      ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############

      # 1. Send SDU Status Request to PDCP.
      # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
      <tapa.send>
         <tapa.cpj.sdustareq ueId="1" cellId="1" />
      </tapa.send>


      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 6th Packet - with SN = 5 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="6" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 7th Packet - with SN = 6 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="7" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ############################ 8th Packet - with SN = 7 : Out-Of-Seq ##################################

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="8" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet.

      ### PDCP has to forward all the Packets with SN - 4,5,6,7 to Target.
      ### FMS = 1.
      ### BITMAP = 001111. (SN = 2, 3 has to be retransmitted)

      ################################## Send Re-Establish Complete Indication ##########################

      # 1. Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
      <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
      </tapa.send>

      ################################# SDU Status Confirm from PDCP ######################

      # 1. PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
      <tapa.expect>
         ## Check the FMS, UL Bitmap and numBits here.
         <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="60" transId="1" FMS = "1"
                              noDlChk="TRUE"  />
      </tapa.expect>

      ################################ Send Data Forward Request to PDCP ###############################

      # 1. Send Data Forward Request to UL PDCP from Dummy RRC with isUlDatFwdReq = TRUE.
      <tapa.send>
         <tapa.cpj.datforwardreq ueId="1" cellId="1" transId="1" isUlDatFwdReq="TRUE" />
      </tapa.send>

      # 2. PDCP will forward the 8 DL Buffered Packets present in datCfmQ to DAM.
      #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.
      <tapa.expset>
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
      </tapa.expset>

      # 3. PDCP will forward the 4 UL Buffered Packets present in datPktQ to DAM.
      # Pkts with SN = 4,5,6,7 and 1 LastDatInd will be sent to DAM. 
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.expset>
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
         <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.7
#
#       Desc:    Sending Forwarded Data from DAM to PDCP and PDCP has to buffer the Packets
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.7"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Sending Forwarded Data from DAM to PDCP and PDCP has to buffer the Packets"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      <tapa.delay delay="10"/> 
      <tapa.delue1/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.8
#
#       Desc:    Sending SN Status Update after forwarding the Packets to Tgt PDCP
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.8"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Sending SN Status Update after forwarding the Packets to Tgt PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      <tapa.delay delay="10"/> 
      <tapa.delue1/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.9
#
#       Desc:    UE retransmitting the Packets specified in PDCP Status Report
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.9"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 1st Packet - with SN = 1 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 2nd Packet - with SN = 2 ################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 3rd Packet - with SN = 3 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ### UE sent missing Packets 1,2,3 as requested in PDCP Status Report.
      ### FMS = 1, Bitmap = 001111. So as per Bitmap 4,5,6,7 need not be transmitted by UE.
      ### So now UE will transmit Packet with SN = 8.

      ################ 4th Packet with SN = 8 ###################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 5 (SN = 4)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 6 (SN = 5)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ###### count = 7 (SN = 6)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 8 (SN = 7)

      ########### So for a Packet with SN = 8, count will be 9 #############

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 9 (SN = 8)

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="10"/>
      </tapa.send>

      ########## Now Tgt received the Packet with SN = 8.
      ########## But Tgt has buffered Packets 4,5,6,7.
      ########## So now Tgt has to deliver 4,5,6,7,8 to SGW since the Buffered packets became in-sequence.

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    8.10
#
#       Desc:    In-Sequence insertion 1,2,4,5 buffered and 3, 6 is sent by UE.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.10"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 1st Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 1st Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 1st Packet - with SN = 3 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 1,2,3
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      ################ 2nd Packet - with SN = 4 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 3rd Packet - with SN = 5 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 4th Packet - with SN = 6 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="8"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 4,5,6
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    8.11
#
#       Desc:    In-Sequence insertion 2,3,4,5 buffered and 1 is sent.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.11"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="3" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 1st Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    8.12
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 0, bitmap = 11111000.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.12"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="4092"
            numBits="8"
            ulBitmap1="248"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 4093, 4094, 4095, 0, 1, 2.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.13
#
#       Desc:    Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 0, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
#                 entry sent by UE shud be discarded.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.13"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 0, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
         entry sent by UE shud be discarded."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 0,1,2 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4095.
      ### ii) BITMAP = 11100000. (From SN = 3 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="4095"
            numBits="8"
            ulBitmap1="224"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. Pkt with SN = 2 is duplicate since Source already forwarded it to Tgt, So this Pkt is duplicate and discarded

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 0, 1, 2, 3.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.14
#
#       Desc:    Pkts Fwded with SN - 4088, 4089, 4090, 4091, 4092, 4093, 4094, 4095. Snd SN Status with FMS = 4087, HFN = 1, bitmap = 11111111.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.14"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4088" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4089" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4090" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4091" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4092" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>
      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="8183"
            numBits="8"
            ulBitmap1="11111111"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>


      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="2"/>
      </tapa.send>

      # UE transmits Pkt with SN = 0.
      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 4088, 4089, 4090, 4091, 4092, 4093, 4094, 4095 and 0.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 
      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.15
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 1, bitmap = 11111000.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.15"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="8188"
            numBits="8"
            ulBitmap1="11111000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 4093, 4094, 4095, 0, 1, 2.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 
      <tapa.delue1/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.16
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 2, bitmap = 11111000.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.16"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="12284"
            numBits="8"
            ulBitmap1="11111000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 4093, 4094, 4095, 0, 1, 2.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.17
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 3, bitmap = 11111000.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.17"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="16380"
            numBits="8"
            ulBitmap1="11111000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 4093, 4094, 4095, 0, 1, 2.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.18
#
#       Desc:    Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 1, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
#                 entry sent by UE shud be discarded.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.18"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 1, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
         entry sent by UE shud be discarded."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 0,1,2 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4095.
      ### ii) BITMAP = 11100000. (From SN = 3 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="8191"
            numBits="8"
            ulBitmap1="11100000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. Pkt with SN = 2 is duplicate since Source already forwarded it to Tgt, So this Pkt is duplicate and discarded

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 0, 1, 2, 3.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.19
#
#       Desc:    Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 2, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
#                 entry sent by UE shud be discarded.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.19"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 2, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
         entry sent by UE shud be discarded."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 0,1,2 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4095.
      ### ii) BITMAP = 11100000. (From SN = 3 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="12287"
            numBits="8"
            ulBitmap1="11100000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. Pkt with SN = 2 is duplicate since Source already forwarded it to Tgt, So this Pkt is duplicate and discarded

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 0, 1, 2, 3.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.20
#
#       Desc:    Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 3, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
#                 entry sent by UE shud be discarded.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.20"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Pkts Fwded with SN - 0, 1, 2. Snd SN Status with FMS = 4095, HFN = 3, bitmap = 11100000. UE sends Pkt with SN - 2. So duplicate
         entry sent by UE shud be discarded."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 0,1,2 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4095.
      ### ii) BITMAP = 11100000. (From SN = 3 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="16383"
            numBits="8"
            ulBitmap1="11100000"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
      </tapa.send>

      # 4. Pkt with SN = 2 is duplicate since Source already forwarded it to Tgt, So this Pkt is duplicate and discarded

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW from 0, 1, 2, 3.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.21
#
#       Desc:    Pkts Fwded with SN - 2, 3, 6, 8. Snd SN Status with FMS = 1, HFN = 0, bitmap = 11001010. UE sends Pkt with SN - 2. 
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.21"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Pkts Fwded with SN - 2, 3, 6, 8. Snd SN Status with FMS = 1, HFN = 0, bitmap = 11001010. UE sends Pkt with SN - 2."
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 2,3,6,8 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="2" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="3" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="8" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 11001010. (From SN = 1 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 11001010.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="11001010"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 1
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 4th Packet - with SN = 3 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 5th Packet - with SN = 4 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="6"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 2,3,4.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      ############################ 6th Packet - with SN = 5 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="7"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 5
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ 7th Packet - with SN = 6 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 8th Packet - with SN = 7 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="9"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 6, 7
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      ############################ 9th Packet - with SN = 8 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 10th Packet - with SN = 9 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="11"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW. SN - 8, 9
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.22(TC_UT_PDCP_7)
#
#       Steps:    a)Send one packet from DAM to PDCP
#                b)PDCP sends packet received with SN = 0 from UE to DAM
#                c)RRC  sends SN status request to PDCP
#                d)DL COUNT value filled
#                e)No Packets sent from RLC 
#                f)RLC  sends Re-establishment complete indication to PDCP
#                g)UL COUNT value and receiveStatusofULPDCPSDUs  is calculated
#
#       Expected O/P:  Verify that PDCP sends
#                      SN status confirm message with
#                      a)UL COUNT value = 1
#                      b)receiveStatusofULPDCPSDUs with
#                        numBits = 0  and  ulBitMap= ""
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#      Pass : Once the if check for numBits removed
<tapa.testcase id="8.22"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="0"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

     
      ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
      # 5. Send SDU Status Request to PDCP.
      # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
      <tapa.send>
         <tapa.cpj.sdustareq ueId="1" cellId="1" />
      </tapa.send>
   
      ################################## Send Re-Establish Complete Indication ##########################

      # 6. Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
      <tapa.send>
         <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
      </tapa.send>

      ################################# SDU Status Confirm from PDCP ######################

      # 7. PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
      <tapa.expect>
         ## Check the FMS, UL Bitmap and numBits here.
         <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" 
                             numOfBits="0" ulBitmap1="" transId="1" FMS = "1"
                             noDlChk="TRUE"  />
      </tapa.expect>

   <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
    <tapa.pj.deinit/>
     <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.23(TC_UT_PDCP_8)
#
#       Steps:    a)Send three packets from DAM to PDCP
#                b)PDCP sends packet with SN = 0 received from UE to DAM
#                c)RRC  sends SN status request to PDCP
#                d)DL COUNT value filled
#                e)RLC sends packet with PDCP SN = 1 and isOutOfSeq = FALSE to PDCP 
#                f)RLC sends packet with PDCP SN = 2 and isOutOfSeq = FALSE to PDCP 
#                g)RLC sends Re-establishment complete indication sent to PDCP
#                h)UL COUNT value and receiveStatusofULPDCPSDUs  is calculated
#
#       Expected O/P:   Verify that PDCP sends
#                       SN status confirm message with
#                       a)UL COUNT value = 1
#                       b)receiveStatusofULPDCPSDUs with
#                         numBits = 0  and ulBitMap= ""
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.23"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="3"/>

         # 1. Sending DL Data Pkt from Dummy_DAM to PDCP. 
         #    This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" count="0"/>
     </tapa.send>

     # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
     <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6. Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" count="1"/>
     </tapa.send>

     #7. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to target enodeb
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>

     #8. Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" count="2"/>
     </tapa.send>

     #10. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to target enodeb
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>

     ################################## Send Re-Establish Complete Indication ##########################

     #11. Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #12. PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="0" ulBitmap1="" transId="1" FMS="3"
                              noDlChk="TRUE"  />
     </tapa.expect>

   <tapa.delay delay="10"/> 

   <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.24(TC_UT_PDCP_9)
#
#       Steps:    a)Send five packets from DAM to PDCP
#                b)PDCP sends packet with SN = 0 received from UE to DAM
#                c)RRC  sends SN status request to PDCP
#                d)DL COUNT value filled
#                e)RLC sends packet with PDCP SN = 1 and isOutOfSeq = FALSE to PDCP 
#                f)RLC sends packet with PDCP SN = 3 and isOutOfSeq = TRUE to PDCP
#                g)RLC sends packet with PDCP SN =  4 and isOutOfSeq = TRUE to PDCP
#                h)RLC sends Re-establishment complete indication sent to PDCP
#                i)UL COUNT value and receiveStatusofULPDCPSDUs  is calculated
#
#       Expected O/P:  Verify that PDCP sends
#                      SN status confirm message with
#                      a)UL COUNT value = 2
#                      b)receiveStatusofULPDCPSDUs with
#                        numBits = 2  and ulBitMap= "11"
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.24"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="5"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="1"/>
     </tapa.send>

     # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
     <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6.Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="2"/>
     </tapa.send>

     #7.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>

     #8.Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
     </tapa.send>
     
     #9.Send 2nd UL Data Pkt from Dummy_RLC to PDCP
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5"/>
     </tapa.send>
    
     ################################## Send Re-Establish Complete Indication ##########################
     #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #11.PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="192" 
                            transId="1" FMS="2" noDlChk="TRUE"  />
     </tapa.expect>

   <tapa.delay delay="10"/> 
   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.25(TC_UT_PDCP_10)
#
#       Steps:    a)PDCP sends packet with SN = 0 to 4093 received from UE to DAM
#                b)RRC  sends SN status request to PDCP
#                c)DL COUNT value filled
#                d)RLC sends packet with PDCP SN = 4095 and isOutOfSeq = TRUE to PDCP 
#                e)RLC sends packet with PDCP SN = 2 and isOutOfSeq = TRUE to PDCP
#                f)RLC sends packet with PDCP SN =  3 and isOutOfSeq = TRUE to PDCP
#                g)RLC sends Re-establishment complete indication sent to PDCP
#                h)UL COUNT value and Receive Status Of UL PDCP SDUs  is calculated
#
#       Expected O/P : Verify that PDCP sends
#                      SN status confirm message with
#                      a)UL COUNT value = 4094
#                      c)receiveStatusofULPDCPSDUs with
#                        numBits = 5  and ulBitMap= "10011"
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.25"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="Memory leak in acceptance"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="4096"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>

      <tapa.repeat.start repeatCount="1021"/>

     	 # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
         <tapa.send>
           <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
                                  numLch="1" lchData="0:1:0:0:0:0"  loop="TRUE"/>
         </tapa.send>

         # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
         <tapa.expect>
           <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         </tapa.expect>

     <tapa.repeat.end/>
     <tapa.repeat.start repeatCount="1021"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>

    <!-- <tapa.repeat.start repeatCount="403"/>

     	 # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
         <tapa.send>
           <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
                                  numLch="1" lchData="0:1:0:0:0:0"  loop="TRUE"/>
         </tapa.send>

         # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
         <tapa.expect>
           <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         </tapa.expect>

     <tapa.repeat.end/>-->


   <!--  <tapa.repeat.start repeatCount="1021"/>

     	 # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
         <tapa.send>
           <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
                                  numLch="1" lchData="0:1:0:0:0:0"  loop="TRUE"/>
         </tapa.send>

         # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
         <tapa.expect>
           <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         </tapa.expect>

     <tapa.repeat.end/>-->

 <!--   <tapa.repeat.start repeatCount="400"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>-->

   <!--  <tapa.repeat.start repeatCount="1000"/>

     	 # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
         <tapa.send>
           <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
                                  numLch="1" lchData="0:1:0:0:0:0"  loop="TRUE"/>
         </tapa.send>

         # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
         <tapa.expect>
           <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         </tapa.expect>

     <tapa.repeat.end/>-->


        <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.26(TC_UT_PDCP_11)
#
#       Steps:    a)PDCP receives DL packet for which it assign SN = 0 
#                b)PDCP sends packet with SN = 0 received from UE to DAM
#                c)RRC  sends SN status request to PDCP
#                d)RLC sends packet with PDCP SN = 2 and isOutOfSeq = TRUE to PDCP 
#                e)RLC sends packet with PDCP SN = 3 and isOutOfSeq = TRUE to PDCP
#                f)PDCP SN status confirmation sent to RRC
#                g)RRC sends PDCP Data Forward Request with UL forwarding proposed to PDCP
#
#       Expected O/P:  Verify that
#                      a)PDCP DL sends packets to DAM
#                      b)PDCP DL sends confirmation to PDCP UL 
#                      c)PDCP UL sends the UL packet with SN = 2 to DAM
#                      d)PDCP UL sends  the UL packet with SN = 3 to DAM
#                      e)PDCP UL sends the last packet indication to DAM
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.26"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="4"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="1"/>
     </tapa.send>

     # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
     <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6.Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3"/>
     </tapa.send>

     #8.Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
     </tapa.send>
     
     ################################## Send Re-Establish Complete Indication ##########################
     #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #11.PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="192" 
                            transId="1" FMS="1" noDlChk="TRUE"  />
     </tapa.expect>

     #12.Send PDCP data forward request
     <tapa.send>
         <tapa.cpj.datforwardreq ueId="1" cellId="1" transId="1" isUlDatFwdReq="TRUE" />
     </tapa.send>

     #13. PDCP will forward the 4 DL Buffered Packets present in datCfmQ to DAM.
     #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.
     <tapa.expset>
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
     </tapa.expset>

     #14. PDCP will forward the 2 UL Buffered Packets present in datCfmQ to DAM.
     #    and one lat Packet indication to DAM
     #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.

   <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.27(TC_UT_PDCP_12)
#
#       Steps:    a)PDCP receives DL packet for which it assign SN = 0 
#                b)PDCP sends packet with SN = 0 received from UE to DAM
#                c)RRC  sends SN status request to PDCP
#                d)RLC sends packet with PDCP SN = 2 and isOutOfSeq = TRUE to PDCP 
#                e)RLC sends packet with PDCP SN = 3 and isOutOfSeq = TRUE to PDCP
#                f)PDCP SN status confirmation sent to RRC
#                g)RRC sends PDCP Data Forward Request without UL forwarding proposed to PDCP
#
#       Expected O/P: Verify that
#                     a)PDCP DL sends DL packets to DAM
#                     b)PDCP DL sends last packet indication to DAM
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.27"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="4"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="1"/>
     </tapa.send>

     # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
     <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6.Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3"/>
     </tapa.send>

     #8.Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4"/>
     </tapa.send>
     
     ################################## Send Re-Establish Complete Indication ##########################
     #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #11.PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="192" 
                            transId="1" FMS="1" noDlChk="TRUE"  />
     </tapa.expect>

     #12.Send PDCP data forward request
     <tapa.send>
         <tapa.cpj.datforwardreq ueId="1" cellId="1" transId="1" isUlDatFwdReq="FALSE" />
     </tapa.send>

     #13. PDCP will forward the 4 DL Buffered Packets present in datCfmQ to DAM.
     #    and one last Packet indication to DAM
     #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.
     <tapa.expset>
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
     </tapa.expset>

   <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.28(TC_UT_PDCP_13)
#
#       Steps:    a)RRC  send SN status request to PDCP
#                b)PDCP sends SN status confirmation to RRC
#                c)PDCP receives Re-estab request
#                d)UE does a successful re-attach
#
#       Expected O/P:  Verify that PDCP includes the FMS 
#                      and bitmap sent to UE in PDCP status report
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.28"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="Memory leak in acceptance"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      #Configure the SRB1 at RLC and PDCP Layer
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="0"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="5"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
         />
      </tapa.send>
      #Expect a config confirm for all of the above configured entities
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="0"
            status="1"
            reason="0"
            inst="1"
         />
      </tapa.expect>

      #Configure the SRB2 at RLC and PDCP Layer
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="2"
            cfgType="1"
            rbType="0"
            discReqd="1"
            cfmReqd="1"
            discardTmr="100"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="5"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
         />
      </tapa.send>
      #Expect a config confirm for all of the above configured entities
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="2"
            status="1"
            reason="0"
            inst="1"
         />
      </tapa.expect>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="3"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
     <tapa.repeat.start repeatCount="4"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="0"/>
     </tapa.send>

     # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
    <!-- <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6.Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" count="2"/>
     </tapa.send>

     #8.Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" count="3"/>
     </tapa.send>
     
     ################################## Send Re-Establish Complete Indication ##########################
     #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.ReEstCmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #11.PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="11000000" 
                            transId="3" FMS="1" noDlChk="TRUE"  />
     </tapa.expect>-->
    <tapa.delay delay="10"/> 

     #12. Send UeID change request from RRc
    <tapa.send>
        <tapa.cpj.ueidchgreq transId="1" ueId="1" cellId="1" newUeId="2"
                              newCellId="1"/>
     </tapa.send>

     #13.Expect a confirm for the change request
     <tapa.expect>
        <tapa.cpj.ueidchgcfm status="1" transId="-1"/>
    </tapa.expect>

     #14.Send a ReEstablishment request on SRB1
     <tapa.send>
         <tapa.cpj.reestreq  ueId="2" cellId="1"
            rbId="1"
            rbType="0"
            intkey="123456789012345678901234567890123"
            ctrlplnkey="123456789012345678901234567890123"
            usrplnkey="123456789012345678901234567890123"
         />
    </tapa.send>
  
    #15
    <tapa.expect>
         <tapa.cpj.reestcfm ueId="2" cellId="1" status="1" transId="-1"/>
    </tapa.expect>

   
    #16 Configuring SRB2 and DRB1
    <tapa.send>
         <tapa.cpj.cfgreq  ueId="2" cellId="1" numEnt="2"
            rbId          = "2:1"
            rbType        = "0:1"
            cfgType       = "4:4"
            discReqd      = "1:1"
            cfmReqd       = "0:0"
            discardTmr    = "0:0"
            dir           = "3:3"
            mode          = "3:3"
            statusRepReqd = "0:0"
         />
    </tapa.send>
 
    <tapa.expset>
      <tapa.cpj.cfgcfm ueId="2" numEnt="1" cellId="1"
            rbId   = "2:1"
            rbType = "0:1"
            status = "1:1"
            reason = "0:0"
            />
   </tapa.expset>


         #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="2" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

   <!-- <tapa.expect>
	<tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"/>

    </tapa.expect>-->

  
     
   <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.29(TC_UT_PDCP_15)
#
#       Steps:     a)RRC sends PDCP SN status request to PDCP 
#                 b)PDCP sends SN status confirm to RRC
#                 c)RRC sends PDCP Data forward request
#                 d)PDCP DL sends an confirmation to PDCP UL 
#                   to start forwarding UL data
#       Expected O/P:  Verify successful packing and unpacking of Confirmation message
#                      DatFwdCfm sent by PDCP DL to PDCP UL
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp8.xml
#
#
<tapa.testcase id="8.29"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Send Data Forward Request to PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef>
         <tapa.flag id="Memory leak in acceptance"/>
      </tapa.ifdef>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      <tapa.repeat.start repeatCount="4"/>

         # 1.Sending DL Data Pkt from Dummy_DAM to PDCP. 
         # This is to make the PDCP fill the PDU and send it to XTA.
         <tapa.send>
           <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
         </tapa.send>

         # 2.Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
         <tapa.expect>
           <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
         </tapa.expect>

     <tapa.repeat.end/>
      
     # 3.Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="0"/>
     </tapa.send>

     # 4.PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
     <tapa.expect>
        <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
     </tapa.expect>
    
     ################################## Send SDU SN Status Request to PDCP from Dummy RRC ##############
     # 5. Send SDU Status Request to PDCP.
     # Here - rbCb and ueCb STATE is set to PJ_REEST_HO. 
     <tapa.send>
        <tapa.cpj.sdustareq ueId="1" cellId="1" />
     </tapa.send>
   
     #6.Send 1st UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="2"/>
     </tapa.send>

     #8.Send 2nd UL Data Pkt from Dummy_RLC to PDCP 
     <tapa.send>
        <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="3"/>
     </tapa.send>
     
     ################################## Send Re-Establish Complete Indication ##########################
     #10.Re-Estblish Cmp Ind is sent from Dummy RLC to PDCP.
     <tapa.send>
        <tapa.dummy.kwu.reestcmpind suId="0" ueId="1" cellId="1" rbId="1" rbType="1" />
     </tapa.send>

     ################################# SDU Status Confirm from PDCP ######################

     #11.PDCP will send SDU Status Cfm to RRC only after RLC sends Re-Estb Comp Indication to PDCP.
     <tapa.expect>
       ## Check the FMS, UL Bitmap and numBits here.
        <tapa.cpj.sdustacfm ueId="1" cellId="1" numRb="1" rbId="1" dir="3" numOfBits="8" ulBitmap1="192" 
                            transId="1" FMS="1" noDlChk="TRUE"  />
     </tapa.expect>

     #12.Send PDCP data forward request
    <tapa.send>
         <tapa.cpj.datforwardreq ueId="1" cellId="1" transId="1" isUlDatFwdReq="TRUE" />
     </tapa.send>

     #13. PDCP will forward the 4 DL Buffered Packets present in datCfmQ to DAM.
     #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.
     <tapa.expset>
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="1" />
     </tapa.expset>

     #14. PDCP will forward the 2 UL Buffered Packets present in datCfmQ to DAM.
     #    and one lat Packet indication to DAM
     #### module = 1 is for DL PDCP Module. Src Inst for DL PDCP = 0.
     <tapa.expset>
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
        <tapa.pju.datfwdind rbId="1" rbType="1" ueId="1" cellId="1" module="0" />
     </tapa.expset>

   <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    8.30(TC_UT_PDCP_26)
#
#       Steps:   a)UL Packets received on the UL forwarding tunnel buffered inPDCP
#                b)SN status is received by PDCP with
#                  UL COUNT value
#                  PDCP-SN = 2
#                  PDCP-HFN=0
#                  receivestatusofulPDCPSDUs : bitmap = "101"
#                c)UE did successful Handover to Target eNodeB
#                d)FMS and Bitmap is sent to UE in PDCP Status report
#                e)UE did re-transmission of lost packets i.e for SN = 2 ,4 
#       Expected O/P: Verify that PDCP 
#                     a)Sends UL packets to DAM for SN = 2,3,4,5 
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp8.xml
#
#
<tapa.testcase id="8.30"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
   
      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="12"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 1st Packet - with SN = 1 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="2"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 2nd Packet - with SN = 2 ################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="3"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 3rd Packet - with SN = 3 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="4"/>
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ### UE sent missing Packets 1,2,3 as requested in PDCP Status Report.
      ### FMS = 1, Bitmap = 001111. So as per Bitmap 4,5,6,7 need not be transmitted by UE.
      ### So now UE will transmit Packet with SN = 8.

      ################ 4th Packet with SN = 8 ###################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 5 (SN = 4)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 6 (SN = 5)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ###### count = 7 (SN = 6)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 8 (SN = 7)

      ########### So for a Packet with SN = 8, count will be 9 #############

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 9 (SN = 8)

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" outOfSeqFlag="TRUE" count="9"/>
      </tapa.send>

      ########## Now Tgt received the Packet with SN = 8.
      ########## But Tgt has buffered Packets 4,5,6,7.
      ########## So now Tgt has to deliver 4,5,6,7,8 to SGW since the Buffered packets became in-sequence.

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

   <tapa.delue1/>  
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    8.31
#
#       Desc:    Configure PDCP SN as 15 bit in target ENB during Handover 
#
#       Notes:   
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.31"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Sending 15bit SN Status Update after forwarding the Packets to Tgt PDCP"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap1="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      <tapa.delay delay="10"/> 
      <tapa.delue1/>

   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.32
#
#       Desc:    UE retransmitting the Packets specified in PDCP Status Report for 15bit SN
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.32"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report for 15bit SN"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="5" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="6" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="7" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 1.
      ### ii) BITMAP = 001111. (SN = 2, 3 has to be retransmitted)
      ### Pkts with SN = 4,5,6,7 are already forwarded and are buffered in Tgt side.

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 1 (FMS = 1), numBits = 8, ulBitMap = 00111100.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            dlCount="0"
            ulCount="1"
            numBits="8"
            ulBitmap="60"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ################ 1st Packet - with SN = 1 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="3" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 2nd Packet - with SN = 2 ################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ################ 3rd Packet - with SN = 3 #################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="5" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ### UE sent missing Packets 1,2,3 as requested in PDCP Status Report.
      ### FMS = 1, Bitmap = 001111. So as per Bitmap 4,5,6,7 need not be transmitted by UE.
      ### So now UE will transmit Packet with SN = 8.

      ################ 4th Packet with SN = 8 ###################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 5 (SN = 4)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ####### count = 6 (SN = 5)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ###### count = 7 (SN = 6)

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 8 (SN = 7)

      ########### So for a Packet with SN = 8, count will be 9 #############

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect> ##### count = 9 (SN = 8)

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="10"/>
      </tapa.send>

      ########## Now Tgt received the Packet with SN = 8.
      ########## But Tgt has buffered Packets 4,5,6,7.
      ########## So now Tgt has to deliver 4,5,6,7,8 to SGW since the Buffered packets became in-sequence.

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expset>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expset>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>



#
#
#       Test:    8.33
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 0, bitmap = 11111000 for DRB AM-15bit SN.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.33"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report for 15bit SN"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="4092"
            numBits="8"
            ulBitmap1="248"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" transId="4" />
      </tapa.send>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    8.34
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 0, bitmap = 11111000 for 15bit SN.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.34"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report for 15bit SN"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 32764 (FMS = 32764), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="32764"
            numBits="8"
            ulBitmap1="248"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#       Test:    8.35
#
#       Desc:    Buffering of 1 Out-Of-Seq UL Packetwhen STATE = PJ_STATE_REEST for 15bit SN
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.35"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "Buffering of the 1 UL Out-Of-Seq Packet when STATE = PJ_STATE_REEST for 15bit SN"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1 - ADD Cfg
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ############################ 1st Packet - with SN = 0 : In-Seq ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 1st UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP is delivering the UL Data PDU to Dummy_DAM for delivery to SGW.
      <tapa.expect>
         <tapa.pju.datind ueId="1" cellId="1" rbId="1" sduId="1" noCirQ="TRUE" />
      </tapa.expect>

      ############################ Do not send 2nd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 2nd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 1

      ############################ Do not send 3rd Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 3rd UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 2

      ############################ Do not send 4th Packet to UL PDCP ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Don't send 4th UL Data Pkt from Dummy_RLC to UL PDCP.
      # count - 3

      ############################ 5th Packet - with SN = 4 : Out-Of-Seq ##################################

      # 1. Send 2nd DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="TRUE" />
      </tapa.expect>

     #########################  Re-Estblishment #############################

     #14.Send a ReEstablishment request on SRB1
     <tapa.send>
         <tapa.cpj.reestreq  ueId="1" cellId="1"
            rbId="1"
            rbType="1"
            intkey="123456789012345678901234567890123"
            ctrlplnkey="123456789012345678901234567890123"
            usrplnkey="123456789012345678901234567890123"
         />
    </tapa.send>
  
    #15
    <tapa.expect>
         <tapa.cpj.reestcfm ueId="1" cellId="1" status="1" transId="-1"/>
    </tapa.expect>

      ## Configure Drb 1 - Re-EstablishCfg to set STATE = REEST in PDCP
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="4"
            rbType="1"
            discReqd="1"
            cfmReqd="1"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.send>
         <tapa.dummy.kwu.reestcmpind ueId="1" cellId="1" rbId="1" rbType="1" suId="1" />
      </tapa.send> 

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="TRUE"
            numLch="1" lchData="0:1:0:0:0:0" />
      </tapa.send>

      # 4. PDCP will Buffer this Packet since Stata is REEST.

      <tapa.delay delay="10"/> 

      <tapa.delue1 />
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    8.36
#
#       Desc:    Pkts Fwded with SN - 4093, 4094, 4095, 0, 1. Snd SN Status with FMS = 4092, HFN = 0, bitmap = 11111000 for DRB AM-15bit SN.
#
#       Notes:   Configure the Discard Timer value bigrs. 
#              
#       Module:  UL Data Forwarding 
#
#       File:    kwac_pj_grp4.xml
#
#
<tapa.testcase id="8.36"> 

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.323 v:8.5.0" section="None"/>
      <tapa.module id="dlul"/>

      <tapa.desc>
         "UE retransmitting the Packets specified in PDCP Status Report for 15bit SN"
      </tapa.desc>

      <tapa.longdesc>
      </tapa.longdesc>

   </tapa.doc>

   # Require features and flags subsection 
   <tapa.require>

      <tapa.ifdef/>

      <tapa.ifndef/>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.pj.directive successTc="TRUE"/>

      #Initialize PDCP layer
      <tapa.pj.init/>

      <tapa.delay delay="2"/>

      ## Configure Drb 1
      ## Set "isHo" to TRUE, since in Tgt side the PDCP state should be PJ_STATE_HO.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="1"
            rbType="1"
            discReqd="1"
            cfmReqd="0"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="0"
            isHo="1"
            dlCount="0"
            ulCount="0"
            numBits="0"
            ulBitMap="0"
            />
      </tapa.send>

      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>

      ## Now in tgt PDCP state is set to PJ_STATE_HO. SO any forward packets coming will be buffered in the Tgt.

      #################### Send Frowarded Data Pkts with SN = 4,5,6,7 from Dummy DAM to PDCP ##################
      ### dir = 1 for UL.
      #### module = 0 is for UL PDCP Module. Src Inst for UL PDCP = 1.
      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4093" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4094" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="4095" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="0" module="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.pju.datfwdreq rbId="1" ueId="1" cellId="1" rbType="1" dir="1" numSdus="1" sn="1" module="0"/>
      </tapa.send>

      ### All the above 4 Forward Packets will be buffered in Tgt PDCP, since STATE = PJ_STATE_HO.

      ### Send SN Status Update to PDCP to change the STATE from PJ_STATE_HO to PJ_STATE_NORMAL with these Info -
      ### i) FMS = 4092.
      ### ii) BITMAP = 11111000. (From SN = 2 has to be retransmitted)

      ############### Send Cfg Modify to PDCP with new ulCount and Bitmap ############################
      ## cfgType = 2 for modify, isHoPres = 1, ulCount = 4092 (FMS = 4092), numBits = 8, ulBitMap = 11111000.
      <tapa.send>
         <tapa.cpj.cfgreq ueId="1" cellId="1" numEnt="1"
            rbId="1"
            cfgType="2"
            rbType="1"
            discReqd="1"
            cfmReqd="0"
            discardTmr="1000"
            dir="3"
            mode="3"
            statusRepReqd="0"
            pdcpSNSize="15"
            hdrCompUsed="0"
            maxCid="0"
            profile="0"
            bitFlag="0"
            isHoPres="1"
            isHo="1"
            dlCount="0"
            ulCount="4092"
            numBits="8"
            ulBitmap1="248"
            />
      </tapa.send>

      ### After PDCP SN is updated, the PDCP will send PDCP Status Report to UE with FMS and Bitmap

      ###################### PDCP Status Report from PDCP to Dummy RLC #####################
      <tapa.expect>
         <tapa.dummy.kwu.datreq />
      </tapa.expect>      

      ############# Cfg Modify Cfm
      <tapa.expect>
         <tapa.cpj.cfgcfm ueId="1" cellId="1" numEnt="1"
            rbId="1"
            rbType="1"
            status="1"
            reason="0"
            inst="1"
            />
      </tapa.expect>

      ################ UE retransmitting Packets with SN = 1(FMS), 2, 3 ###########################      

      ############################ 1st Packet - with SN = 0 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 2nd Packet - with SN = 1 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      ############################ 3rd Packet - with SN = 2 ##################################

      # 1. Send 1st DL Data Pkt from Dummy_DAM to PDCP. This is to make the PDCP fill the PDU and send it to XTA.
      <tapa.send>
         <tapa.pju.datreq rbId="1" rbType="1" ueId="1" cellId="1" />
      </tapa.send>

      # 2. Retrieve the PDU sent by PDCP and store it in global kwuAcCb struct.
      <tapa.expect>
         <tapa.dummy.kwu.datreq cellId="1" ueId="1" rbId="1" rbType="1" isOutOfSeq="FALSE" />
      </tapa.expect>

      # 3. Send 2nd UL Data Pkt from Dummy_RLC to PDCP with the PDU that was retrieved in the prev step.
      <tapa.send>
         <tapa.dummy.kwu.datind ueId="1" cellId="1" rbId="1" rbType="1" isOutOfSeq="FALSE"
            numLch="1" lchData="0:1:0:0:0:0" pdcpSNSize="15" statusPdu="1" />
      </tapa.send>

      <tapa.delay delay="10"/> 

      <tapa.delue1/>
   </tapa.test>

   # Clean subsection
   <tapa.clean/>

   # Shutdown subsectitn
   <tapa.shutdown>
      <tapa.pj.deinit/>
      <tapa.delay delay="10"/> 
   </tapa.shutdown>

</tapa.testcase>

