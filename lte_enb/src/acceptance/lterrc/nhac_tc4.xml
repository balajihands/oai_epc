#*********************************************************************17*/
#/********************************************************************20**
#
#     Name:    LTE RRC 
#
#     Type:    XML Test File
#
#     Desc:    XML Based Test Cases
#
#     File:    nhac_tc4.xml
#
#     Sid:     
#
#     Prg:    rer 
#
#*********************************************************************21*/

# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcstart=4:rcs:nhac_tc4.xml

#
#
#       Test:    4.1
#
#       Desc:    Successful RRC Connection Establishment Procedure.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.1">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " RRC connection establishment procedure. It involves"
           "RRC connection request coming from UE, RRC connection"
           "setup coming from RRC user and RRC connection setup"
           "complete message coming from UE. All the RRC messages"
           "will have all the mandatory parameters on it."

           "First, we will send a RRC Connection Request from RLC" 
           "stub to RRC."  

           "On receiving RRC Connection Request from RLC, RRC" 
           "decodes and validates this message and then passes"
           "it to RRC user. RRC user sends RRC Connection Setup "
           "along with the configuration information to RRC. In"
           "this test case, we assume that RRC user sends explicit"
           "configuration details."

           "On getting the message from RRC user, RRC reads the "
           "configuration information present in the primitive and"
           "initiates the configuration of RLC, PDCP and MAC layers"
           "by sending configuration request to RLC, PDCP and MAC."

           "RLC, PDCP and MAC layers sends positive reply by sending"
           "configuration confirm to RRC. On getting all the "
           "configuration confirm from RLC, PDCP and MAC layers, RRC"
           "sends configuration confirm to RRC user."

           "RRC encodes the received RRC Connection Setup  and sends"
           "it to RLC. This means RRC Connection Setup message is sent"
           "to UE."

           "UE applies the configuration at its end and sends RRC"
           "Connection Setup Complete to eNB."

           "On getting RRC Connection Setup Complete from PDCP, RRC "
           "decodes the message and if decode is successful, RRC "
           "forwards RRC Connection Setup Complete to RRC user." 

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        #<tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
        #                 suId="0" ueId="2" cellId="1" pdcpRel="11"/>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.2
#
#       Desc:    RRC Connection Request rejected by RRC user
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.2">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On receiving RRC Connection Request from the RLC, RRC decodes the"
          " message and forwards it to RRC user. RRC user rejects the request"
          " by sending RRC Connection Reject message to RRC. RRC encodes this"
          " message and sends it to RLC. No RLC, PDCP or MAC configuration "
          "takes place. RLC sends a new RRC Connection Request for the same "
          "UE and it is successful. The message flow is same as testcase 4.1."
 
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" cellId="1" 
                          tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Reject from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0"
          msgCategory="3" msgType="2" 
          transId="10" rbId="1" tCrnti="2" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Reject at RLC
     <tapa.expect>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" 
                         />
     </tapa.expect>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.3
#
#       Desc:    RRC connection failure due to RLC configuration not
#                successful
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.3">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "On getting configuration request from RRC, RLC configures "
         "its resources. But if this configuration fails, RLC informs"
         " RRC in configuration confirm. Once RRC receives a negative"
         " configuration confirm from RLC, RRC sends a configuration "
         "confirm to RRC user indicating that the RLC configuration has"
         " failed and reverts the configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" numFailedRb="1" failedRbIdStr="1" ueId="2"/>
     </tapa.send>

      #Expect revert configuration request at MAC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.4
#
#       Desc:    RRC connection failure due to MAC configuration not
#                successful
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.4">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "On getting configuration request from RRC, MAC configures "
         "its resources. But if this configuration fails, MAC informs"
         " RRC in configuration confirm. Once RRC receives a negative"
         " configuration confirm from MAC , RRC sends a configuration "
         "confirm to RRC user indicating that the MAC configuration has"
         " failed and reverts the configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" status="15" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" status="15" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

      #Expect revert configuration request at RLC and PDCP
      <tapa.expset>
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.5
#
#       Desc:    RRC connection failure and reverting back RLC and
#                PDCP configuration due to MAC configuration timeout
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.5">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On getting RRC Connection Request from RRC user, RRC sends "
          "configuration request to RLC, PDCP and MAC. MAC does not send "
          "configuration confirm to RRC. As a result, timer expires at "
          "RRC and RRC sends a configuration confirm to RRC user, "
          "indicating that the MAC configuration has timed out. In this "
          "case, RRC reverts MAC, RLC and PDCP configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #timer value set to 10
      #Gen Cfg to set timer value
      <tapa.send >
         <tapa.lnh.cfg.gen tmrVal="100" />
      </tapa.send>

      # Expect General Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0" />
         <tapa.dummy.crg.cfgreq  store_tid="1"  storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #MAC timed out
     <tapa.delay delay="15" />

     #Expect revert configuration request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.6
#
#       Desc:    RRC connection failure and reverting back PDCP and
#                MAC configuration due to RLC configuration timeout
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.6">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On getting RRC Connection Request from RRC user, RRC sends "
          "configuration request to RLC, PDCP and MAC. RLC does not send "
          "configuration confirm to RRC. As a result, timer expires at "
          "RRC and RRC sends a configuration confirm to RRC user, "
          "indicating that the RLC configuration has timed out. In this "
          "case, RRC reverts MAC and PDCP configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #timer value set to 10
      #Gen Cfg to set timer value
      <tapa.send >
         <tapa.lnh.cfg.gen tmrVal="100" />
      </tapa.send>

      # Expect General Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #RLC timed out
     <tapa.delay delay="15" />

     #Expect revert configuration request at RLC, MAC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.7
#
#       Desc:    RRC Connection Setup timeout with 
#                Cancel UE Request Primitive
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.7">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "RRC sends RRC Connection Setup message to RLC. UE fails to receive
          the message. In this case, RRC Connection Setup Complete timer
          expires at RRC user. RRC user sends cancel UE request to RRC. RRC
          triggers release of RLC, PDCP and MAC layer resources. The resources
          are released at RLC, PDCP and MAC layer. RRC forwards confirm to RRC
          user. UE again sends RRC Connection Request and the testcase flow is
          same as testcase 4.1."

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send cancel UE request from RRC user
     <tapa.send>
        <tapa.nhu.cncluereq cellId="1" ueId="2" />
     </tapa.send>

      <tapa.delay delay="5" />

      #Expect revert configuration request at RLC, MAC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2"/>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.8
#
#       Desc:    RRC sends the duplicate RRC Connection Setup 
#                with different Temporary CRNTI without RB configuration
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.8">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "locate UE context, it sends old CRNTI to RRC. RRC sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="8"
          msgCategory="3" msgType="3" rrc_transId="1" transId="10"
          rbId="1" tCrnti="6" cellId="1" 
          pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="6" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="6" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />
     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="6" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="6"/>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
     <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.9
#
#       Desc:    RRC Connection Request successful with default
#                configurations for RLC, transport channel 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.9">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "On receiving RRC Connection Setup from UE with the default"
         "configurations for RLC and transport channel. RRC does not "
         " give any decode failure and testcase proceeds as testcase 4.1."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>
 
   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" 
          trChCfgDed="1" rlcCfgDed="1" logCfgDed="1" ulrlcCfgType="4"
          dlrlcCfgType="4" ulLcCfgType="4" trChCfgType="4"  pdcpCfgType="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.10
#
#       Desc:    RLC, PDCP and MAC configuration are independent of 
#                each other during RRC connection establishment phase
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.10">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On getting RRC Connection Request from RRC user, RRC sends "
          "configuration request to MAC, RLC and PDCP. PDCP, RLC and MAC"
          "sends configuration confirm in this order to RRC. RRC sends the"
          " configuration confirm to RRC user once it receives configuration"
          " confirms from all the layers."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.11
#
#       Desc:    RRC sends the duplicate RRC Connection Setup 
#                with different Temporary CRNTI and RB configuration
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.11">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "locate UE context, it sends old CRNTI to RRC. RRC sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1,0" modLcIdStr="1"
          pdcpId="1" ueId="2"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="6" tCrntiPres="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="6" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1" valTCrnti="6" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1" valTCrnti="6" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

      #<tapa.expect >
       # <tapa.dummy.ckw.cfgreq  use="1"/>
      #</tapa.expect>

     #<tapa.send>
      #   <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="6" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="6" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />
     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="6" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="6" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.12
#
#       Desc:    RRC sends Error Indication when it receives invalid Data
#                Response SDU
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.12">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "RRC sends Error Indication when it receives the Data Response with
          one of the following errors: invalid cell ID, invalid RB ID, invalid
          UE ID in the header, Temprory CRNTI with zero value, UE ID
          configuration and Temprory CRNTI mismatch." 
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      #Send Cell ID with zero value with RRC Connection Setup
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="4" cellId="0" 
          addRbIdStr="1,0" pdcpId="1" ueId="4" valChk="0"/>
      </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="9" errorCause="29" />
      </tapa.expect>

      #Send invalid Cell ID with RRC Connection Setup
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="4" cellId="4" 
          addRbIdStr="1,0" pdcpId="1" ueId="4" valChk="0"/>
      </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="9" errorCause="2" />
      </tapa.expect>

      #Send RRC Connection Setup with no Temproray CRNTI from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="0" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="11" errorCause="31" />
      </tapa.expect>

      #Send RRC Connection Setup with configuration with no 
      #UE ID configuration from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="3"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="11" errorCause="31" />
      </tapa.expect>

      #Send RRC Connection Setup with configuration with zero val 
      #UE ID in UE ID configuration from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" fillUeIdCfg="0" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="11" errorCause="32" />
      </tapa.expect>

     #Send RRC Connection Setup with configuration with zero val 
     #UE ID in UE ID configuration for connected mode UE from RRC user

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

      #Send RRC Connection Setup with configuration with zero val 
      #UE ID in UE ID configuration from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="4" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" fillUeIdCfg="0" 
          ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="11" errorCause="32" />
      </tapa.expect>

      #RRC Connection Release procedure
      <tapa.rrc.conrls ueId="2" cellId="1" />

      #Send invalid UE ID in the header for connected mode UE

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

      #Send RRC Connection Setup with configuration with invalid
      #UE ID in the header from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="4" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" ueId="4" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="9" errorCause="7" />
      </tapa.expect>

      #RRC Connection Release procedure
      <tapa.rrc.conrls ueId="2" cellId="1" />

      #Send invalid RB ID with RRC Connection Setup
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="11" tCrnti="4" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="6" errorCause="1" />
      </tapa.expect>

      <tapa.delay delay="5" />

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.13
#
#       Desc:    RRC transaction identifier not present in the RRC
#                connection setup message received from RRC user
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.13">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC transaction identifier is not present in the RRC Connection "
         "Setup message received from RRC user.In this case, RRC gives "
         "encode failure and sends error indication to RRC user."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" 
          rrcTransIdPres="0" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="7" errorCause="0" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.14
#
#       Desc:    RRC Connection Setup Complete message received 
#                with all the optional IEs
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.14">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC Connection Setup Complete message received with all the "
         "optional IEs. In this case, RRC should not give any decode "
         "failure. This message is forwarded to RRC user."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>
		     
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" optional="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.15
#
#       Desc:    RRC Connection Setup message received exceeds 
#                maximum connections configured at eNB
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.15">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "When RRC receives RRC Connection Setup message, the number of "
         "UE connections exceeds the maximum configured value. RRC sends"
         "error indication to RRC user as RRC does not create UE context."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      # Send Protocol Config Request with Max Connection to 1 from LM to RRC
      <tapa.send>
         <tapa.lnh.cfg.prot maxConn = "1"/>
      </tapa.send>

      # Expect Protocol Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

   </tapa.cfg>

   <tapa.test>

      #Send new RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication
      <tapa.expect>
         <tapa.nhu.errind errorType="17" errorCause="0" />
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.16
#
#       Desc:    RRC Connection Setup message contains srb 
#                identity in SRB-AddModifyList to create SRB1
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.16">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC Connection Setup message contains srb identity in "
         "SRB-AddModifyList to create SRB1. If srb identity is not "
         "present, RRC gives encode failure to RRC user."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
         <tapa.flag id="NH_ASN_COND_VALIDATE"/>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" cellId="1" 
                          tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      #Zero radio bearer is set,so SRB1 is not added
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="0" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          pdcpId="1" srbPresent="0" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect Error Indication
      <tapa.expect>
         <tapa.nhu.errind errorType="15" errorCause="11" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.17
#
#       Desc:    RRC connection failure due to PDCP configuration 
#                not successful
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.17">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "On getting configuration request from RRC, PDCP configures "
         "its resources. But if this configuration fails, PDCP informs"
         " RRC in configuration confirm. Once RRC receives a negative"
         " configuration confirm from PDCP, RRC sends a configuration "
         "confirm to RRC user indicating that the PDCP configuration has"
         " failed, after reverting the configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" failedRbIdStr="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

      #Expect revert configuration request at MAC and RLC
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.18
#
#       Desc:    RRC connection failure and reverting back RLC and 
#                MAC configuration due to PDCP configuration timeout
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.18">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On getting RRC Connection Request from RRC user, RRC sends "
          "configuration request to RLC, PDCP and MAC. PDCP does not send "
          "configuration confirm to RRC. As a result, timer expires at "
          "RRC and RRC sends a configuration confirm to RRC user, "
          "indicating that the PDCP configuration has timed out. In this "
          "case, RRC reverts RLC and MAC configuration."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #timer value set to 10
      #Gen Cfg to set timer value
      <tapa.send >
         <tapa.lnh.cfg.gen tmrVal="100" />
      </tapa.send>

      # Expect General Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #PDCP timed out
     <tapa.delay delay="15" />

     #Expect revert configuration request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
         <tapa.nhu.cfgcfm/>
      </tapa.expset>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>


#
#
#       Test:    4.19
#
#       Desc:    RRC Connection Setup followed by configuration request.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.19">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends RRC Connection Setup to RRC, RRC encodes and sends"
         "it to lower layers without creating UE and transaction context."
         "RRC receives configuration request from RRC user and sends "
         "configuration request to PDCP, MAC and RLC layers. RRC receives" 
         "configuration confirm from all the layers and it sends the confirm"
         "to RRC user. RRC receives RRC Connection Setup Complete from PDCP "
         "and forwards it to RRC user."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="1" pdcpId="1"
                          tCrnti="2" transId="10" expCfgBitMask="11" 
                          rbCfgType="1" numAddRb="1" addRbIdStr="1,0" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.cfgreq  use="1" />
         <tapa.dummy.cpj.cfgreq  use="1" />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm ueId="2" cellId="1" />
     </tapa.expect>


      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" rbId="1" ueId="2"
          msgCategory="3" msgType="3" cellId="1" tCrnti="2"
          rrc_transId="1" transId="10" valChk="0"/>
      </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup at RLC
     <tapa.expect>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" 
                         />
     </tapa.expect>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>


#
#
#       Test:    4.20
#
#       Desc:    RRC configuration request followed by RRC Connection
#                Setup message.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.20">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
         
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" tCrnti="2"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" cellId="1" 
          valChk="0"/>
      </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup at RLC
     <tapa.expect>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" 
                         />
     </tapa.expect>

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="1" pdcpId="1"
                          tCrnti="2" transId="10" expCfgBitMask="11" 
                          rbCfgType="1" numAddRb="1" addRbIdStr="1,0" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm ueId="2" cellId="1" />
     </tapa.expect>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

########################################
# RRC Connection release Test cases
########################################
#
#
#       Test:    4.21
#
#       Desc:    Successful RRC Connection Release Procedure.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.21">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pretest connecton Setup"
           "This test case will test the scenario of successful RRC connection 
            release procedure. It involves RRC connection release coming from 
            ENodeB, First, we will send a RRC Connection Release from RRC user 
            RRC. On receiving connection release message from RRC user, RRC will  
            pass this connection release to UE. And after getting 
            ACK from Lower layer for transmitted message, RRC will release all 
            the configuration of the lower layers RLC PDCP and MAC.
            RLC, PDCP and MAC layer will do the configuration and will send 
            back configuration confirm to RRC. On getting the configuration 
            confirm messages from RLC, PDCP and MAC, RRC will send Config 
            confirm message to RRC user"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
	  
	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

      #Send RRC Connection Release sent confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      <tapa.delay delay="5" />
      
	  #Send Release Configuration to MAC, RLC and PDCP
     <tapa.expset>
         <tapa.dummy.crg.cfgreq store_tid="1"/>
         <tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
     </tapa.expset>

	 <tapa.delay delay="5"/>

      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

	 #status=0 success, 0x0f- Fail
	 <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="1"/>
      </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm  use="1" ueId="1"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    4.22
#
#       Desc:    RRC Connection Release Procedure.  
#                For invalid UE Context
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.22">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pre Test connecton Setup"
           "This test case will test the scenario of unsuccessful RRC 
            connection release procedure for a UE whose  context does 
            not exist in RRC. It involves RRC connection release coming 
            from ENodeB, First, we will send a RRC Connection Release from 
            RRC user to RRC. RRC can not find the UE Context. It will send 
            Error Indication to RRC user"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User for Invalid UE
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="100" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #RRC should throw error Indicaton
      <tapa.expect>
         <tapa.nhu.errind errorType="9" errorCause="3" ueId="100"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.23
#
#       Desc:    RRC Connection Release Failure due to.  
#                RLC configuration failure.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.23">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pre Test connecton Setup"
           "When RRC release is processed at RRC, after getti ng the DatCfm 
            from PDCP, RRC will configure the lower layers to release the 
            config. On getting configuration Request message from RRC, RLC 
            will try to release its resources. But if this configuration 
            fails, RLC will inform RRC, that configuration failure. Once RRC 
            receives a configuration confirm from RLC layer which indicates 
            configuration failure, RRC should flush the configuration 
            irrespective of the configuration success/failure received from 
             Lower layers"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
      
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User for Invalid UE
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

      #Send RRC Connection Release sent confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      <tapa.delay delay="5" />
      
	  #Send Release Configuration to MAC, RLC and PDCP
     <tapa.expset>
         <tapa.dummy.crg.cfgreq store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" />
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
     </tapa.expset>

	 <tapa.delay delay="5"/>

     #use status in case of Release!!
	 #else use numFailedRb and failedRbIdStr
	 #Send CfgCfm Failed at RLC during Releae (status=2)
	 #RRC will raise an alarm.
	 <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" status="2" ueId="1"/>
     </tapa.send>

	 #Handle the alarm
	 <tapa.expect>
	    <tapa.lnh.staind category="2" event="258" cause="0" alarmType="7" />
	 </tapa.expect>

   </tapa.test>

  # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit />
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.24
#
#       Desc:    RRC Connection Release Discard 
#                Duplicate Transactions  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.24">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pre Test connecton Setup"
           "This test case will test the scenario of duplicate RRC connection 
		   release message sent with Same rrctransId. First, we will send a 
		   RRC Connection Release from RRC user to RRC with RRCTransid as 1. 
		   On receiving connection release message from RRC user, RRC will will pass 
           this connection release to UE. And after getting ACK from Lower layer for transmitted 
           message, RRC will configure the lower layers RLC PDCP and MAC, to release the configuration. 
           RRC user will send full configuration details. In the meanwhile send another Connection 
           Release from RRC user to RRC with RRCTransid as 2. RRC should disard the duplicate one 
           and process the first request. RRC ser shold be notified with error Indication."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.rrc.init/>
   </tapa.cfg>

   <tapa.test>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

	 #RRC user sends RRC Connection Release Message to RRC (Duplicate Transaction)
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

	  <tapa.delay delay="5"/>

	   #Expect Data Confirm at RRC user
       #RRC should throw error Indicaton
      <tapa.expect>
         <tapa.nhu.errind errorType="9" errorCause="8" ueId="1"/>
      </tapa.expect>

      #Send confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      <tapa.delay delay="5" />
      
	  #Send Release Configuration to MAC, RLC and PDCP
     <tapa.expset>
         <tapa.dummy.crg.cfgreq store_tid="1"/>
         <tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
     </tapa.expset>

	 <tapa.delay delay="5"/>

      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

	 #status=0 success, 0x0f- Fail
	 <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="1"/>
      </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm  use="1"  ueId="1"/>
     </tapa.send>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.25
#
#       Desc:    RRC Connection Release for multiple Ues.   
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.25">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pre Test connecton Setup for 2 Ues"
           "This test case will test the scenario of successful RRC 
           connection release for 2 Ues with UeID 1 and 2. procedure. 
           It involves RRC connection release coming from ENodeB, First, we 
           will send a RRC Connection Release from RRC user RRC for UeId 1. 
           Then send RRC connection relase message to UeId 2.RRC should 
           successfully process this message and send these messages to 
           Respective UEs. On getting ACK(DatCfm) from PDCP for successful 
           transmission of message, RRC should configure the lower layers 
           for both the Ues."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.rrc.init/>
   </tapa.cfg>

   <tapa.test>

	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1,2,3
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>
	  <tapa.rrc.consetup ueId="2" cellId="1" tCrnti="2"/>
	  <tapa.rrc.consetup ueId="3" cellId="1" tCrnti="3"/>

	  #CarryOut Connecton release for UE 1,2,3
	  <tapa.rrc.security_actv ueId="1" cellId="1"/>
	  <tapa.rrc.security_actv ueId="2" cellId="1"/>
	  <tapa.rrc.security_actv ueId="3" cellId="1"/>

	  #Start Releasing UE 1,2,3

	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

      #Send confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      <tapa.delay delay="5" />
      
	  #Send Release Configuration to MAC, RLC and PDCP
     <tapa.expset>
         <tapa.dummy.crg.cfgreq store_tid="1"/>
         <tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
     </tapa.expset>

	 <tapa.delay delay="5"/>

      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

	 #status=0 success, 0x0f- Fail
	 <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="1"/>
      </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm  use="1" ueId="1"/>
     </tapa.send>

	 <tapa.rrc.conrls ueId="2" cellId="1"/>
	 <tapa.rrc.conrls ueId="3" cellId="1"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.26
#
#       Desc:    Duplicate transaction for connection Rls.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.26">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pretest connecton Setup"
           "This test case will test the scenario of successful RRC connection 
            release procedure. It involves RRC connection release coming from 
            ENodeB, First, we will send a RRC Connection Release from RRC user 
            RRC. On receiving connection release message from RRC user, RRC will  
            pass this connection release to UE. And after getting 
            ACK from Lower layer for transmitted message, RRC will release all 
            the configuration of the lower layers RLC PDCP and MAC.
            RLC, PDCP and MAC layer will do the configuration and will send 
            back configuration confirm to RRC. On getting the configuration 
            confirm messages from RLC, PDCP and MAC, RRC will send Config 
            confirm message to RRC user"
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
	  
	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>


	 #RRC user sends RRC Connection Release Message to RRC User with Duplicate RRC TransId
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="2" rrcTransIdPres="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="9" errorCause="9" />
      </tapa.expect>

      
	  #Send RRC Connection Release sent confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

	  #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      <tapa.delay delay="5" />
      
	  #Send Release Configuration to MAC, RLC and PDCP
     <tapa.expset>
         <tapa.dummy.crg.cfgreq store_tid="1"/>
         <tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
     </tapa.expset>

	 <tapa.delay delay="5"/>

      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

	 #status=0 success, 0x0f- Fail
	 <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="1"/>
      </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm  use="1" ueId="1" cleanup="1"/>
     </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>


########################################
# RRC Initial Security Activation
########################################
##################################################################################
#       Test:    4.27
#       Desc:    Successful operation of Initial Security Activation Procedure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.27">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the Security Mode Command
         Message request along with security configuration. RRC will encode and
         send security mode command message to PDCP with Selective Security
         Mode enabled.
         After receiving positive confirmation from PDCP, RRC will send Security
         Mode Command to UE. RRC will send configuration confirm to RRC-USER. RRC
         will also send data indication for security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by PDCP
         RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA flag
            set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         6. RRC receives security configuration confirm from PDCP
         7. RRC sends data request to send Security Mode Command message to PDCP
         8. RRC sends configuration confirm to RRC-USER
         9. Check whether RRC-USER receives successful configuration confirm
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security Mode
            Complete Message

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="32" cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.28
#       Desc:    Successful operation of Initial Security Activation Procedure
#                with separate configuration primitive
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.28">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure
       with separate configuration primitive

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the security configuration. RRC
         will send configuration request to PDCP with Selective Security Mode
         enabled. After receiving positive confirmation from PDCP, RRC will send
         configuration confirm to RRC-USER. RRC-USER will send Security Mode
         Command message request to RRC. RRC will check if Security is configured
         (True in this case). RRC will encode and send Security Mode Command to
         UE. RRC will send data indication for Security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by
         PDCP. RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security configuration request to RRC with 'during
            Handover flag set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends configuration confirm to RRC-USER
         7. Check whether RRC-USER receives successful configuration confirm
         8. RRC-USER issues Security Mode Command request to RRC using data request
         9. RRC sends data request to send Security Mode Command message to PDCP
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security
            Command Complete message


      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="2" tCrnti="2" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6" chngIntAlgo="0" chngCiphAlgo="2"
          transId="64" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="2" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.cfgcfm />
     </tapa.expect>

    #Send Security Mode Command without security configuration
     <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" 
          integrityAlgo="1" msgCategory="1" msgType="6"
          cipheringAlgo="1" transId="9" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="2" cellId="4" />
      </tapa.expect>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="2" cellId="4" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

     # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="2" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expect>

     #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="2" cleanup="1" />
      </tapa.send>

    #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="2"  cleanup="1" />
     </tapa.expect>

  </tapa.test>

  # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.29
#       Desc:    Failure of Initial Security Activation Procedure by failure
#                indication from PDCP (Reception of Security Mode Failure Message
#                from UE)
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.29">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Failure of Initial Security Activation Procedure by failure
       indication from PDCP (Reception of Security Mode Failure Message
       from UE)

         RRC-USER establishes the RRC Connection. RRC sends Security Activation
         request to RRC. RRC sends configuration request to PDCP. PDCP sends
         configuration confirm to RRC. RRC sends data request for Security Mode
         Comand to PDCP. PDCP sends Data confirm for this message. PDCP indicates
         RRC about reception of Security Mode Failure Command. RRC sends indication
         to RRC-USER about this message.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA
            flag set to False
         3. RRC sends security configuration request to PDCP with Selective
				Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends Security Mode Command message to PDCP
         7. RRC sends configuration confirm to RRC-USER
         8. Check whether RRC-USER receives successful configuration confirm
         10. RRC receives Security Mode Failure message indication from PDCP
         11. RRC removes the security configuration applied at lower layers
            (UE Context)
         12. RRC sends same failure indication to RRC-USER
         13. Check whether RRC-USER receives Security Mode failure Message
            indication

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg transId="20" cellId="1" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="4" tCrnti="4" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          integrityAlgo="1" msgCategory="1" msgType="6" chngIntAlgo="1" chngCiphAlgo="1"
          cipheringAlgo="1" transId="64" rrc_transId="1" cellId="1"
          ueId="4" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" cellId="1" ueId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="4" cellId="1" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="4" cellId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Failure from PDCP
     <tapa.send>
        <tapa.dummy.pju.staind pdcpInstId="1" secModFailMsg="1" suId="0"
                               ueId="4" cellId="1" cause="1" />
     </tapa.send>

     <tapa.delay delay="1" />

     #Expect Security Mode Failure at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="4" cellId="1" cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="4" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.30
#       Desc:    Failure of Initial Security Activation Procedure by expiry of
#                configuration timer
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.30">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Failure of Initial Security Activation Procedure by expiry of
       configuration timer

         In this case after establishing RRC connection RRC-USER will issue
         security activation request to RRC. RRC sends configuration requests
         to PDCP. RRC detects the configuration timer has expired which was
         started at the time of configuration. RRC sends negative
         confirmation to RRC-USER. RRC does not initiate sending Security Mode
         Command Message to UE.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA'
            flag set to False
         3. RRC sends security configuration request to PDCP with Selective
				Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. Configuration timer expires (insert sufficient delay in this step
            and do not send configuration confirm)
         6. RRC reverts security configuration from lower layers
         6. RRC sends negative configuration confirm to RRC-USER

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #timer value set to 10
      #Gen Cfg to set timer value
      <tapa.send >
         <tapa.lnh.cfg.gen tmrVal="100" />
      </tapa.send>

      # Expect General Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      # PDCP Timeout
      <tapa.delay delay="25" />

      #Expect Security Mode command at PDCP
      <tapa.expect>
         <tapa.nhu.cfgcfm ueId="32" suId="0" status="0" cleanup="1" />
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.31
#       Desc:    Failure of Securiy Mode Command request since security is not
#                yet configured at lower layers
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.31">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Failure of Securiy Mode Command request since security is not
       yet configured at lower layers

         This test is to check that if RRC-USER sends Security Mode Command
         Message request to RRC after establishing connection but without
         security configuration, RRC detects it and error is indicated to
         RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command request using data request
            without configuration
         3. RRC raises error indication to RRC-USER since Security Mode command
            was issued before activating security at lower layers
            (Error cause: "Security Not Configured", Error type: "Validation failure")

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="1" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="2" tCrnti="2" /> 

     #Send Security Mode Command without security configuration
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" 
          integrityAlgo="1" msgCategory="1" msgType="6"
          cipheringAlgo="1" transId="9" rrc_transId="2" cellId="1"
          ueId="2" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expect>
         <tapa.nhu.errind ueId="2" errorType="14" errorCause="27" />
      </tapa.expect>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.32
#       Desc:    Successful operation of simultaneous Initial Security Activation
#                and  RRC Connection Reconfiguration procedures
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.32">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of simultaneous Initial Security Activation
       and  RRC Connection Reconfiguration procedures

         This test is to check that Initial Security Activation and RRC Connection
         reconfiguration procedures work simultaneously. RRC-USER establishes the
         RRC connection and initiates Initial Security Activation for both UE and
         eNB. But before eNB receives Security Command Compelte Message from UE
         RRC-USER starts Reconfiguration procedure by issueing RRC connection
         reconfiguration message. Security Mode Command goes with only Integrity
         protection and no ciphering applied where as RRC Connection
         Reconfiguration Message goes with Integrity protected and ciphered. The
         received Security Mode Complete messages is validated only for Integrity
         protection where as RRC Connection Complete message is validated for
         Integrity protection as well as ciphering. both the validation is
         performed by PDCP layer. This test validates that all the confirmations
         during the transaction are properly received at RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA'
            flag set to False
         3. RRC sends security configuration request to PDCP with Selective
				Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends data request to send Security Mode Command message to PDCP
         7. RRC-USER sends RRC Connection Reconfiguration Request to RRC
         8. RRC sends (security) configuration confirm to RRC-USER
         9. Check whether RRC-USER receives successful configuration confirm
         10. RRC sends data request to PDCP for RRC Connection Reconfiguration
            Message
         11. RRC receives successful indication from PDCP for Security Mode
            Complete
         12. RRC sends successful data indication to RRC-USER for Security Mode
             Complete
         13. Check whether RRC-USER receives successful indication
         14. RRC receives successful indication from PDCP for RRC Connection
            Reconfiguration Complete Message
         15. RRC sends successful data indication to RRC-USER for RRC Connection
            Reconfiguration Complete Message
         16. Check whether RRC-USER receives successful indication
         17. RRC sends configuration request to PDCP, MAC and RLC
         19. RRC receives successful confirmation from lower layers PDCP MAC and
            RLC
         20. RRC sends configuration confirm to RRC-USER
         21. Check whether RRC-USER receives successful configuration confirm

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.delay delay="4" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.send>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.nhu.datcfm />
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>

      <tapa.delay delay="1" />

      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32" transId="1"/>
      </tapa.send>

      <tapa.delay delay="1" />

      <tapa.expset>
         <tapa.dummy.pju.datreq ueId="32" cellId="4" pdcpInstId="1"/>
        <tapa.nhu.cfgcfm/>
      </tapa.expset>

      <tapa.delay delay="1" />

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" />
     </tapa.send>

      <tapa.delay delay="1"/>

      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" cleanup="1"/>
      </tapa.expect>

      <tapa.send>
         <tapa.dummy.cpj.cfgcfm cleanup="1" use="1" status="1" ueId="32" transId="64"/>
      </tapa.send>

     #Expect configuration confirm at RRC user
     <tapa.expset>
         <tapa.nhu.datind ueId="32"  />
     </tapa.expset>

     <tapa.delay delay="1" />


      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

      <tapa.delay delay="10" />

     #Expect configuration confirm at RRC user
     <tapa.expset>
         <tapa.nhu.datind ueId="32"  />
     </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>


##################################################################################
#       Test:    4.33
#       Desc:    Failure of Initial Security Activation Procedure by failure
#                at PDCP (Sec Config Faulure at PDCP)
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.33">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Failure of Initial Security Activation Procedure by failure
       indication from PDCP (Reception of Security Mode Failure Message
       from UE)

         RRC-USER establishes the RRC Connection. RRC sends Security Activation
         request to RRC. RRC sends configuration request to PDCP. PDCP fails
         in security configuration and sends negative confirmation to RRC. RRC
         communicates same to RRC-USER by negative confirmation. RRC does not
         initiate sending Security Command Message to UE.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA
            flag set to False
         3. RRC sends security configuration request to PDCP with Selective
				Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm (negetive) from PDCP
         6. RRC-USER receives security configuration confirm (Negative) from RRC
         8. Check whether RRC-USER receives negative configuration confirm

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect integrity configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="0" ueId="32" secFail="1"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.nhu.cfgcfm ueId="32" suId="0" status="0" />
      </tapa.expset>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.34
#       Desc:    Successful Security Configuration without security command
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.34">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the Security Mode Command
         Message request along with security configuration. RRC will encode and
         send security mode command message to PDCP with Selective Security
         Mode enabled.
         After receiving positive confirmation from PDCP, RRC will send Security
         Mode Command to UE. RRC will send configuration confirm to RRC-USER. RRC
         will also send data indication for security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by PDCP
         RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security configuration request to RRC with 'During
            Handover to EUTRA flag set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         6. RRC receives security configuration confirm from PDCP
         7. RRC sends configuration confirm to RRC-USER
         8. Check whether RRC-USER receives successful configuration confirm

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.cfgcfm cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.35
#
#       Desc:    RRC UE reconfig
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.35">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section=""/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " RRC connection establishment procedure. It involves"
           "RRC connection request coming from UE, RRC connection"
           "setup coming from RRC user and RRC connection setup"
           "complete message coming from UE. All the RRC messages"
           "will have all the mandatory parameters on it."
           "This will be followed by UE ID reconfig being triggered"
           "by RRC user and resulting config requests to RLC, MAC and "
           "PDCP"

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" /> 

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="4" pdcpId="1"
                          ueId="32" transId="10" expCfgBitMask="1" 
                          rbCfgBitMask="1" numAddRb="1" addRbIdStr="7,1" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="32" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="32" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="32" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="32"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm ueId="32" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#
#       Test:    4.36
#
#       Desc:    Simultaneous multiple UEs connection establishment
#                and revert for 1 UE.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.36">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section=""/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " multiple UEs RRC connection establishment procedure with"
           "revert for one UE. It involves"
           "RRC connection request coming from multiple UE, RRC connection"
           "setup coming from RRC user for respective UEs and RRC "
           "connection setup complete message coming from each UE."
           "for one of the UE generate negative config confirm from lower layer"
           "revert will be triggered for the failed UE"
           "All the RRC messages"
           "will have all the mandatory parameters on it."

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />
   </tapa.cfg>

   # Test Steps subsection
   <tapa.test>
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      # Send 3 RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="3" />
      </tapa.send>

      <tapa.delay delay="10" />
      #Expect RRC Connection Request at RRC user
      <tapa.expset >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
         <tapa.nhu.datind cellId="1" tCrnti="3" />
      </tapa.expset>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgBitMask="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1" pdcpId="1" valChk="0"/>
      </tapa.send>
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgBitMask="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="3" cellId="1" 
          addRbIdStr="1" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="10" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" />
         <tapa.dummy.cpj.cfgreq  use="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="3"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>


     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="3"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="3"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" numFailedRb="1" failedRbIdStr="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="3"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         # cancel UE request to MAC and PDCP for failed cfg cfm for a UE
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq  use="1" storeCfms="0"/>
        <tapa.nhu.cfgcfm/>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
          cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="3" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expset>
        <tapa.nhu.datind ueId="2" cellId="1" />
        <tapa.nhu.datind ueId="3" cellId="1" />
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="3" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>


#
#
#       Test:    4.37
#
#       Desc:    UeId Change request with cfgcfm failure for MAC LC Cfg. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.37">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "locate UE context, it sends old CRNTI to RRC. "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "MAC will Send cfgcfm with status failed for LC config failure.
         "RRC will revert all the succesful configuration".
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC with status Failed
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="15" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     
     #<tapa.send>
     #    <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq use="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.ueidchngreq  use="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
      </tapa.expset>

     <tapa.expset>
        <tapa.nhu.cfgcfm status="0"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>
#
#
#       Test:    4.38
#
#       Desc:    UeIdChange Request rvrt due to Rlc config failure
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.38">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "locate UE context, it sends old CRNTI to RRC. "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "RLC will Send cfgcfm with status failed for UeIDChgCfm config failure.
         "RRC will revert all the succesful configuration".
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1,0" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC 
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>

     #Send Failed ueIdChgCfm confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="2" ueId="2"/>
     </tapa.send>

     #<tapa.send>
     #    <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>

     <tapa.delay delay="5" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.ueidchngreq  use="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
      </tapa.expset>

     <tapa.expset>
        <tapa.nhu.cfgcfm status="0"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.39
#
#       Desc:    UEID chnage request rvrt due to pdcp cfg cfm failure.
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.39">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI  "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "PDCP will Send cfgcfm with status failed for UeIDChgCfm config failure.
         "RRC will revert all the succesful configuration".
         "locate UE context, it sends old CRNTI to RRC. RRC sends it to RLC."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1,0" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC 
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>

     
     #<tapa.send>
     #    <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send  ueIdChgCfm confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="0" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send failed ueidchange  confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="0" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq  use="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
      </tapa.expset>

     <tapa.expset>
        <tapa.nhu.cfgcfm status="0"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>
#
#
#       Test:    4.40
#
#       Desc:    UE Id Change requset: TimeOut case, Rvrt ueIdChange Request
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.40">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "MAC wont send  cfgcfm for LC cfgReq.
         "TimeOut will occur and RRC will revert all the succesful 
         configuration".
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1,0" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

#used for time out case dont send crgCfgCfm for LCID 
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>
     
     #<tapa.send>
     #    <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send  ueIdChgCfm confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="0" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send  ueidchange  confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="30" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq  use="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.ueidchngreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
      </tapa.expset>

     <tapa.expset>
        <tapa.nhu.cfgcfm status="0"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>


#
#
#       Test:    4.41
#
#       Desc:    Decode Failure 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.41">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "
           In case of integrity failure at PDCP, RRC generates Status
           indication towards RRC user.
           "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.rrc.init/>
   </tapa.cfg>

   <tapa.test>

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

      # send PDCP dat indication to generate decoding failure in RRC 
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="9" spId="0"
                         suId="0" ueId="1" cellId="1" decodeFail="1"/>

      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Error Indication at RRC user and alarm at LM
     <tapa.expset>
        <tapa.lnh.staind category="1" event="16" cause="6" alarmType="6"/>
        <tapa.nhu.errind errorType="8" errorCause="0" pdcpId="1" />
     </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.42
#
#       Desc:    Transaction Control Block  and MUI Control Block
#                with zero predefined allocation
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.42">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "Setup a RRC Connection with zero predefined allocation for transaction
         control block and MUI control block and perform security activation
         procedure. All the above steps are successful."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>

      #Gen Cfg for LTE-RRC
      <tapa.send >
         <tapa.lnh.cfg.gen numUSaps="1" numLSaps="5" 
         minTransLstLen="0" minMuiLstLen="0" tmrVal="30" />
      </tapa.send>

      # Expect General Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      # Send Protocol Config Request from LM to RRC
      <tapa.send>
         <tapa.lnh.cfg.prot maxConn = "5"/>
      </tapa.send>

      # Expect Protocol Configuration Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

       # Send Upper Sap configuration request from LM to RRC (NX)
        <tapa.send>
          <tapa.lnh.cfg.usap Ent="216" procId="900"/>
        </tapa.send>

        # Expect Upper SAP Config confirm from RRC to  LM
        <tapa.expect>
            <tapa.lnh.cfg.cfm spId="0"/>
        </tapa.expect>
                                                
      # Send Lower Sap configuration request from LM to RRC (KWU)
      <tapa.send>
         <tapa.lnh.cfg.lsap elem="3" suId="0" spId="0" Ent="213" procId="900"/>
      </tapa.send>
     <tapa.delay delay="5"/>
      
      # Expect Lower SAP Config confirm from RRC to LM (KWU)
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      # LM will send control request to bind and enable LSAP (KWU)
      <tapa.send>
        #tapa.lnh.cntrl.lsap action="ABND_ENA"
         <tapa.lnh.cntrl.lsap action="21" spId="0"  suId="0" elem="3"/>
      </tapa.send>
      
      # RRC will send bind request to KWU
      <tapa.expset>
         <tapa.dummy.kwu.bndreq/>
      </tapa.expset>

      # KWU will send bind confirm to RRC
      <tapa.send>
        <tapa.dummy.kwu.bndcfm suId ="0" status="1"/>
      </tapa.send>

      <tapa.expect>
         <tapa.lnh.cntrlcfm/>
      </tapa.expect>

      # Send Lower Sap configuration request from LM to RRC (CKW)
      <tapa.send>
         <tapa.lnh.cfg.lsap elem="4" suId="0" spId="0" Ent="213" procId="900"/>
      </tapa.send>

      # Expect Lower SAP Config confirm from RRC to LM (CKW)
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>
      
      # LM will send control request to bind and enable LSAP(CKW)
      <tapa.send>
        #tapa.lnh.cntrl.lsap action="ABND_ENA"
         <tapa.lnh.cntrl.lsap action="21" suId="0" spId="0" elem="4"/>
      </tapa.send>

      # RRC will send bind request to (CKW)
      <tapa.expset>
         <tapa.dummy.ckw.bndreq/>
         <tapa.lnh.cntrlcfm/>
      </tapa.expset>
  
      # CKW will send bind confirm to RRC
      <tapa.send>
        <tapa.dummy.ckw.bndcfm suId ="0" status="1"/>
      </tapa.send>

      #CRG
      # Send Lower Sap configuration request from LM to RRC (CRG)
      <tapa.send>
         <tapa.lnh.cfg.lsap elem="5" suId="0" spId="0" Ent="212" procId="900"/>
      </tapa.send>

      <tapa.delay delay="5"/>
      
      # Expect Lower SAP Config confirm from RRC to LM (CRG)
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      # LM will send control request to bind and enable LSAP (CRG)
      <tapa.send>
         <tapa.lnh.cntrl.lsap action="21" suId="0" spId="0" elem="5"/>
      </tapa.send>

	  <tapa.delay delay="5"/>

      # RRC will send bind request to CRG
      <tapa.expset>
         <tapa.dummy.crg.bndreq/>
         <tapa.lnh.cntrlcfm/>
      </tapa.expset>
  
      <tapa.delay delay="5"/>
      
      # KWU will send bind confirm to RRC (CRG)
      <tapa.send>
        <tapa.dummy.crg.bndcfm suId ="0" status="1"/>
      </tapa.send>

	  #CPJ
      # Send Lower Sap configuration request from LM to RRC (CPJ)
      <tapa.send>
         <tapa.lnh.cfg.lsap elem="6" suId="0" spId="0" Ent="214" procId="900"/>
      </tapa.send>

      <tapa.delay delay="10"/>
      
      # Expect Lower SAP Config confirm from RRC to LM (CPJ)
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

      # LM will send control request to bind and enable LSAP (CPJ)
      <tapa.send>
        #tapa.lnh.cntrl.lsap action="ABND_ENA"
         <tapa.lnh.cntrl.lsap action="21" suId="0" spId="0" elem="6"/>
      </tapa.send>

      # RRC will send bind request to CPJ
      <tapa.expset>
         <tapa.dummy.cpj.bndreq/>
         <tapa.lnh.cntrlcfm/>
      </tapa.expset>
  
      <tapa.delay delay="5"/>

	   # CPJ will send bind confirm to RRC (CPJ)
      <tapa.send>
        <tapa.dummy.cpj.bndcfm suId ="0" status="1"/>
      </tapa.send>

	  #PJU
	  # Send Lower Sap configuration request from LM to RRC (PJU)
      <tapa.send>
         <tapa.lnh.cfg.lsap elem="7" suId="0" spId="0"/>
      </tapa.send>

	  # Expect Lower SAP Config confirm from RRC to LM (PJU)
      <tapa.expect>
         <tapa.lnh.cfg.cfm/>
      </tapa.expect>

	  # LM will send control request to bind and enable LSAP (PJU)
      <tapa.send>
         <tapa.lnh.cntrl.lsap action="21" suId="0" spId="0" elem="7"/>
      </tapa.send>

	  # RRC will send bind request to PJU
      <tapa.expset>
         <tapa.dummy.pju.bndreq/>
         <tapa.lnh.cntrlcfm/>
      </tapa.expset>

      <tapa.delay delay="5"/>
      
      # PDCP will send bind confirm to RRC (PJU)
      <tapa.send>
        <tapa.dummy.pju.bndcfm suId ="0" status="1"/>
      </tapa.send>
      
      # NHU will send bind request to RRC
      <tapa.send>
         <tapa.nhu.bndreq/>
      </tapa.send>

      # RRC will send bind confirm to NHU
      <tapa.expect>
         <tapa.nhu.bndcfm status="1"/>
      </tapa.expect>

	  # Send control request to enable unsolicited alarms
      <tapa.send >
         <tapa.lnh.cntrl.usta action="1" subAction="3"/>
      </tapa.send>
      
      # Expect control Confirm from RRC to LM
      <tapa.expect>
         <tapa.lnh.cntrlcfm/>
      </tapa.expect>


      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" /> 

     #RRC Security Activation Procedure
     <tapa.rrc.security_actv ueId="32" cellId="4"/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.43
#
#       Desc:    Cancel UE request validation test
#
#       Notes:   None
#
#       Module:
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.43">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="None" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
			  "After RRC connection is established, RRC user will use 
            cancel UE request to delete the UE context during any abnormality.
            This test case tests several validations for the cancel UE 
            request." 
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.rrc.init/>
      <tapa.rrc.cellcfg cellId="1"/>
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>
   </tapa.cfg>

   <tapa.test>
   #cancel UE request with invalid cell Id
      #Send cancel UE request from RRC user
     <tapa.send>
        <tapa.nhu.cncluereq cellId="2" ueId="1" />
     </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="5" errorCause="2" />
      </tapa.expect>

   #cancel UE request with invalid UE Id
      #Send cancel UE request from RRC user
     <tapa.send>
        <tapa.nhu.cncluereq cellId="1" ueId="2" />
     </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="5" errorCause="3" />
      </tapa.expect>
      #Send cancel UE request from RRC user
     <tapa.send>
        <tapa.nhu.cncluereq cellId="0" ueId="2" />
     </tapa.send>

      #Expect Error Indication at RRC user
      <tapa.expect >
         <tapa.nhu.errind errorType="9" errorCause="6" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
		<tapa.rrc.deinit/>
	</tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.44
#
#       Desc:    Connection release procedure with Datcfm=
#       Max_rlc_retransmissions.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.44">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pretest connecton Setup"
           "This test case will test the scenario of successful RRC connection 
            release procedure. It involves RRC connection release coming from 
            ENodeB, First, we will send a RRC Connection Release from RRC user 
            RRC. On receiving connection release message from RRC user, RRC will  
            pass this connection release to UE. PDCP will send the datcfm with 
            RLC_MAX_RETRANSMISSION . RRC will not send any cfgReq to lower
            layers and also wont delete the UE context."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
	  
	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

   #Send RRC Connection Release sent confirm with PJU_RLC_TRANS_FAIL from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1" status="1"/>
      </tapa.send>

      <tapa.delay delay="3" />

  #Expect Data Confirm at RRC user with status  NHU_ERRCAUSE_MAX_RLC_TRANS_REACH
     <tapa.expect>
        <tapa.nhu.datcfm datCfmStatus="35" pdcpId="1"/>
     </tapa.expect>

      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.45
#
#       Desc:    UE Id Change requset: TimeOut case, Rvrt ueIdChange Request
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.45">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "MAC wont send  cfgcfm for LC cfgReq.
         "TimeOut will occur and RRC will revert all the succesful 
         configuration".
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1,0" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

#used for time out case dont send crgCfgCfm for LCID 
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="0" ueId="6"/>
     </tapa.send>
     
     #<tapa.send>
      #   <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send  ueIdChgCfm confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="0" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send  ueidchange  confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="30" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0"/>
         <tapa.dummy.ckw.ueidchngreq  use="1" storeCfms="0"/>
         <tapa.dummy.ckw.cfgreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.ueidchngreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.cfgreq use="1" storeCfms="0"/>
      </tapa.expset>

     <tapa.expset>
        <tapa.nhu.cfgcfm status="0"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.46
#
#       Desc:    Connection release procedure with Datcfm=
#                   PJU_DISCARD_TMR_EXP
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.46">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pretest connecton Setup"
           "This test case will test the scenario of successful RRC connection 
            release procedure. It involves RRC connection release coming from 
            ENodeB, First, we will send a RRC Connection Release from RRC user 
            RRC. On receiving connection release message from RRC user, RRC will  
            pass this connection release to UE. PDCP will send the datcfm with 
            RLC_MAX_RETRANSMISSION . RRC will not send any cfgReq to lower
            layers and also wont delete the UE context."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
	  
	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

   #Send RRC Connection Release sent confirm with PJU_DISCARD_TMR_EXP from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1" status="2"/>
      </tapa.send>

      <tapa.delay delay="3" />

  #Expect Data Confirm at RRC user with status
      NHU_ERRCAUSE_PDCP_SDU_DIS_TMR_EXP
     <tapa.expect>
        <tapa.nhu.datcfm datCfmStatus="36" pdcpId="1"/>
     </tapa.expect>

      

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.47
#
#       Desc:    Invalid cellId/ueId/mui/pdcpId,during datcfm. Expect Error
#       Indication
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.47">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "Pretest connecton Setup"
           "This test case will test the scenario of successful RRC connection 
            release procedure. It involves RRC connection release coming from 
            ENodeB, First, we will send a RRC Connection Release from RRC user 
            RRC. On receiving connection release message from RRC user, RRC will  
            pass this connection release to UE. PDCP will send the datcfm with 
            RLC_MAX_RETRANSMISSION , but with invalid cellId, ueId, mui, pdcpId
            . RRC will not send any cfgReq to lower. Expect Error Indication at
            NHU.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # LM Configure
      <tapa.rrc.init />
   </tapa.cfg>

   <tapa.test>
	  
	  #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

	  #msgCategory=1 DLDCCH, msgType=5 Connection Rls
      #rrcTransIdPres="1" rrc TransID present.
      #bitMask=0, No Ue Configuration present.
      #We will Simply release all config after receiving
      #DatCfm Frpm PDCP
	  #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" ueId="1" cellId="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="1" cellId="1"/>
     </tapa.expect>

   #Send RRC Connection Release sent confirm with PJU_RLC_TRANS_FAIL from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="2" status="1"/>
      </tapa.send>

   #Send RRC Connection Release sent confirm with PJU_RLC_TRANS_FAIL from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="2" cellId="1" status="1"/>
      </tapa.send>
   #Send RRC Connection Release sent confirm with PJU_RLC_TRANS_FAIL from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="1" cellId="1" mui="100" status="1"/>
      </tapa.send>
      <tapa.delay delay="3" />


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.48
#
#       Desc:    Status Indication with invalid CellId/ueId
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.48">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.8"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "
           Status Indication with invalid cellId/UeId
           "
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      <tapa.rrc.init/>
   </tapa.cfg>

   <tapa.test>
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />

      #carry Out connection establishment for UE 1
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>

      # Send RRC Connection Request from RLC with invalid cellId
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="2" tCrnti="2" />
      </tapa.send>

   #send status ind with cause= PJU_CIP_FAILED
	 <tapa.send>
        <tapa.dummy.pju.staind ueId="1" pdcpInstId="1" cellId="2" cause="2"/>
     </tapa.send>
   #send status ind with cause= PJU_CIP_FAILED
	 <tapa.send>
        <tapa.dummy.pju.staind ueId="2" pdcpInstId="1" cellId="1" cause="2"/>
     </tapa.send>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.49
#
#       Desc:    Successful RRC Connection Establishment 
#                Procedure with default configurations  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.49">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " RRC connection establishment procedure with  default configuration.
		    It involves RRC connection request coming from UE, RRC connection"
           "setup coming from RRC user and RRC connection setup"
           "complete message coming from UE. All the RRC messages"
           "will have all the mandatory parameters on it."

           "First, we will send a RRC Connection Request from RLC" 
           "stub to RRC."  

           "On receiving RRC Connection Request from RLC, RRC" 
           "decodes and validates this message and then passes"
           "it to RRC user. RRC user sends RRC Connection Setup "
           "along with the configuration information to RRC. In"
           "this test case, we assume that RRC user sends explicit"
           "configuration details."

           "On getting the message from RRC user, RRC reads the "
           "configuration information present in the primitive and"
           "initiates the configuration of RLC, PDCP and MAC layers"
           "by sending configuration request to RLC, PDCP and MAC."

           "RLC, PDCP and MAC layers sends positive reply by sending"
           "configuration confirm to RRC. On getting all the "
           "configuration confirm from RLC, PDCP and MAC layers, RRC"
           "sends configuration confirm to RRC user."

           "RRC encodes the received RRC Connection Setup  and sends"
           "it to RLC. This means RRC Connection Setup message is sent"
           "to UE."

           "UE applies the configuration at its end and sends RRC"
           "Connection Setup Complete to eNB."

           "On getting RRC Connection Setup Complete from PDCP, RRC "
           "decodes the message and if decode is successful, RRC "
           "forwards RRC Connection Setup Complete to RRC user." 

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1" pdcpId="1" 
		  ulrlcCfgType="4" dlrlcCfgType="4" trChCfgType="4" antCfgType="4" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" tCrnti="2" tCrntiPres="1"
          />
         <tapa.dummy.crg.cfgreq  store_tid="1" tCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"
          />
         <tapa.dummy.ckw.cfgreq  use="1" tCrnti="2" tCrntiPres="1" cleanup="1"
          />
         <tapa.dummy.cpj.cfgreq  use="1" tCrnti="2" tCrntiPres="1" cleanup="1"
          />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.50
#
#       Desc:    Expect UEIdChangeReq. Before sending ueIdChgCfm send delete
#       cellCb or cell Rls.
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.50">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
      Expect UEIdChangeReq. Before sending ueIdChgCfm send delete
       cellCb or cell Rls.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1" pdcpId="1" valChk="0" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.cfgreq  use="1"  />
         <tapa.dummy.cpj.cfgreq  use="1"  />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="8"
          msgCategory="3" msgType="3" rrc_transId="1" transId="11"
          rbId="1" tCrnti="6" cellId="1" 
          pdcpId="1" ueId="2" valChk="0" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" storeCfms="0" />
         <tapa.dummy.ckw.ueidchngreq use="1" storeCfms="0"/>
         <tapa.dummy.cpj.ueidchngreq  use="1" storeCfms="0"/>
      </tapa.expset>

       <tapa.rrc.cellcfg.rls cellId="1" />
    
   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
     <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.51
#
#       Desc:    Successful SRB2 configuration and modification with dflt
#       configuration.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.51">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          Successful SRB2 configuration and modification with dflt
          configuration.
       </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>
   </tapa.cfg>

   <tapa.test>
##Adding SRB2 with deflt configuration
	  <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
		 msgCategory="1" msgType="4" transId="10" rrc_transId="1"
		 cellId="1" ueId="1" pdcpId="1" numAddRb="1" addRbIdStr="2,0"
		 addLcIdStr="2" addBitMskStr="7" rbCfgType="1" logChType="3"
		 trChCfgDed="0" macSchedCfg="0" ulrlcCfgType="4" dlrlcCfgType="4"
       trChCfgType="4" antCfgType="4" valChk="0" ulLcCfgType="4"/>
      </tapa.send>

	  <tapa.delay delay="5" />
	  
 
     #Expect Lower Layer configurations
     #Expect Conn Recfg Complete at NHU  
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
		 <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
      </tapa.expset>
     
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>
     

	 <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="1"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

	  #Expect Conn Recfg PJU/PDCP
      <tapa.expect>
         <tapa.dummy.pju.datreq ueId="1" cellId="1" pdcpInstId="1"/>
      </tapa.expect>

     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

	  <tapa.delay delay="1" />

	  # Send Conn Recfg Complete
      # msgType="3" Conn Recfg Complete
      # cellId and ueId should be passed.
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="1" cellId="1"/>
      </tapa.send>

     <tapa.expect>
		 <tapa.nhu.datind ueId="1" cellId="1"/>
     </tapa.expect>

	  <tapa.delay delay="5" />
################
##Modify SRB2 with dflt configuration
	  <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
		 msgCategory="1" msgType="4" transId="10" rrc_transId="1"
		 cellId="1" ueId="1" pdcpId="1" numModRb="1" modRbIdStr="2,0"
		 modLcIdStr="2" modBitMskStr="7" rbCfgType="2" logChType="3"
		 trChCfgDed="0" macSchedCfg="0" ulrlcCfgType="4" dlrlcCfgType="4"
       trChCfgType="4" antCfgType="4" valChk="0" ulLcCfgType="4"/>
      </tapa.send>

	  <tapa.delay delay="5" />
	  
 
     #Expect Lower Layer configurations
     #Expect Conn Recfg Complete at NHU  
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
		 <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
      </tapa.expset>
     
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="1"/>
     </tapa.send>
     

	 <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="1"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

	  #Expect Conn Recfg PJU/PDCP
      <tapa.expect>
         <tapa.dummy.pju.datreq ueId="1" cellId="1" pdcpInstId="1"/>
      </tapa.expect>

     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

	  <tapa.delay delay="1" />

	  # Send Conn Recfg Complete
      # msgType="3" Conn Recfg Complete
      # cellId and ueId should be passed.
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="1" cellId="1"/>
      </tapa.send>

     <tapa.expect>
		 <tapa.nhu.datind ueId="1" cellId="1"/>
     </tapa.expect>
     
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="1" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.52
#
#       Desc:    Delete transReq during an ongoing transaction.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.52">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         Delete transReq during an ongoing transaction.  

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
      <tapa.rrc.consetup ueId="1" cellId="1" tCrnti="1"/>

	  <tapa.rrc.security_actv ueId="1" cellId="1"/>
   </tapa.cfg>

   <tapa.test>

	  <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
		 msgCategory="1" msgType="4" transId="10" rrc_transId="1"
		 cellId="1" ueId="1" pdcpId="1" numAddRb="1" addRbIdStr="2,0"
		 addLcIdStr="2" addBitMskStr="7" rbCfgType="1" logChType="3"
		 trChCfgDed="0" macSchedCfg="0" ulrlcCfgType="4" dlrlcCfgType="4"
       trChCfgType="4" antCfgType="4" valChk="0" ulLcCfgType="4"/>
      </tapa.send>

	  <tapa.delay delay="5" />
	  
     #Expect Lower Layer configurations
     #Expect Conn Recfg Complete at NHU  
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
		 <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
      </tapa.expset>
     
## Send Delete transReq in between expect error indication
     <tapa.send>
       <tapa.nhu.deletetransreq ueId="1" cellId="1" transId="10" spId="0" />
     </tapa.send>

     <tapa.expect>
       <tapa.nhu.errind errType="4" errCause="5" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="1" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>


##################################################################################
#       Test:    4.53
#       Desc:      Successful operation of countercheck procedure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.53">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of countercheck procedure

         RRC-USER will establish RRC connection to create SRB1 and activates
         security mode on both sides (eNB and UE). After this RRC-USER will issue
         connection reconfiguration request to create few DRBs. This has to be
         done, as Counter check procedure is for DRBs only. RRC will issue
         configuration request to lower layers (PDCP, MAC, RLC). RRC
         receives successful confirmation from all these lower layers. With this
         few DRBs are established. Now RRC-USER will issue counter check message
         request to RRC. RRC will encode and send this message to UE through PDCP.
         PDCP indicates RRC about reception of Counter Check Response message.
         RRC will decode this response and sends it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
            SRB1 is created and security is activated)
         2. Reconfigure the RRC connection (to establish DRBs)
         3. RRC-USER sends CounterCheck Message to RRC
         4. RRC passes this message to PDCP
         5. RRC receives indication from PDCP for Counter Check Response
         6. RRC sends indication to RRC-USER with this message.
         7. Check did RRC-USER receives data indication for Counter Check
            Response

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>

     <tapa.delay delay="5" />

      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Counter Check Message Request
     <tapa.send>
         <tapa.nhu.datreq ueId="32" spId="0" msgCategory="1" msgType = "8" cellId="4"
            ratType="0" transId="10" rrc_transId="1" pdcpId="1" valChk="0" rrcTransIdPres="1"
            bitMask = "0" numDrbs="2" drbIdStr="3,4" />
     </tapa.send>

      <tapa.delay delay="1" />

     # Expect Dat Req at PDCP
     <tapa.expect>
         <tapa.dummy.pju.datreq cellId="4" ueId="32" pdcpInstId="1"/>
     </tapa.expect>

      # Send data confirm from PDCP U-Plane
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.send>

      <tapa.delay delay="2" />

     # Expect Dat cfm from RRC User
     <tapa.expect>
         <tapa.nhu.datcfm/>
     </tapa.expect>

     # Send Dat ind from PDCP
     <tapa.send>
         <tapa.dummy.pju.datind pdcpInstId="1" msgType="10" spId="0" suId="0"
                  ueId="32" cellId="4" drbIdStr="3,4" />
     </tapa.send>

      <tapa.delay delay="2" />

     # Expect Dat ind at RRC User
     <tapa.expect>
         <tapa.nhu.datind ueId="32" />
     </tapa.expect>

   </tapa.test>
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.54
#       Desc:    Unsuccessful operation of Get Count Values Request after DRBs created
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.54">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
          Unsuccessful operation of Get Count Values Request after DRBs created
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

     <tapa.delay delay="5" />

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Count request
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.dummy.cpj.cntreq spId = "0" use="1"/>
     </tapa.expect>

    # Send Count confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="1" use="1" cleanup="1"
               ueId="32" cellId="4" drbIdStr="3,4" nullCfgCfm="1"/>
     </tapa.send>

     <tapa.timeout/>
   </tapa.test>

   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##########################################################
#  Test Case 4.55
##########################################################

<tapa.testcase id="4.55">
   #<tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       "Successful operation of Initial Security Activation Procedure"
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   duplicate="1" status="1" ueId="32" invalidCellId="3" cleanup="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   duplicate="1" status="1" ueId="32" invalidUeId="2" cleanup="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   duplicate="1" status="1" ueId="32" invalidTransId="1" cleanup="0"/>
      </tapa.send>

      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>
      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="32" cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.56
#
#       Desc:    UeId Change request with cfgcfm failure for MAC LC Cfg. 
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
<tapa.testcase id="4.56">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="None"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "UE fails to receive the message and re-sends RRC Connection Request."
         "RRC user sends RRC Connetion Setup with new Temprory CRNTI and to "
         "locate UE context, it sends old CRNTI to RRC. "
         "RRC will send the ueIdChange request toward RLC, PDCP and LC cfg
         towards MAC"
         "MAC will Send cfgcfm with status failed for LC config failure.
         "RRC will revert all the succesful configuration".
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1"/>
         <tapa.dummy.ckw.cfgreq  use="1"/>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC with RB Configuration
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      #and RB re-configuration
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="2"  numModRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="6" cellId="1" 
          modRbIdStr="1" modLcIdStr="1" pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         #<tapa.dummy.ckw.cfgreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
         <tapa.dummy.cpj.cfgreq use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC with status Failed
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" status="15" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     
     #<tapa.send>
      #   <tapa.dummy.ckw.cfgcfm   use="1" ueId="6"/>
     #</tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="6"/>
     </tapa.send>
     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />
      #Expect UE ID and RB change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.ueidchngreq use="1" />
         <tapa.dummy.ckw.cfgreq use="1" />
         <tapa.dummy.cpj.ueidchngreq  use="1" />
         <tapa.dummy.cpj.cfgreq use="1" />
      </tapa.expset>

       <tapa.expect>
        <tapa.nhu.cfgcfm status="0"/>
       </tapa.expect>

     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>
     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="2" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="2" ueId="6"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>


     <tapa.expset>
         <tapa.lnh.staind category="2" event="257" cause="0" alarmType="7"/>
         <tapa.lnh.staind category="2" event="258" cause="0" alarmType="7"/>
     </tapa.expset>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="2" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

##################################################################################
#       Test:    4.57
#       Desc:    Unsuccessful operation of Get Count Request - invalide cell ID
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.57">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Get Count Values Request after DRBs created

         RRC-USER will establish the  RRC connection and does connection
         reconfiguration to establish all required RBs (SRBs and DRBs). Then RRC
         user initiates DL information transfer and UE does UL Information
         transfer. This is to make sure that Count values are not zero. After this
         RRC-USER issues Get Count Values request to RRC. RRC will send the Get
         Count Values request to PDCP. RRC receives Indication from PDCP
         containing Count values for all established DRBs. RRC will send
         confirmation to RRC-USER containing the counter information it has got
         from PDCP.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is activated)
         2. Reconfigure the RRC connection (to establish DRBs)
         3. RRC-USER sends Get Count Values Request Message to RRC with invalide
            cell ID
         4. RRC validates the request and sends error indication to RRC-USER
            with error type NHU_ERRTYPE_INV_NHU_HDR (9) and error cause
            NHU_ERRCAUSE_UE_NOT_CONFIGURED (2)

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

     <tapa.delay delay="1" />
      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Count request with invalide cell ID
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="0"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.nhu.errind errorType="9" errorCause="2" />
     </tapa.expect>

   </tapa.test>

   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.58
#       Desc:    Unsuccessful operation of Get Count Request - invalide CPJ SAP List
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.58">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Get Count Values Request after DRBs created

         RRC-USER will establish the  RRC connection and does connection
         reconfiguration to establish all required RBs (SRBs and DRBs). Then RRC
         user initiates DL information transfer and UE does UL Information
         transfer. This is to make sure that Count values are not zero. After this
         RRC-USER issues Get Count Values request to RRC. RRC will send the Get
         Count Values request to PDCP. RRC receives Indication from PDCP
         containing Count values for all established DRBs. RRC will send
         confirmation to RRC-USER containing the counter information it has got
         from PDCP.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is activated)
         2. Reconfigure the RRC connection (to establish DRBs)
         3. RRC-USER sends Get Count Values Request Message to RRC with invalide
            cell ID
         4. RRC validates the request and sends error indication to RRC-USER
            with error type NHU_ERRTYPE_UE_CFG (15) and error cause
            NHU_ERRCAUSE_INV_CFG_TYPE (18)

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />


      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>

 
     <tapa.rrc.delsap.pju/>
     <tapa.rrc.delsap.cpj/>
      <tapa.rrc.delsap.kwu/>
      <tapa.rrc.delsap.ckw/>
      <tapa.rrc.delsap.crg/>
     # Send Count request with invalide cell ID
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"
               />
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.nhu.errind errorType="15" errorCause="18" />
     </tapa.expect>

   </tapa.test>

   <tapa.clean>
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.59
#       Desc:    Unsuccessful operation of Initial Security Activation Configuration
#                due to invalid SAP
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.59">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure
       with separate configuration primitive

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the security configuration. RRC
         will send configuration request to PDCP with Selective Security Mode
         enabled. After receiving positive confirmation from PDCP, RRC will send
         configuration confirm to RRC-USER. RRC-USER will send Security Mode
         Command message request to RRC. RRC will check if Security is configured
         (True in this case). RRC will encode and send Security Mode Command to
         UE. RRC will send data indication for Security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by
         PDCP. RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security configuration request to RRC with 'during
            Handover flag set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends configuration confirm to RRC-USER
         7. Check whether RRC-USER receives successful configuration confirm
         8. RRC-USER issues Security Mode Command request to RRC using data request
         9. RRC sends data request to send Security Mode Command message to PDCP
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security
            Command Complete message


      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="2" tCrnti="2" />

     <tapa.rrc.delsap.cpj/>
     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.nhu.errind/>
      </tapa.expect>

  </tapa.test>

  # Clean subsection
   <tapa.clean>
      <tapa.rrc.delsap.kwu/>
      <tapa.rrc.delsap.ckw/>
      <tapa.rrc.delsap.crg/>
      <tapa.rrc.delsap.pju/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.60
#       Desc:    Unsuccessful operation of Connection establishment
#                due to duplicate transId
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.60">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
            Unsuccessful operation of Connection establishment
            due to duplicate transId
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="2" tCrnti="2" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />


     #Send Security Mode Command with same transId
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" />
      </tapa.send>


      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="2" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

	 #Handle the alarm
	 <tapa.expect>
	    <tapa.lnh.staind category="4" event="256" cause="16" alarmType="0" />
	 </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.cfgcfm />
     </tapa.expect>

    #Send Security Mode Command without security configuration
     <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" 
          integrityAlgo="1" msgCategory="1" msgType="6"
          cipheringAlgo="1" transId="9" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="2" cellId="4" />
      </tapa.expect>

      #Send erroneous Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="2" cellId="4" numSdus="0"/>
      </tapa.send>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="2" cellId="4" status="1"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

     # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="2" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1"/>
      </tapa.expect>

     #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="2" cleanup="1" />
      </tapa.send>

    #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="2"  cleanup="1" />
     </tapa.expect>

  </tapa.test>

  # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.61
#
#       Desc:    RRC configuration request followed by RRC Connection
#                Setup message -Failure due to invalid SAP info
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.61">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
         
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" tCrnti="2"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" cellId="1" 
          valChk="0"/>
      </tapa.send>

     <tapa.delay delay="1" />

     #Expect RRC Connection Setup at RLC
     <tapa.expect>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" 
                         />
     </tapa.expect>

      <tapa.rrc.delsap.kwu/>
      <tapa.rrc.delsap.ckw/>
      <tapa.rrc.delsap.crg/>
      <tapa.rrc.delsap.cpj/>
      <tapa.rrc.delsap.pju/>

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="1" pdcpId="1"
                          tCrnti="2" transId="10" expCfgBitMask="11"  
                          rbCfgType="1" numAddRb="1" addRbIdStr="1,0" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expect>
         <tapa.nhu.errind/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

##################################################################################
#       Test:    4.62
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                 due to null SDU passed
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.62">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
            Unsuccessful operation of Initial Security Activation Procedure
            due to null SDU passed
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" nullSdu="1"/>
      </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.63
#
#       Desc:    RRC configuration request followed by RRC Connection
#                Setup message - Failure due to NULL SDU passed
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.63">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
         
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" tCrnti="2"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" cellId="1" 
          valChk="0" nullSdu="1"/>
      </tapa.send>

     <tapa.timeout/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.64
#
#       Desc:    RRC configuration request followed by RRC Connection
#                Setup message - Failure due to NULL Cfg SDu
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.64">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends configuration request to RRC. RRC sends configuration"
         "request to MAC, PDCP and RLC layers. RRC receives configuration "
         "confirm from all the lower layers and sends the confirm to RRC user."
         "RRC has created UE context for the configuration request. RRC "
         "receives RRC Connection Setup from RRC user and it sends it to RLC."
         "RRC receives RRC Connection Setup Complete from PDCP and it forwards"
         " the message to RRC user after decoding it."
         
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" tCrnti="2"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" cellId="1" 
          valChk="0"/>
      </tapa.send>

     <tapa.delay delay="1" />

     #Expect RRC Connection Setup at RLC
     <tapa.expect>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" 
                         />
     </tapa.expect>

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="1" pdcpId="1"
                          tCrnti="2" transId="10" expCfgBitMask="11"  nullSdu="1"
                          rbCfgType="1" numAddRb="1" addRbIdStr="1,0" />
      </tapa.send>

      <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

##################################################################################
#       Test:    4.65
#       Desc:    Unsuccessful operation of Get Count Request - NULL Sdu
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.65">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Get Count Values Request after DRBs created

         RRC-USER will establish the  RRC connection and does connection
         reconfiguration to establish all required RBs (SRBs and DRBs). Then RRC
         user initiates DL information transfer and UE does UL Information
         transfer. This is to make sure that Count values are not zero. After this
         RRC-USER issues Get Count Values request to RRC. RRC will send the Get
         Count Values request to PDCP. RRC receives Indication from PDCP
         containing Count values for all established DRBs. RRC will send
         confirmation to RRC-USER containing the counter information it has got
         from PDCP.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is activated)
         2. Reconfigure the RRC connection (to establish DRBs)
         3. RRC-USER sends Get Count Values Request Message to RRC with invalide
            cell ID
         4. RRC validates the request and sends error indication to RRC-USER
            with error type NHU_ERRTYPE_UE_CFG (15) and error cause
            NHU_ERRCAUSE_INV_CFG_TYPE (18)

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Count request with invalide cell ID
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"
               nullSdu="1"/>
     </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.66
#       Desc:    Unsuccessful operation of Get Count Values Request after DRBs created
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.66">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Get Count Values Request after DRBs created

         RRC-USER will establish the  RRC connection and does connection
         reconfiguration to establish all required RBs (SRBs and DRBs). Then RRC
         user initiates DL information transfer and UE does UL Information
         transfer. This is to make sure that Count values are not zero. After this
         RRC-USER issues Get Count Values request to RRC. RRC will send the Get
         Count Values request to PDCP. RRC receives Indication from PDCP
         containing Count values for all established DRBs. RRC will send
         confirmation to RRC-USER containing the counter information it has got
         from PDCP.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is activated)
         2. Reconfigure the RRC connection (to establish DRBs)
         3. RRC-USER sends Get Count Values Request Message to RRC
         4. RRC requests PDCP for COUNT values
         5. RRC receives confirm from PDCP for Count Values of all established
            DRBs
         6. RRC sends confirm to RRC-USER with these values.
         7. Check did RRC-USER receives successful confirmation with Count
            Values for the number of DRBs it configured and count values match
            with count values maintained in PDCP

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />


      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Count request
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.dummy.cpj.cntreq spId = "0" use="1"/>
     </tapa.expect>

    # Send Count confirm from PDCP with failure status
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="0" use="1" cleanup="0"
               ueId="32" cellId="4" drbIdStr="3,4" cfmFail="1" />
     </tapa.send>

    # Send Count confirm from PDCP withmax drbs exceeding permitted vaules
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="1" use="1" cleanup="0"
               ueId="32" cellId="4" drbIdStr="3,4,5,6,7,8,9,10,11,12,13,14" cfmFail="1" />
     </tapa.send>

     <tapa.timeout/>
   </tapa.test>

   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    4.67
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure - Duplicate TransId
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.67">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          Unsuccessful RRC Connection Establishment Procedure - Duplicate TransId

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>
      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
	      <tapa.lnh.staind category="4" event="256" cause="16" alarmType="0" />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
        <tapa.nhu.errind/>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.68
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure - Invalid SAP
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.68">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          Unsuccessful RRC Connection Establishment Procedure - Invalid SAP
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" invalidSap="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
        <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.69
#
#       Desc:    Unseccessful RRC Connection Setup followed by configuration request 
#                 due to encode failed
#
#       Notes:   None
#
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.69">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         "RRC user sends RRC Connection Setup to RRC, RRC encodes and sends"
         "it to lower layers without creating UE and transaction context."
         "RRC receives configuration request from RRC user and sends "
         "configuration request to PDCP, MAC and RLC layers. RRC receives" 
         "configuration confirm from all the layers and it sends the confirm"
         "to RRC user. RRC receives RRC Connection Setup Complete from PDCP "
         "and forwards it to RRC user."
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send Configuration Request from RRC user
      <tapa.send >
         <tapa.nhu.cfgreq suId="0" spId="0" rbId="1" cellId="1" pdcpId="1"
                          tCrnti="2" transId="10" expCfgBitMask="11" 
                          rbCfgType="1" numAddRb="1" addRbIdStr="1,0" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" />
         <tapa.dummy.ckw.cfgreq  use="1" />
         <tapa.dummy.cpj.cfgreq  use="1" />
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm ueId="2" cellId="1" />
     </tapa.expect>


      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0" rbId="1" ueId="2"
          msgCategory="3" msgType="3" cellId="1" tCrnti="2"
          rrcTransIdPres="0" transId="10" valChk="0"/>
      </tapa.send>

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.errind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>


</tapa.testcase>

#
#
#       Test:    4.70
#
#       Desc:    RRC Connection Request rejected by RRC user
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.70">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
          "On receiving RRC Connection Request from the RLC, RRC decodes the"
          " message and forwards it to RRC user. RRC user rejects the request"
          " by sending RRC Connection Reject message to RRC. RRC encodes this"
          " message and sends it to RLC. No RLC, PDCP or MAC configuration "
          "takes place. RLC sends a new RRC Connection Request for the same "
          "UE and it is successful. The message flow is same as testcase 4.1."
 
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef>
      </tapa.ifndef>

      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" cellId="1" 
                          tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Reject from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="0"
          msgCategory="3" msgType="2" failForEnc = "1"
          transId="10" rbId="1" tCrnti="2" cellId="1" valChk="0"/>
      </tapa.send>

     <tapa.expect>
        <tapa.nhu.errind />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.71
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#               cause -> RRC could not send Sec Cmp Ind to User
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.71">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the Security Mode Command
         Message request along with security configuration. RRC will encode and
         send security mode command message to PDCP with Selective Security
         Mode enabled.
         After receiving positive confirmation from PDCP, RRC will send Security
         Mode Command to UE. RRC will send configuration confirm to RRC-USER. RRC
         will also send data indication for security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by PDCP
         RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA flag
            set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         6. RRC receives security configuration confirm from PDCP
         7. RRC sends data request to send Security Mode Command message to PDCP
         8. RRC sends configuration confirm to RRC-USER
         9. Check whether RRC-USER receives successful configuration confirm
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security Mode
            Complete Message

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" failInd="1"/>
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.timeout/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.72
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure.
#                 -  Con Setup Cmp Indication could not be sent to User
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.72">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           Unsuccessful RRC Connection Establishment Procedure.
           Con Setup Cmp Indication could not be sent to User
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" failInd="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.73
#       Desc:    Unsuccessful operation of connection release
#                 - Encode failure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.73">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
            Unsuccessful operation of Initial Security Activation Procedure
            due to null SDU passed
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5" rrcTransIdPres="0"
          transId="1" rrc_transId="0" pdcpId="1" valChk="0" ueId="32" cellId="4"/>
      </tapa.send>

      <tapa.delay delay="1" />

      <tapa.expect>
         <tapa.nhu.errind ueId="32" cellId="4" errorType="7" errorCause="0"/>
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.74
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                 - Lower Layer cofiguration could not be sent
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.74">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the Security Mode Command
         Message request along with security configuration. RRC will encode and
         send security mode command message to PDCP with Selective Security
         Mode enabled.
         After receiving positive confirmation from PDCP, RRC will send Security
         Mode Command to UE. RRC will send configuration confirm to RRC-USER. RRC
         will also send data indication for security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by PDCP
         RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA flag
            set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         6. RRC receives security configuration confirm from PDCP
         7. RRC sends data request to send Security Mode Command message to PDCP
         8. RRC sends configuration confirm to RRC-USER
         9. Check whether RRC-USER receives successful configuration confirm
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security Mode
            Complete Message

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     <tapa.rrc.delsap.cpj/>

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.expect>
            <tapa.nhu.errind errType="4" errCause="5" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rrc.delsap.pju/>
     <tapa.rrc.delsap.kwu/>
     <tapa.rrc.delsap.crg/>
     <tapa.rrc.delsap.ckw/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.75
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                 - Encode failure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.75">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
          Unsuccessful operation of Initial Security Activation Procedure
           - Encode failure

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" rrcTransIdPres="0"/>
      </tapa.send>

      <tapa.expect>
            <tapa.nhu.errind errType="4" errCause="5" />
      </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.76
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                with separate configuration primitive - Encode failure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.76">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Successful operation of Initial Security Activation Procedure
       with separate configuration primitive

         RRC-USER will start initial security activation procedure after UE is
         moved to RRC_CONNECTED state. Hence, RRC-USER will establish the
         connection before this procedure is activated. After connection
         establishment RRC-USER will issue to RRC the security configuration. RRC
         will send configuration request to PDCP with Selective Security Mode
         enabled. After receiving positive confirmation from PDCP, RRC will send
         configuration confirm to RRC-USER. RRC-USER will send Security Mode
         Command message request to RRC. RRC will check if Security is configured
         (True in this case). RRC will encode and send Security Mode Command to
         UE. RRC will send data indication for Security Mode Complete Message sent
         from UE to RRC-USER after reception of this messages is indicated by
         PDCP. RRC decodes this response before sending it to RRC-USER.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security configuration request to RRC with 'during
            Handover flag set to False
         3. RRC sends security configuration request to PDCP with Selective
            Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends configuration confirm to RRC-USER
         7. Check whether RRC-USER receives successful configuration confirm
         8. RRC-USER issues Security Mode Command request to RRC using data request
         9. RRC sends data request to send Security Mode Command message to PDCP
         10. RRC receives successful indication from PDCP
         11. RRC sends successful indication to RRC-USER
         12. Check whether RRC-USER receives data indication for Security
            Command Complete message


      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>
   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="2" tCrnti="2" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.cfgreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="2" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.cfgcfm />
     </tapa.expect>

    #Send Security Mode Command without security configuration
     <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" 
          integrityAlgo="1" msgCategory="1" msgType="6"
          cipheringAlgo="1" transId="9" rrc_transId="2" cellId="4"
          ueId="2" pdcpId="1" valChk="0" rrcTransIdPres="0"/>
      </tapa.send>

      <tapa.expect>
            <tapa.nhu.errind errType="4" errCause="5" />
      </tapa.expect>

  </tapa.test>

  # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.77
#       Desc:      Unsuccessful operation of countercheck procedure
#                    - Encode failure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.77">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
          Unsuccessful operation of countercheck procedure
           - Encode failure

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />


      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


     # Send Counter Check Message Request
     <tapa.send>
         <tapa.nhu.datreq ueId="32" spId="0" msgCategory="1" msgType = "8" cellId="4"
            ratType="0" transId="10" rrc_transId="1" pdcpId="1" valChk="0" rrcTransIdPres="0"
            bitMask = "0" numDrbs="2" drbIdStr="3,4"/>
     </tapa.send>
     <tapa.expect>
        <tapa.nhu.errind/>
     </tapa.expect>

   </tapa.test>
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.78
#       Desc:    Failure of Initial Security Activation Procedure by failing to
#                send Sec Mod Failure indication from PDCP (Reception of Security
#                Mode Failure Message from UE)
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.78">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
       Failure of Initial Security Activation Procedure by failure
       indication from PDCP (Reception of Security Mode Failure Message
       from UE)

         RRC-USER establishes the RRC Connection. RRC sends Security Activation
         request to RRC. RRC sends configuration request to PDCP. PDCP sends
         configuration confirm to RRC. RRC sends data request for Security Mode
         Comand to PDCP. PDCP sends Data confirm for this message. PDCP indicates
         RRC about reception of Security Mode Failure Command. RRC sends indication
         to RRC-USER about this message.

         Steps:
         ------
         1. Establish RRC Connection (Bring UE in RRC_CONNECTED State where only
				SRB1 is created and security is not yet activated)
         2. RRC-USER issues security Mode command and security configuration
            request to RRC in single primitive with 'During Handover to EUTRA
            flag set to False
         3. RRC sends security configuration request to PDCP with Selective
				Security Mode enabled
         4. Check that PDCP receives security configuration request with Selective
            Security Mode enabled
         5. RRC receives security configuration confirm from PDCP
         6. RRC sends Security Mode Command message to PDCP
         7. RRC sends configuration confirm to RRC-USER
         8. Check whether RRC-USER receives successful configuration confirm
         10. RRC receives Security Mode Failure message indication from PDCP
         11. RRC removes the security configuration applied at lower layers
            (UE Context)
         12. RRC sends same failure indication to RRC-USER, but fails

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg transId="20" cellId="1" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="4" tCrnti="4" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          integrityAlgo="1" msgCategory="1" msgType="6"
          cipheringAlgo="1" transId="64" rrc_transId="2" cellId="1"
          ueId="4" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" cellId="1" ueId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="4" cellId="1" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="4" cellId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Failure from PDCP
     <tapa.send>
        <tapa.dummy.pju.staind pdcpInstId="1" secModFailMsg="1" suId="0"
                               ueId="4" cellId="1" cause="1"  failInd="1"/>
     </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="4" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

#
#
#       Test:    4.79
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure.
#                 Due to failure in sending Con Req indication to User
#
#       Notes:   None
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.79">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " RRC connection establishment procedure. It involves"
           "RRC connection request coming from UE, RRC connection"
           "setup coming from RRC user and RRC connection setup"
           "complete message coming from UE. All the RRC messages"
           "will have all the mandatory parameters on it."

           "First, we will send a RRC Connection Request from RLC" 
           "stub to RRC."  

           "On receiving RRC Connection Request from RLC, RRC" 
           "decodes and validates this message and then passes"
           "it to RRC user. But failes"

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2"  failInd="1"/>
      </tapa.send>

      <tapa.timeout/>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.80
#       Desc:    Unsuccessful operation Connection Release procedure
#                 - due to failure in sending data indication for Release Complete
#                  to USER
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.80">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
     
     <tapa.desc>
       Unsuccessful operation Connection Release procedure
       due to failure in sending data indication for Release Complete to USER

     </tapa.desc>
     
     <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      #RRC user sends RRC Connection Release Message to RRC User
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="0" msgCategory="1" msgType="5"
          transId="1" rrc_transId="1" pdcpId="1" valChk="0" ueId="32" cellId="4"/>
      </tapa.send>

      <tapa.delay delay="1" />

     #Expect RRC Connection Release at PDCP
     <tapa.expect>
        <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4"/>
     </tapa.expect>

     <tapa.rrc.delsap.cpj/>
     <tapa.rrc.delsap.ckw/>
     <tapa.rrc.delsap.crg/>
      #Send RRC Connection Release sent confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" failCfm="1"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm ueId="32" cellId="4"/>
     </tapa.expect>

      <tapa.delay delay="1" />
      #Send Release Configuration to MAC, RLC and PDCP

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
     <tapa.rrc.delsap.pju/>
     <tapa.rrc.delsap.kwu/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.81
#       Desc:    Successful operation of Initial Security Activation Procedure
#                 and subsequent  (second time) security configuration
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.81">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
          Successful operation of Initial Security Activation Procedure
          and subsequent  (second time) security configuration
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #  Complete the Initital Security Activation Procedure
     <tapa.rrc.security_actv ueId="32" cellId="4"/>

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6" cipheringAlgo="1"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="32" cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.82
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure.  
#                 due to KWU passing null sdu in dat indication
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.82">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
         Unsuccessful RRC Connection Establishment Procedure.
         due to KWU passing null sdu in dat indication
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" nullSdu="1" cleanup="1"/>
      </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.83
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure.  
#                 due to KWU passing null Buffer in dat indication
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.83">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
        Unsuccessful RRC Connection Establishment Procedure.
        due to KWU passing null Buffer in dat indication

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" nullmBuf="1" cleanup="1"/>
      </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.84
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                 due to NULL pdcpCfg Cfm passed by CPJ CFG CFM
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.84">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
         Unsuccessful operation of Initial Security Activation Procedure
         due to NULL pdcpCfg Cfm passed by CPJ CFG CFM

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="32" cellId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="5" spId="0" suId="0"
                  ueId="32" cellId="4" />
     </tapa.send>

     <tapa.delay delay="1" />

      #Expect Expect Cfg request at PDCP for DisardStatus
      <tapa.expect>
         <tapa.dummy.cpj.cfgreq  use="1" cleanup="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" status="1" ueId="32" nullCfgCfm="1" 
                     cleanup="1"/>
      </tapa.send>

     #Expect configuration confirm at RRC user
     <tapa.expect>
         <tapa.nhu.datind ueId="32" cleanup="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.85
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#                 - NULL Cfm Sent from CPJ Count Cfm
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.85">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
        Unsuccessful operation of Initial Security Activation Procedure
        - NULL Cfm Sent from CPJ Count Cfm

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" nullCfgCfm = "1"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm />
     </tapa.expect>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.86
#       Desc:    Unsuccessful operation of Get Count Values Request after DRBs created
#                 - NULL Count Cfm sent from CPJ layer
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.86">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.6"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
        Unsuccessful operation of Get Count Values Request after DRBs created
         - NULL Count Cfm sent from CPJ layer

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>
   <tapa.test>
     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

      <tapa.delay delay="5" />

      # Security Activation for UE in connected mode
      <tapa.rrc.security_actv ueId="32" cellId="4"/>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="4" ueId="32" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      # Expect Lower Layer configurations and ReCfg Cfm at RRC User
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="0"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" ueIdPres="1" valUeId="1" rbIdx="2"
                                                                        cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" ueIdPres="1" valUeId="1" cleanup="1" />
      </tapa.expset>


      # Send Config confirm from RLC
      <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="32"/>
      </tapa.send>

      # Send Config confirm from MAC
      <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" ueId="32"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="32" cellId="4" />
      </tapa.expect>

     #Expect configuration confirm at RRC user
     <tapa.expect>
        <tapa.nhu.cfgcfm/>
     </tapa.expect>

      # Send Conn Recfg Complete
      <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="2" spId="0" suId="0"
         ueId="32" cellId="4"/>
      </tapa.send>

     <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.nhu.datind ueId="32"  />
      </tapa.expect>


# --- NULL CountCfm from CPJ
     # Send Count request
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.dummy.cpj.cntreq spId = "0" use="1"/>
     </tapa.expect>

    # Send Count confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="1" use="1" 
               ueId="32" cellId="4" drbIdStr="3,4" nullCfgCfm="1"
                  cfmFail = "1"/>
     </tapa.send>

# --- Invalid CellId CountCfm from CPJ
     # Send Count request
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.dummy.cpj.cntreq spId = "0" use="1"/>
     </tapa.expect>

    # Send Count confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="1" 
               ueId="32" cellId="4" drbIdStr="3,4" duplicate="1" 
                  invalidCellId = "13" cfmFail="1"/>
     </tapa.send>

# --- Invalid UeId CountCfm from CPJ
     # Send Count request
     <tapa.send>
         <tapa.nhu.countreq spId="0" ueId="32" transId="100" cellId="4"/>
     </tapa.send>

     #expect count request at PDCP
     <tapa.expect>
         <tapa.dummy.cpj.cntreq spId = "0" use="1"/>
     </tapa.expect>

    # Send Count confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cntcfm suId="0" status="1" cleanup="1"
               ueId="32" cellId="4" drbIdStr="3,4" duplicate="1" 
                  invalidUeId = "13" cfmFail="1"/>
     </tapa.send>
     <tapa.timeout/>
   </tapa.test>

   <tapa.clean>
      <tapa.rrc.conrls ueId="32" cellId="4" />
      <tapa.rrc.cellcfg.rls cellId="4" />
   </tapa.clean>

   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.87
#       Desc:    Failure of Initial Security Activation Procedure by failure
#                indication from PDCP (Reception of Security Mode Failure Message
#                from UE) and failed in decoding the SecModFailure message
#                This test case is removed as behaviour in TC and LC is different
#                In LC the mBuf passed is NULL(cmUnpkPjuStaInd) whereas in TC we 
#                can pass mBuf with length zero. Hence making changes just to get
#                passing.
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.87">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
        Failure of Initial Security Activation Procedure by failure
        indication from PDCP (Reception of Security Mode Failure Message
        from UE) and failed in decoding the SecModFailure message

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg transId="20" cellId="1" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="4" tCrnti="4" />

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="4" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>

##################################################################################
#       Test:    4.88
#       Desc:    Unsuccessful operation of Initial Security Activation Procedure
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.88">
   <tapa.attribute scenarioType="NORMAL"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
        Unsuccessful operation of Initial Security Activation Procedure

      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
       <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg cellCfgType="1" transId="30" cellId="4" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="4" ueId="32" tCrnti="32" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          msgCategory="1" msgType="6"
          transId="64" rrc_transId="2" cellId="4"
          ueId="32" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      <tapa.rrc.delsap.pju/>
      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" status="1" ueId="32" />
      </tapa.send>

     <tapa.timeout/>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.delsap.cpj/>
      <tapa.rrc.delsap.kwu/>
      <tapa.rrc.delsap.ckw/>
      <tapa.rrc.delsap.crg/>
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>
#
#
#       Test:    4.89
#
#       Desc:    Unsuccessful RRC Connection Reconfiguration Procedure.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.89">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
        Unsuccessful RRC Connection Reconfiguration Procedure.
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Send Reconfiguration request
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="1"
          msgCategory="1" msgType="4" transId="1" rrc_transId="1"
          cellId="1" ueId="2" pdcpId="1" numAddRb="3" addRbIdStr="2,0,3,1,4,1"
          addLcIdStr="2,3,4" addBitMskStr="7,1,1" rbCfgType="1" logChType="3"
          trChCfgDed="0" macSchedCfg="0"  valChk="0" rrcTransIdPres="1"/>
      </tapa.send>

      <tapa.delay delay="5" />

      <tapa.expect>
         <tapa.nhu.errind errorType="15" errorCause="27"/>
      </tapa.expect>
     #Send RRC Connection Setup Complete from PDCP
     <tapa.send>
        <tapa.dummy.pju.datind pdcpInstId="1" msgType="4" spId="0"
                         suId="0" ueId="2" cellId="1" />
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect RRC Connection Setup Complete at RRC user
     <tapa.expect>
        <tapa.nhu.datind ueId="2" cellId="1" />
     </tapa.expect>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.90
#
#       Desc:    Unsuccessful RRC Connection Establishment Procedure.  
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.90">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
           "This test case tests the scenario of successful"
           " RRC connection establishment procedure. It involves"
           "RRC connection request coming from UE, RRC connection"
           "setup coming from RRC user and RRC connection setup"
           "complete message coming from UE. All the RRC messages"
           "will have all the mandatory parameters on it."

           "First, we will send a RRC Connection Request from RLC" 
           "stub to RRC."  

           "On receiving RRC Connection Request from RLC, RRC" 
           "decodes and validates this message and then passes"
           "it to RRC user. RRC user sends RRC Connection Setup "
           "along with the configuration information to RRC. In"
           "this test case, we assume that RRC user sends explicit"
           "configuration details."

           "On getting the message from RRC user, RRC reads the "
           "configuration information present in the primitive and"
           "initiates the configuration of RLC, PDCP and MAC layers"
           "by sending configuration request to RLC, PDCP and MAC."

           "RLC, PDCP and MAC layers sends positive reply by sending"
           "configuration confirm to RRC. On getting all the "
           "configuration confirm from RLC, PDCP and MAC layers, RRC"
           "sends configuration confirm to RRC user."

           "RRC encodes the received RRC Connection Setup  and sends"
           "it to RLC. This means RRC Connection Setup message is sent"
           "to UE."

           "UE applies the configuration at its end and sends RRC"
           "Connection Setup Complete to eNB."

           "On getting RRC Connection Setup Complete from PDCP, RRC "
           "decodes the message and if decode is successful, RRC "
           "forwards RRC Connection Setup Complete to RRC user." 

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1" />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" />
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2" cfmFail="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" cellId="1" />
     </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="2" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.91
#
#       Desc:    RRC sends the duplicate RRC Connection Setup 
#                with different Temporary CRNTI without RB configuration
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.91">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
        RRC sends the duplicate RRC Connection Setup
         with different Temporary CRNTI without RB configuration
      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="8"
          msgCategory="3" msgType="3" rrc_transId="1" transId="10"
          rbId="1" tCrnti="6" cellId="1" 
          pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2" />
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2" failCfm="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="6" 
         cellId="1" />
     </tapa.expset>

     <tapa.timeout/>
   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="6"/>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
     <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

#
#
#       Test:    4.92
#
#       Desc:    RRC sends the duplicate RRC Connection Setup 
#                with different Temporary CRNTI without RB configuration
#
#       Notes:   None
#              
#       Module:  
#
#       File:    nhac_tc4.xml
#
#
<tapa.testcase id="4.92">

   # Document subsection
   <tapa.doc>

      <tapa.rfc id="36.331" section="5.3.3 and 6.2.2"/>
      <tapa.module id="lterrc"/>

      <tapa.desc>
        RRC sends the duplicate RRC Connection Setup
        with different Temporary CRNTI without RB configuration

      </tapa.desc>

      <tapa.longdesc/>

   </tapa.doc>

   # Require features and flags subsection
   <tapa.require>

      <tapa.ifdef>
      </tapa.ifdef>

      <tapa.ifndef/>
      <tapa.mode mode="single"/>

   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />
   
      #Cell Configuration Setup
      <tapa.rrc.cellcfg cellCfgType="1" transId="3" cellId="1" />
   </tapa.cfg>

   <tapa.test>

      # Send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="2" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="2" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="11"
          rbCfgType="1"  numAddRb="1" msgCategory="3" msgType="3"
          rrc_transId="1" transId="10" rbId="1" tCrnti="2" cellId="1" 
          addRbIdStr="1,0" pdcpId="1"  />
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect configuration RRC Connection Setup at RLC request at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1"/>
         <tapa.dummy.crg.cfgreq  store_tid="1" valTCrnti="2" tCrntiPres="1" rbIdx="0" cleanup="1"/>
         <tapa.dummy.ckw.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
         <tapa.dummy.cpj.cfgreq  use="1" valTCrnti="2" tCrntiPres="1" cleanup="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     <tapa.send>
         <tapa.dummy.crg.cfgcfm   stored_tid="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.cfgcfm   use="1" ueId="2"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.cfgcfm   use="1" cellId="1" ueId="2"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="2" 
         cellId="1" />
        <tapa.nhu.cfgcfm/>
     </tapa.expset>

      # Re-send RRC Connection Request from RLC 
      <tapa.send >
         <tapa.dummy.kwu.datind suId="0" spId="0" rbId="1" msgType="1" 
         cellId="1" tCrnti="6" />
      </tapa.send>

      <tapa.delay delay="5" />
      #Expect RRC Connection Request at RRC user
      <tapa.expect >
         <tapa.nhu.datind cellId="1" tCrnti="6" />
      </tapa.expect>

      #Send RRC Connection Setup from RRC user with UE ID Change Request
      <tapa.send>
         <tapa.nhu.datrsp spId="0" bitMask="2" expCfgBitMask="8"
          msgCategory="3" msgType="3" rrc_transId="1" transId="10"
          rbId="1" tCrnti="6" cellId="1" 
          pdcpId="1" ueId="2" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="5" />

      #Expect UE ID change configuration at MAC, RLC and PDCP
      <tapa.expset>
         <tapa.dummy.crg.cfgreq  store_tid="1"  />
         <tapa.dummy.ckw.ueidchngreq use="1"/>
         <tapa.dummy.cpj.ueidchngreq  use="1"/>
      </tapa.expset>

     #Send configuration confirm from MAC
     <tapa.send>
         <tapa.dummy.crg.cfgcfm stored_tid="1" ueId="6"/>
     </tapa.send>

     #Send configuration confirm from RLC
     <tapa.send>
         <tapa.dummy.ckw.ueidchngcfm  use="1" status="1" ueId="2" failCfm="1"/>
     </tapa.send>

     #Send configuration confirm from PDCP
     <tapa.send>
         <tapa.dummy.cpj.ueidchngcfm use="1" status="1" ueId="2" cfmFail="1"/>
     </tapa.send>

     <tapa.delay delay="5" />

     #Expect configuration confirm at RRC user
     #Expect RRC Connection Setup at RLC
     <tapa.expset>
         <tapa.dummy.kwu.datreq rbId="1" tCrnti="6" 
         cellId="1" />
     </tapa.expset>

   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls cellId="1" ueId="6"/>
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
     <tapa.rrc.deinit/>
   </tapa.shutdown>

</tapa.testcase>

##################################################################################
#       Test:    4.93
#       Desc:    Failure of Initial Security Activation Procedure by failure
#                indication from PDCP (Reception of Security Mode Failure Message
#                from UE)
#       Module:  CCM
#       File:    nhac_tc4.xml
##################################################################################
<tapa.testcase id="4.93">
   <tapa.attribute scenarioType="FAILURE"/>
   <tapa.doc>
      <tapa.rfc id="36.331" section="5.3.5"/>
      <tapa.module id="lterrc"/>
      <tapa.desc>
        Failure of Initial Security Activation Procedure by failure
         indication from PDCP (Reception of Security Mode Failure Message from UE)
      </tapa.desc>
      <tapa.longdesc/>
   </tapa.doc>
   <tapa.require>
      <tapa.ifdef>
      </tapa.ifdef>
      <tapa.ifndef>
      </tapa.ifndef>
      <tapa.mode mode="single"/>
   </tapa.require>

   # Configuration subsection
   <tapa.cfg>
      # Configure RRC
      <tapa.rrc.init />

      #Cell Configuration Setup
     <tapa.rrc.cellcfg transId="20" cellId="1" />
   </tapa.cfg>

   <tapa.test>

     #RRC Connection establishment procedure
     <tapa.rrc.consetup cellId="1" ueId="4" tCrnti="4" />

     #Send Security Mode Command with security configuration
      <tapa.delay delay="1" />
      <tapa.send>
         <tapa.nhu.datreq spId="0" bitMask="2" expCfgBitMask="4"
          integrityAlgo="1" msgCategory="1" msgType="6" chngIntAlgo="1" chngCiphAlgo="1"
          cipheringAlgo="1" transId="64" rrc_transId="1" cellId="1"
          ueId="4" pdcpId="1" valChk="0"/>
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security configuration at PDCP
      <tapa.expect>
         <tapa.dummy.cpj.seccfgreq  use="1"/>
      </tapa.expect>

      #Send configuration confirm from PDCP
      <tapa.send>
         <tapa.dummy.cpj.seccfgcfm   use="1" cellId="1" ueId="4" cleanup="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Security Mode command at PDCP
      <tapa.expset>
         <tapa.dummy.pju.datreq pdcpInstId="1" ueId="4" cellId="1" />
         <tapa.nhu.cfgcfm />
      </tapa.expset>

      #Send Security Mode command confirm from PDCP
      <tapa.send>
        <tapa.dummy.pju.datcfm pdcpInstId="1" ueId="4" cellId="1" />
      </tapa.send>

      <tapa.delay delay="1" />

      #Expect Data Confirm at RRC user
     <tapa.expect>
        <tapa.nhu.datcfm />
     </tapa.expect>

      # Send Security Mode Failure from PDCP
     <tapa.send>
        <tapa.dummy.pju.staind pdcpInstId="1" secModFailMsg="1" suId="0"
                               ueId="4" cellId="1" cause="1" nullSdu="1" />
     </tapa.send>

     <tapa.timeout/>

     <tapa.send>
        <tapa.dummy.pju.staind pdcpInstId="1" secModFailMsg="1" suId="0"
                               ueId="4" cellId="1" cause="1" nullPdcpId="1" />
     </tapa.send>

     <tapa.timeout/>


   </tapa.test>

   # Clean subsection
   <tapa.clean>
      <tapa.rrc.conrls ueId="4" cellId="1" />
      <tapa.rrc.cellcfg.rls cellId="1" />
   </tapa.clean>

   # Shutdown subsection
   <tapa.shutdown>
      <tapa.rrc.deinit/>
   </tapa.shutdown>
</tapa.testcase>



# DO NOT DELETE THIS LINE -- TC number generation script depends on it.
# xyzabcend

#/********************************************************************30**
#
#         End of file:     nhac_tc4.xml
#
#*********************************************************************31*/
#
#
#/********************************************************************40**
#
#        Notes:
#
#*********************************************************************41*/
#
#/********************************************************************50**
#
#*********************************************************************51*/
#
#
#/********************************************************************60**
#
#        Revision history:
#
#*********************************************************************61*/
#
#/********************************************************************90**
#
#     ver       pat    init                  description
#------------ -------- ---- ----------------------------------------------
#$SID$         ---     rcs              1. LTE RRC Initial Release.
#$SID$         ---     sbalakrishna     1. Updated for Release of 3.1.
#$SID$         ---     njha             1. Updated for Release.
#*********************************************************************91*/
